[{"categories":null,"contents":"","date":"Nov 26","permalink":"http://blog.ibyte.me/projects/fw_project/","tags":null,"title":"falsework"},{"categories":null,"contents":"","date":"Nov 26","permalink":"http://blog.ibyte.me/projects/gsql_project/","tags":null,"title":"gsql"},{"categories":null,"contents":"","date":"Nov 26","permalink":"http://blog.ibyte.me/projects/s2s_project/","tags":null,"title":"s2s"},{"categories":null,"contents":"","date":"Nov 26","permalink":"http://blog.ibyte.me/projects/sessionx_project/","tags":null,"title":"sessionx"},{"categories":null,"contents":"æœ¬é¡µé¢æ˜¯æœ¬åšä¸»ä¸ªäººå¹³æ—¶æ•´ç†çš„ä¸€äº›è®¡ç®—æœºç§‘å­¦ä¸“ä¸šè§†é¢‘å­¦ä¹ èµ„æ–™ï¼Œæ•´ç†æ”¾åœ¨ä¸‹é¢æ–¹ä¾¿å¤§å®¶æµè§ˆï¼Œå¸Œæœ›å¯¹å¤§å®¶æœ‰å¸®åŠ©ã€‚\n   èµ„æ–™åç§° é“¾æ¥     æ•°æ®åº“åŸºç¡€ å“”å“©å“”å“©è§†é¢‘   æ•°æ®ç»“æ„åŸºç¡€ å“”å“©å“”å“©è§†é¢‘   æ“ä½œç³»ç»ŸåŸºç¡€ ä¸Šæµ·äº¤é€šå¤§å­¦-é™ˆæµ·æ³¢    ","date":"Sep 24","permalink":"http://blog.ibyte.me/post/computer-science-learning/","tags":null,"title":"Computer Science Learning"},{"categories":null,"contents":"   æ¦‚ è¿°  åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä½œä¸ºä¸€ä¸ªcrud boyæ¥è¯´ä¼šä½¿sqlæ¥æ“ä½œæ•°æ®åº“å¢åˆ æ”¹æŸ¥æ˜¯å¿…ä¸å¯å°‘çš„ï¼Œè¿™ç¯‡æ–‡ç« å°†å†™å†™æ—¥å¸¸å¼€å‘ä¸­å¸¸ç”¨çš„sqlè¯­å¥ã€‚æ•°æ®æ˜¯ä¸€ä¸ªæŠ½è±¡çš„çš„å®šä¹‰ï¼Œæ‰€è°“çš„æ•°æ®åº“å°±æ˜¯æŠŠä¸€äº›å…ƒæ•°æ®é€šè¿‡ç‰¹å®šè§„å¾‹æ•´ç†åˆ°ä¸€èµ·ç®¡ç†èµ·æ¥ï¼Œæ–¹ä¾¿é€šè¿‡ä»–ç‰¹å®šDDLï¼ŒDCLï¼ŒDMLè¿™äº›ç‰¹å®šçš„è¯­å¥æ¥æ–¹ä¾¿ç®¡ç†æ•°æ®ã€‚\n DDL (data definition languages) æ–¹ä¾¿å¼€å‘è€…é€šè¿‡SQLæ¥å®šä¹‰å­˜å‚¨çš„æ•°æ®æ ¼å¼ï¼Œç»„ç»‡æ•°æ®ã€‚ DML (data manipulation languages) å…è®¸ç”¨æˆ·å¯¹æ•°æ®è¿›è¡Œcreateã€deleteã€insertã€updatedæ“ä½œã€‚ DCL (data control languages) å¯ä»¥æ¥ç®¡ç†ç”¨æˆ·å¯¹æ•°æ®çš„è®¿é—®æ“ä½œæƒé™ï¼Œä¾‹å¦‚æ£€ç´¢ï¼Œæ›´æ–°ï¼Œåˆ é™¤ \u0026hellip;     æŸ¥è¯¢è¯­å¥  åœ¨æ—¥å¸¸å¼€å‘è¿‡ç¨‹ä¸­æŸ¥è¯¢æ•°æ®æ˜¯åº”ç”¨åœºæ™¯æœ€å¤šçš„ï¼ŒæŸ¥è¯¢å°±è¦ä½¿ç”¨selectå…³é”®å­—ï¼Œå¦‚ä¸‹ï¼š\n1  select * from tableName;   ä¾‹å¦‚æœ‰ä¸€ä¸ªè¡¨ç»“æ„å¦‚ä¸‹ï¼š\nä¸Šé¢æ˜¯æŸ¥è¯¢æ•´å¼ è¡¨çš„æ‰€æœ‰å­—æ®µæ•°æ®ï¼Œå¦‚æœéœ€è¦ç­›é€‰å°±éœ€è¦åˆ¶å®šå…¶field nameå¦‚ä¸‹ï¼š\n1  select name as \u0026#34;ç”¨æˆ·å\u0026#34; from TableName;   å¹¶ä¸”ä¸Šé¢ä½¿ç”¨äº†aså…³é”®å­—å¹¶è¿›è¡Œäº†åˆ«åï¼ŒæŸ¥è¯¢å‡ºæ¥æ•°æ®å°±æŒ‰ç…§åˆ«åè¿›è¡Œå±•ç¤ºã€‚\nå¦‚æœæƒ³æŸ¥è¯¢æŒ‡å®šçš„æ•°æ®,å°±è¦ä½¿ç”¨whereå­è¯­å¥ï¼Œå¦‚ä¸‹ï¼š\n1  select * from TableName where ID = 1;   é‚£ä¹ˆä¸Šçš„SQLè¯­å¥æŸ¥è¯¢å‡ºæ¥çš„ç»“æœå°±æ˜¯ä¸Šå›¾ä¸­IDç­‰äº1çš„ä¸€æ¡æ•°æ®ã€‚\nå¦‚æœéœ€è¦æ•´ç†ç»“æœé›†å»é‡å¤çš„è¯åœ¨å‰é¢åŠ å…¥distinctå…³é”®å­—ï¼Œå°±å¯ä»¥å»é‡äº†ã€‚\n   æŸ¥è¯¢è¿‡æ»¤  æœ‰æ—¶å€™æˆ‘ä»¬é€šè¿‡æ¡ä»¶æŸ¥è¯¢åˆ°çš„æ•°æ®éœ€è¦è¿›è¡Œå…¶ä»–ç­›é€‰ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±è¦ä½¿ç”¨åˆ°limitæˆ–è€…order byè¿›è¡Œè¿‡æ»¤æˆ–è€…é‡æ–°æ•´ç†äº†ã€‚\nä¾‹å¦‚æˆ‘è¦æŸ¥è¯¢è¡¨ä¸­å¹´é¾„æœ€å°é‚£ä¸ªç”¨æˆ·çš„åå­—ï¼Œè¿™é‡Œä¸æ’é™¤å¹´é¾„æ˜¯é‡å¤çš„æƒ…å†µï¼Œå¦‚ä¸‹ï¼š\n1  select username from TableName order by age desc limit 1;   ä¸Šé¢å°±æ˜¯å¯¹ ageè¿›è¡Œé™åºç„¶åå–ä¸€æ¡æ•°æ®ã€‚\n1  select * from TableName order by age ASC;   å¯¹è¡¨è¿›è¡ŒæŒ‰ç…§ageå‡åºæ’åºæ•´ç†è¾“å‡ºç»“æœã€‚\nlimitæ”¯æŒå‡ ç§æ–¹å¼ï¼Œlimit 2,5æ„æ€æ˜¯ä»ç¬¬2è¡Œå¼€å§‹ï¼Œå¾€åæŸ¥è¯¢5æ¡æ•°æ®ï¼Œlimit 2 offset 3æ„æ€æ˜¯ä»3å¼€å§‹å¾€åæŸ¥è¯¢2æ¡æ•°æ®ã€‚\næœ‰æ—¶å€™æˆ‘ä»¬æŸ¥è¯¢éœ€è¦ä½¿ç”¨è¿ç®—ç¬¦ï¼Œsqlä¹Ÿæ˜¯æ”¯æŒè¿ç®—ç¬¦çš„\u0026lt;ã€\u0026gt;ã€\u0026lt;\u0026gt;ã€\u0026lt;=ã€\u0026gt;=ã€!\u0026lt;ã€!\u0026gt;ï¼Œè¿™äº›éƒ½å¯ä»¥åŠ åœ¨æ¡ä»¶è¯­å¥ä¸­ã€‚\nå­—æ®µç±»å‹ä¹Ÿæ”¯æŒæ•°å­¦è¿ç®—ä¾‹å¦‚ï¼š\n1  select * from TableName where (age+10) = 32;   ä¸Šé¢ä¸€æ¡è¯­å¥å°±æ˜¯æŸ¥è¯¢ageåŠ 10ä»¥åç­‰äº32çš„æ•°æ®ã€‚\næœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦å¯¹è¿™ä¸ªè¡¨è¿›è¡Œå¤šä¸ªæ¡ä»¶é™åˆ¶æŸ¥è¯¢ï¼Œæˆ‘ä»¬å¯èƒ½å°±éœ€è¦ä½¿ç”¨åˆ°ORæˆ–è€…ANDè¿›è¡Œæ¡ä»¶å…³è”æŸ¥è¯¢äº†ï¼Œä¾‹å¦‚ï¼š\n1 2 3 4  select users.mobile, user_address.mobile as \u0026#34;ç”¨æˆ·è®¢å•æ‰‹æœºå·\u0026#34;, user_address.address from user_address, users where user_address.user_id = users.user_id;   ä¸Šé¢è¿™ä¸ªå¤šè¡¨å…³è”æŸ¥è¯¢äº†ï¼Œæ¡ä»¶æ˜¯user_addressè¡¨çš„idè¦å’Œusersè¡¨çš„idç›¸ç­‰çš„æ•°æ®æŸ¥è¯¢å‡ºæ¥ã€‚\nå¤šä¸ªæ¡ä»¶å¯ä»¥ä½¿ç”¨andå…³è”èµ·æ¥ç»„æˆä¸€ä¸ªæ¡ä»¶ï¼Œä¾‹å¦‚ï¼š\n1  select BookName as ä¹¦å,Price as ä»·æ ¼, Writer AS ä½œè€… from bookinfo WHERE MONTH(pDate)=9 and YEAR(pDate)=2021;   æŸ¥è¯¢å›¾ä¹¦è¡¨é‡Œé¢çš„å‡ºç‰ˆæœˆä»½æ˜¯9æœˆçš„å¹¶ä¸”æ˜¯2021å¹´çš„9æœˆå‡ºç‰ˆçš„å›¾ä¹¦ä¿¡æ¯ã€‚\n1  select * from TableName where username = \u0026#39;Leon Ding\u0026#39; or age = 22;   ä¸Šé¢ä½¿ç”¨oræ»¡è¶³ä»»æ„ä¸€è¾¹æ¡ä»¶å³å¯å°±èƒ½æŸ¥è¯¢åˆ°æ•°æ®ã€‚\nè¿˜æœ‰ä¸€ç§å°±æ˜¯æŸ¥è¯¢åœ¨æŸä¸ªèŒƒå›´å†…çš„æ•°æ®ï¼Œä¾‹å¦‚ï¼š\n1 2 3  select * from goods where cost_price between 1099 and 2880;   ä¸Šé¢å°±æ˜¯æŸ¥è¯¢æˆæœ¬ä»·åœ¨1099-2880ä¹‹é—´çš„å•†å“ä¿¡æ¯ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨notæ”¾åœ¨betweenå‰é¢ï¼Œä¹Ÿå°±æ˜¯å–åçš„æ„æ€ã€‚\nå¤šä¸ªæ¡ä»¶æˆ–è€…é€šè¿‡å¤šä¸ªç±»å‹æ¥æŸ¥è¯¢å¯ä»¥ä½¿ç”¨inå…³é”®å­—ï¼Œä¾‹å¦‚ï¼š\n1  select * from TableName age in (22,18);   ä¸Šé¢æ˜¯æŸ¥å¹´é¾„æ˜¯22å’Œ18çš„ç”¨æˆ·ä¿¡æ¯ã€‚\n","date":"Sep 21","permalink":"http://blog.ibyte.me/post/often-used-structured-query-languages/","tags":null,"title":"Often Used Structured Query Languages"},{"categories":null,"contents":"ç›¸ä¿¡å¤§å®¶åœ¨å¼€å‘çš„è¿‡ç¨‹ä¸­ä¼šå»ç¼–å†™ä¸€äº›æ•°æ®åº“è¡¨å¯¹åº”çš„modelï¼Œå·¥ä½œæ¯”è¾ƒé‡å¤å¹¶ä¸”ä½æ•ˆï¼Œæœ¬æ–‡å°†ä»‹ç»ç¬”è€…å†™çš„ä¸€ä¸ªå·¥å…·å¯ä»¥æ ¹æ®æ•°æ®åº“è¡¨ç”Ÿäº§å¯¹åº”çš„modelé€†å‘å·¥ç¨‹å·¥å…·ã€‚\n   ä»€ä¹ˆæ˜¯s2sï¼Ÿ  s2s (sql to structure)æ˜¯ä¸€æ¬¾å‘½ä»¤è¡Œæ•°æ®åº“é€†å‘å·¥ç¨‹å·¥å…·ï¼Œå®ƒå¯ä»¥é€šè¿‡æ•°æ®åº“è¡¨ç”Ÿæˆå¯¹åº”çš„Javaã€Goã€Rustç»“æ„ä½“ï¼ˆclassï¼‰ï¼Œåé¢å°†é™†ç»­æ”¯æŒæ›´å¤šçš„è¯­è¨€ã€‚\n   é…ç½®æ•°æ®åº“æº  s2sä¾èµ–äºä½ çš„æ•°æ®åº“ï¼Œæ‰€ä»¥éœ€è¦ä½ é…ç½®å¥½ä½ çš„æ•°æ®åº“è¿æ¥ä¿¡æ¯ï¼Œä»¥ä¾¿s2sä¼šæ­£å¸¸çš„è¿è¡Œã€‚é…ç½®ä¿¡æ¯æ–¹æ³•å¾ˆç®€å•ä½ åªéœ€è¦åœ¨ä½ çš„ç¯å¢ƒå˜é‡ä¸­åŠ å…¥ä»¥ä¸‹ä¿¡æ¯å³å¯ã€‚\næ¨èä½¿ç”¨å¼€å‘ç¯å¢ƒçš„ä¸‹çš„rootç”¨æˆ·ç™»å½•ï¼Œå› ä¸ºå·¥å…·éœ€è¦information_schemaè¡¨çš„æƒé™ã€‚\n1 2 3 4 5  #s2s å‘½ä»¤çš„æ•°æ®åº“ä¿¡æ¯ export s2s_host=\u0026#34;127.0.0.1:3306\u0026#34; export s2s_user=\u0026#34;root\u0026#34; export s2s_pwd=\u0026#34;you db password\u0026#34; export s2s_charset=\u0026#34;utf8\u0026#34;   windowsçš„é…ç½®æ­¤ç”µè„‘-\u0026gt;å±æ€§-\u0026gt;é«˜çº§ç³»ç»Ÿè®¾ç½®-\u0026gt;ç¯å¢ƒå˜é‡ï¼ŒMacå’ŒLinuxåˆ™åœ¨~/.profileæˆ–è€…~/.zshrcä¸­æ·»åŠ ä»¥ä¸Šé…ç½®ä¿¡æ¯å³å¯ã€‚\n   ä½¿ç”¨æ–¹æ³•    ä½ å¯ä»¥å…‹éš†ä¸‹è½½æœ¬ä»£ç åº“ï¼Œç„¶åå¦‚æœä½ çš„ç”µè„‘ä¸Šå·²ç»å®‰è£…å¥½äº†goçš„ç¼–è¯‘å™¨é‚£ä¹ˆå°±è¿›å…¥ä¸»ç›®å½•å³å¯ä½¿ç”¨go buildå‘½ä»¤ç¼–è¯‘ç”ŸæˆäºŒè¿›åˆ¶ç¨‹åºæ–‡ä»¶ã€‚\n  å¦‚æœä½ è§‰å¾—éº»çƒ¦å³å¯åœ¨ä¸‹é¢åˆ—è¡¨ä¸­æ‰¾åˆ°ä½ å¯¹åº”çš„å¹³å°æ¶æ„ä¸‹è½½å¯¹åº”çš„äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶åˆ°ç”µè„‘ä¸Šï¼Œå¦‚æœä½ æƒ³åœ¨ç³»ç»Ÿä¸Šéšæ„è°ƒç”¨ä½ åˆ™åªéœ€è¦æŠŠs2sçš„å®‰è£…ç›®å½•æ”¾å…¥ä½ çš„ç¯å¢ƒå˜é‡ä¸­ã€‚\n  ç›®å‰å¯¹Rustéƒ¨åˆ†æ•°æ®ç±»å‹æ”¯æŒä¸å¤Ÿå‹å¥½ï¼Œä¸è¿‡ä¸è€½è¯¯ä½¿ç”¨ï¼Œç›®å‰è¢«ç”Ÿæˆçš„æ•°æ®åº“è¡¨åæ ¼å¼å¿…é¡»ä¸ºuser_infoè¿™æ ·çš„snake caseè¿™ç§æ ¼å¼ï¼ï¼åé¢ä¼šè€ƒè™‘ä¿®å¤è¿™ä¸ªbugã€‚\n     å¹³å° åœ°å€     Windows-x64 s2s-windows-x64.zip   Mac-x64 s2s-darwin-x64.zip   Linux-64 s2s-linux-x64.zip       å†…ç½®å‘½ä»¤  PS: åœ¨å‘½ä»¤è¡Œæ¨¡å¼ä¸‹æŒ‰ä¸‹tabé”®ä¼šæœ‰å‘½ä»¤è¡¥å…¨æç¤ºï¼\n   å‘½ä»¤ ä½¿ç”¨æ–¹æ³•     databases æ˜¾ç¤ºæ‰€æœ‰æ•°æ®åº“å   use æŒ‡å®šä½¿ç”¨å“ªä¸ªæ•°æ®åº“   tables æ˜¾ç¤ºå½“å‰æ•°æ®åº“æ‰€æœ‰è¡¨   gen ç”ŸæˆæŒ‡å®šçš„è¡¨ï¼Œgen è¡¨å   info æ˜¾ç¤ºæ•°æ®åº“æ‰€æœ‰ä¿¡æ¯   exit é€€å‡ºå‘½ä»¤è¡Œæ¨¡å¼   clear æ¸…ç†å±å¹•å†…å®¹    ä½¿ç”¨æ¡ˆä¾‹\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146  $:\u0026gt; s2s java ______ .-----.|__ |.-----. |__ --|| __||__ --| |_____||______||_____| ğŸ¥³: You have entered the command line mode! ğŸ¥³: Press the \u0026#39;tab\u0026#39; key to get a promptï¼ ğŸ¥³: Enter `exit` to exit the program! ğŸ˜ƒ:s2s\u0026gt;databases +---+--------------------+ | * | Database | +---+--------------------+ | 1 | information_schema | | 2 | emp_db | | 3 | mysql | | 4 | performance_schema | | 5 | sys | | 6 | test_db | +---+--------------------+ ğŸ˜ƒ:s2s\u0026gt;use emp_db ğŸ¤–â€: Selected as database ğŸ‘‰ `emp_db`ï¼ ğŸ˜ƒ:s2s\u0026gt;tables +---+-----------+ | * | Tables | +---+-----------+ | 1 | user_info | +---+-----------+ ğŸ˜ƒ:s2s\u0026gt;gen user_info package model import java.sql.Timestamp; import java.math.BigDecimal; import java.math.BigInteger; public class UserInfo { // ç”¨æˆ·è´¦å·  private String Account; // ç”¨æˆ·åˆ›å»ºæ—¶é—´  private Timestamp CreateTime; // ç”¨æˆ·æ›´æ–°æ—¶é—´  private Timestamp UpdatedDate; // ç”¨æˆ·å¹´é¾„  private short Age; // ç”¨æˆ·ä½™é¢  private BigDecimal Money; // ç”¨æˆ·ID  private BigInteger Uid; public String getAccount() { return Account; } public void setAccount(String Account) { this.Account = Account; } public Timestamp getCreateTime() { return CreateTime; } public void setCreateTime(Timestamp CreateTime) { this.CreateTime = CreateTime; } public Timestamp getUpdatedDate() { return UpdatedDate; } public void setUpdatedDate(Timestamp UpdatedDate) { this.UpdatedDate = UpdatedDate; } public short getAge() { return Age; } public void setAge(short Age) { this.Age = Age; } public BigDecimal getMoney() { return Money; } public void setMoney(BigDecimal Money) { this.Money = Money; } public BigInteger getUid() { return Uid; } public void setUid(BigInteger Uid) { this.Uid = Uid; } @Override public String toString() { return \u0026#34;user_info{\u0026#34; + \u0026#34;Account=\u0026#34; + Account + \u0026#34;,\u0026#34;+ \u0026#34;CreateTime=\u0026#34; + CreateTime + \u0026#34;,\u0026#34;+ \u0026#34;UpdatedData=\u0026#34; + UpdatedDate + \u0026#34;,\u0026#34;+ \u0026#34;Age=\u0026#34; + Age + \u0026#34;,\u0026#34;+ \u0026#34;Money=\u0026#34; + Money + \u0026#34;,\u0026#34;+ \u0026#34;Uid=\u0026#34; + Uid + \u0026#34;,\u0026#34;+ \u0026#34;}\u0026#34;; } } ğŸ˜ƒ:s2s\u0026gt;exit ğŸ¤–â€: ByeğŸ‘‹ :)      å¯¼å…¥åŒ…  æœ¬åº“æ”¯æŒä½ äºŒæ¬¡å¼€å‘ä½¿ç”¨ï¼Œä½ åªéœ€è¦å¯¼å…¥æœ¬åŒ…å³å¯åœ¨ä½ çš„ä»£ç ä¸­è¿›è¡Œæ‰©å……å¼€å‘ï¼Œä½†æ˜¯ç›®å‰ä»…æ”¯æŒgoè¯­è¨€ï¼\n ä¸‹è½½  1  go get -u github.com/higker/s2s   å¯¼å…¥å¹¶ä¸”ä½¿ç”¨  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35  package main import ( \u0026#34;github.com/higker/s2s/core/lang/java\u0026#34; \u0026#34;github.com/higker/s2s/core/db\u0026#34; ) func main() { // åˆ›å»ºä¸€ä¸ªJavaçš„ä»£ç ç”Ÿæˆå™¨  structure := java.New() // æ•°æ®åº“è¿æ¥ä¿¡æ¯  if err := structure.OpenDB( \u0026amp;db.Info{ HostIPAndPort: os.Getenv(\u0026#34;s2s_host\u0026#34;), // æ•°æ®åº“IP  UserName: os.Getenv(\u0026#34;s2s_user\u0026#34;), // æ•°æ®åº“ç”¨æˆ·å  Password: os.Getenv(\u0026#34;s2s_pwd\u0026#34;), // æ•°æ®åº“å¯†ç   Type: db.MySQL, // æ•°æ®åº“ç±»å‹ PostgreSQL Oracle  Charset: os.Getenv(\u0026#34;s2s_charset\u0026#34;), }, ); err != nil { // Failed to establish a connection to the database!  // .... logic code  } defer structure.Close() structure.SetSchema(\u0026#34;é€‰æ‹©æ•°æ®åº“å\u0026#34;) // å®ç°äº†io.Writerå³å¯  structure.Parse(os.Stdout,\u0026#34;è¡¨å\u0026#34;) }      å…¶ä»–  ç›®å‰ä»…æ”¯æŒmysqlæ•°æ®åº“ï¼Œå¦‚æœæœ‰æƒ³è´¡çŒ®ä»£ç æissuesï¼è·Ÿå¤šéœ€æ±‚ï¼š 1. æ”¯æŒlinuxç®¡é“å‘½ä»¤è¿™æ ·å°±å¯ä»¥å¯ç¼–ç¨‹æ“ä½œäº†ï¼Œå‰é¢ä¸€ä¸ªè¾“å‡ºå°±æ˜¯åé¢ä¸€ä¸ªç¨‹åºçš„è¾“å…¥ã€‚\n å¯ä»¥å¸®å¿™ç‚¹ä¸€ä¸ªstarâœ¨è°¢è°¢ï¼ï¼ï¼ https://github.com/auula/s2s  ","date":"Sep 16","permalink":"http://blog.ibyte.me/post/golang-database-reverse-engineering/","tags":null,"title":"Golang Database Reverse Engineering"},{"categories":null,"contents":"   lifetimeå¯¿å‘½  Rustä¸­çš„æ¯ä¸€ä¸ªå¼•ç”¨éƒ½æœ‰ä¸€ä¸ªæœ‰æ•ˆçš„ä½œç”¨åŸŸï¼Œç”Ÿå‘½å‘¨æœŸå°±æ˜¯ä¸ºè¿™ä¸ªä½œç”¨åŸŸæœåŠ¡çš„ï¼Œå¤§éƒ¨åˆ†ç”Ÿå‘½å‘¨æœŸç¼–è¯‘å™¨å¯ä»¥æ¨æ–­å‡ºæ¥ï¼Œå¯ä»¥æ˜¯éšå¼çš„ã€‚ä½†æ˜¯å¦‚æœåœ¨æŸäº›æƒ…å†µä¸‹ç¼–è¯‘å™¨å°±æ— æ³•æ­£å¸¸æ¨æ–­å‡ºæ¥äº†ï¼Œéœ€è¦æˆ‘ä»¬è‡ªå·±æ‰‹åŠ¨æ ‡æ³¨ï¼Œæ ‡æ³¨ç”Ÿå‘½å‘¨æœŸè¯­æ³•å°±æ˜¯'aè¿™æ ·çš„è¯­æ³•ã€‚\n   ä¸ºä»€ä¹ˆéœ€è¦ç”Ÿå‘½å‘¨æœŸï¼Ÿ  ä¾‹å¦‚ä¸‹é¢ä¾‹å­å°±æ˜¯åœ¨ä¸¤ä¸ªå­—ç¬¦ä¸²åˆ‡ç‰‡é‡Œé¢æŸ¥æ‰¾æœ€é•¿çš„é‚£ä¸ªå¹¶ä¸”è¿”å›ï¼\n1 2 3 4 5 6 7 8  // \u0026#39;a æ˜¯æŒ‡3ä¸ªå¼•ç”¨çš„ä½œç”¨åŸŸç”Ÿå‘½å‘¨æœŸè¦ä¸€è‡´ fn find_long_str\u0026lt;\u0026#39;a\u0026gt;(x: \u0026amp;\u0026#39;astr,y: \u0026amp;\u0026#39;astr)-\u0026gt; \u0026amp;\u0026#39;astr{ifx.len()\u0026gt;y.len(){x}else{y}}  ä¸Šé¢æˆ‘å°±åŠ æ³¨äº†ç”Ÿå‘½å‘¨æœŸæ ‡è¯†ç¬¦ï¼Œå¦‚æœä¸åŠ ç¼–è¯‘å™¨ä¼šæŠ¥é”™ï¼ŒåŸå› æ˜¯å› ä¸ºæˆ‘ä»¬è¿™ä¸ªå‡½æ•°å¼•ç”¨çš„æ˜¯å¤–éƒ¨çš„å˜é‡ï¼Œä¸èƒ½ç¡®å®šå¼•ç”¨çš„å˜é‡æ˜¯å¦å·²ç»è¢«é”€æ¯äº†ï¼Œé‚£è¿™æ ·å°±æ˜¯æ‚¬å‚å¼•ç”¨ï¼\n1 2 3 4 5 6 7 8 9 10  letstr1=String::from(\u0026#34;Hello\u0026#34;);letstr2;letresult;{//let str2 = String::from(\u0026#34; World!\u0026#34;); str2=String::from(\u0026#34; World!\u0026#34;);result=find_long_str(str1.as_str(),\u0026amp;str2);}// è¿™é‡Œå€Ÿç”¨æ£€æµ‹å°±æç¤º å¼•ç”¨äº†å·²ç»é”€æ¯çš„èµ„æºäº† println!(\u0026#34;{}\u0026#34;,result);  åŠ äº†ç”Ÿå‘½å‘¨æœŸæ ‡è¯†ç¬¦ä¹‹åï¼Œå¦‚æœæˆ‘æŠŠlet str2 = String::from(\u0026quot; World!\u0026quot;);å–æ¶ˆæ³¨é‡Šæ”¾åœ¨ä¸€ä¸ªå†…éƒ¨ä½œç”¨åŸŸé‡Œé¢å®šä¹‰ï¼Œé‚£ä¹ˆè¿™æ—¶è°ƒç”¨ find_long_strç¼–è¯‘å™¨å°±ä¼šæŠ¥é”™ï¼Œå› ä¸ºæˆ‘åœ¨ä¸‹é¢å‡ºäº†ä½œç”¨åŸŸè¿˜ä½¿ç”¨äº†find_long_strè¿”å›çš„ç»“æœï¼Œè€Œè¿™ä¸ªç»“æœå¯èƒ½å°±æ˜¯str2çš„å†…å®¹ï¼Œ ä½¿ç”¨è¿™ä¸ªæ˜¯è¿åäº†æ‰€æœ‰æƒè§„åˆ™çš„ï¼Œstr2ç¦»å¼€å†…éƒ¨ä½œç”¨åŸŸå°±è¢«é”€æ¯äº†ã€‚\nåœ¨æ ‡æ³¨ç”Ÿå‘½å‘¨æœŸfn find_long_str\u0026lt;'a\u0026gt;(x: \u0026amp;'a str, y: \u0026amp;'a str) -\u0026gt; \u0026amp;'a strä¹‹åç¼–è¯‘å™¨å°±çŸ¥é“è¾“å…¥å‚æ•°å’Œè¿”å›å‚æ•°ç”Ÿå‘½å‘¨æœŸæ˜¯è¦ä¸€è‡´çš„ï¼Œå¹¶ä¸”è¿”å›å€¼ç”Ÿå‘½å‘¨æœŸè‚¯å®šæ˜¯å–ç”Ÿå‘½å‘¨æœŸæœ€çŸ­çš„é‚£ä¸ªçš„ã€‚\n   æ€»ç»“   ç”Ÿå‘½å‘¨æœŸæ˜¯ç¡®ä¿è¢«å¼•ç”¨çš„å€¼æ˜¯æœ‰æ•ˆçš„ã€‚ å¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸè‚¯å®šæ˜¯å°äºæˆ–è€…ç­‰äºèµ„æºæ‰€æœ‰è€…çš„ã€‚ å¦‚æœæ˜¯åœ¨å‡½æ•°é‡Œé¢åˆ›å»ºçš„èµ„æºï¼Œåº”è¯¥æ˜¯ç›´æ¥è¿”å›å…¶æ‰€æœ‰æƒï¼Œè€Œä¸æ˜¯å¼•ç”¨ã€‚ æ¯ä¸ªç”Ÿå‘½å‘¨æœŸæ ‡æ³¨éƒ½æœ‰ä¸åŒçš„ç”Ÿå‘½å‘¨æœŸï¼Œå¦‚æœæœ‰è¾“å…¥çš„ç”Ÿå‘½å‘¨æœŸï¼Œé‚£ä¹ˆè¾“å‡ºçš„ç”Ÿå‘½å‘¨æœŸä¹Ÿæ˜¯ä¸€è‡´çš„ã€‚ selfçš„ç”Ÿå‘½å‘¨æœŸä¼šè¢«èµ‹ç»™è¾“å‡ºçš„ç”Ÿå‘½å‘¨æœŸã€‚     å…¶ä»–   å½“ç„¶ä¸Šé¢æ˜¯æˆ‘åˆšåˆšå…¥å‘æ€»ç»“è¯ï¼Œæœ‰é”™è¯¯åœ°æ–¹æœ›å¤§ä½¬æŒ‡æ•™ï¼ https://play.rust-lang.org/?version=stable\u0026amp;mode=debug\u0026amp;edition=2018\u0026amp;gist=a868aa030fa934b22cd770727f42724d  ","date":"Sep 16","permalink":"http://blog.ibyte.me/post/rust-lifetime/","tags":null,"title":"Rust Lifetime"},{"categories":null,"contents":"   ä»€ä¹ˆæ˜¯æ™ºèƒ½æŒ‡é’ˆï¼Ÿ  åœ¨Rustä¸­æ™ºèƒ½æŒ‡é’ˆæœ‰å¾ˆå¤šç§ï¼Œç”¨å¤§ç™½è¯è¯´å°±æ˜¯ä¸€ä¸ªæ•°æ®ç»“æ„ï¼Œå®ç°äº†ä¸€äº›ç‰¹æ®Šçš„traitä»è€Œè¾¾åˆ°æŸç§ç‰¹æ€§å’ŒåŠŸèƒ½ï¼Œç„¶åå»ç®¡ç†æŸå—å†…å­˜ä¸Šçš„æ•°æ®ï¼Œç›¸å½“äºä¸€ä¸ªç›’å­ä¸€æ ·åŒ…è£…ä¸€å±‚ï¼Œè¿™ç¯‡æ–‡ç« å°†ä»‹ç»ä¸€ä¸‹Boxã€‚\n   Deref  Derefè¿™ä¸ªtraitåªè¦å®ç°äº†å®ƒé‚£ä¹ˆä½ è‡ªå®šä¹‰çš„ç»“æ„ä½“ï¼Œå°±å¯ä»¥ä½¿ç”¨*è§£å¼•ç”¨æ‹¿å–ä½ ç»“æ„ä½“é‡Œé¢æ‰€åŒ…è£…çš„æ•°æ®ï¼Œç†Ÿæ‚‰Rustéƒ½çŸ¥é“*æ˜¯ç”¨æ¥è§£å¼•ç”¨çš„ï¼Œä¸‹é¢çš„I32Box(i32)å°±æ˜¯å®ç°äº†Derefä»è€Œè¾¾åˆ°ç›´æ¥ä½¿ç”¨*æ‹¿å–å‡ºå†…éƒ¨çš„æ•°æ®ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23  usestd::ops::Deref;struct I32Box(i32);// impl Deref implDerefforI32Box{type Target=i32;fn deref(\u0026amp;self)-\u0026gt; \u0026amp;Self::Target{\u0026amp;self.0}}implI32Box{fn new(v:i32)-\u0026gt; Self{I32Box(v)}}fn main(){letn=I32Box::new(1024_i32);println!(\u0026#34;{}\u0026#34;,*n);}     Drop  Rusté‡Œé¢æœ‰dropå‡½æ•°ï¼Œä¹Ÿæœ‰ä¸€ä¸ªDropçš„traitåŒæ ·å¦‚æœè‡ªå®šä¹‰çš„ç»“æ„ä½“å®ç°è¿™ä¸ªDropï¼Œé‚£ä¹ˆå°±ä½ å˜é‡ç¦»å¼€ä½œç”¨åŸŸçš„æ—¶å€™æ‰§è¡Œè‡ªå®šä¹‰Dropçš„æ–¹æ³•çš„é€»è¾‘ã€‚\n1 2 3 4 5  implDropforI32Box{fn drop(\u0026amp;mutself){println!(\u0026#34;å•Šï¼ŒæŒ‚äº†ï¼ŒI32Box({:?})è¢«æ¸…ç†äº†ï¼\u0026#34;,self.0)}}  ä¾‹å¦‚ä¸ºI32Boxå®ç°Dropçš„dropå‡½æ•°ï¼Œè¿è¡Œï¼š\n1 2 3 4 5 6 7  Compiling playground v0.0.1 (/playground) Finished dev [unoptimized + debuginfo] target(s) in 1.33s Running `target/debug/playground` 1024 å•Šï¼ŒæŒ‚äº†ï¼ŒI32Box(1024)è¢«æ¸…ç†äº†ï¼   å½“I32Boxç¦»å¼€è‡ªå·±çš„ä½œç”¨åŸŸé‚£ä¹ˆå®ƒä¼šè‡ªåŠ¨æ‰§è¡Œdropæ–¹æ³•ã€‚\n   Box  æœ‰äº†è¿™äº›ç‰¹æ®Šçš„traitåŸºç¡€ä¹‹åï¼Œæ™ºèƒ½æŒ‡é’ˆå°±è‡ªèº«æœ‰äº†è¿™ç§è¡Œä¸ºäº†ï¼Œå°±èƒ½ç®¡ç†å†…éƒ¨çš„æ•°æ®äº†ã€‚\nBoxæ™ºèƒ½æŒ‡é’ˆå®ƒç®¡ç†çš„æ•°æ®ï¼Œå†…å­˜æ˜¯åˆ†é…åœ¨heapä¸Šçš„ï¼Œå¯ä»¥åœ¨å †ä¸Šå­˜å‚¨æˆ‘ä»¬è‡ªå®šä¹‰çš„çš„æ•°æ®ï¼Œè€ŒæŠŠæŒ‡é’ˆæ”¾åœ¨æ ˆä¸Šã€‚æœ‰è¿™äº›ç‰¹æ€§ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨Boxå®ç°ä¸€ä¸ªç±»ä¼¼åŠ¨æ€æ•°ç»„çš„æ•°æ®ç»“æ„ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46  #[derive(Debug)]struct DynamicArr{cap:i32,len:i32,data:Box\u0026lt;[i32]\u0026gt;,}implDynamicArr{fn new()-\u0026gt; DynamicArr{DynamicArr{cap:10,len:0,data: Box::new([0;10]),}}fn push(\u0026amp;mutself,v:i32){// expansion ifself.len==self.cap{// add 10 capacity letmutnew_arr=Box::new([0;20]);letmutindex=0;forvinself.data.iter(){new_arr[index]=*v;index+=1;}self.data=new_arr;self.cap+=indexasi32;}self.data[self.lenasusize]=v;self.len+=1;}}fn main(){letmutarr=DynamicArr::new();forvin0..16{arr.push(v);}println!(\u0026#34;{:#?}\u0026#34;,arr)}  ä¾‹å¦‚ä¸Šé¢é€šè¿‡Boxæ™ºèƒ½æŒ‡é’ˆå®ç°ä¸€ä¸ªè‡ªå®šä¹‰DynamicArrç»“æ„ï¼Œå®ƒåœ¨æˆ‘ä»¬æ·»åŠ æ•°ç»„çš„æ—¶å€™ä¼šæ£€æŸ¥å®¹é‡ï¼Œå½“è¾¾åˆ°é˜ˆå€¼å°±ä¼šå‘ç”Ÿexpansionï¼Œä¸Šé¢åªæ˜¯ä¸ªå°demoï¼Œè¿˜æœ‰bugï¼Œåªæ˜¯ä¸ºäº†æ¼”ç¤ºBoxæ™ºèƒ½æŒ‡é’ˆçš„ä½¿ç”¨ã€‚\n   å…¶ä»–   I32Box DynamicArr  ","date":"Sep 16","permalink":"http://blog.ibyte.me/post/rust-box-pointer/","tags":null,"title":"Rust Box Pointer"},{"categories":null,"contents":"   å‰ è¨€   åœ¨å¼€å‘é«˜å¹¶å‘ç³»ç»Ÿæ—¶ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šé‡åˆ°æ¥å£è®¿é—®é¢‘æ¬¡è¿‡é«˜ï¼Œä¸ºäº†ä¿è¯ç³»ç»Ÿçš„é«˜å¯ç”¨å’Œç¨³å®šæ€§ï¼Œè¿™æ—¶å€™å°±éœ€è¦åšæµé‡é™åˆ¶ï¼Œä½ å¯èƒ½æ˜¯ç”¨çš„ Nginx è¿™ç§ Web Server æ¥æ§åˆ¶è¯·æ±‚ï¼Œä¹Ÿå¯èƒ½æ˜¯ç”¨äº†ä¸€äº›æµè¡Œçš„ç±»åº“å®ç°ã€‚é™æµæ˜¯é«˜å¹¶å‘ç³»ç»Ÿçš„ä¸€å¤§æ€å™¨ï¼Œåœ¨è®¾è®¡é™æµç®—æ³•ä¹‹å‰æˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹å®ƒä»¬æ˜¯ä»€ä¹ˆã€‚\n    é™ æµ  é™æµçš„ç›®çš„æ˜¯é€šè¿‡å¯¹å¹¶å‘è®¿é—®è¯·æ±‚è¿›è¡Œé™é€Ÿï¼Œæˆ–è€…å¯¹ä¸€ä¸ªæ—¶é—´çª—å£å†…çš„è¯·æ±‚è¿›è¡Œé™é€Ÿæ¥ä¿æŠ¤ç³»ç»Ÿï¼Œä¸€æ—¦è¾¾åˆ°é™åˆ¶é€Ÿç‡åˆ™å¯ä»¥æ‹’ç»æœåŠ¡ã€æ’é˜Ÿæˆ–ç­‰å¾…ã€é™çº§ç­‰å¤„ç†ã€‚é€šè¿‡å¯¹å¹¶å‘ï¼ˆæˆ–è€…ä¸€å®šæ—¶é—´çª—å£å†…ï¼‰è¯·æ±‚è¿›è¡Œé™é€Ÿæ¥ä¿æŠ¤ç³»ç»Ÿï¼Œä¸€æ—¦è¾¾åˆ°é™åˆ¶é€Ÿç‡åˆ™æ‹’ç»æœåŠ¡ï¼ˆå®šå‘åˆ°é”™è¯¯é¡µæˆ–å‘ŠçŸ¥èµ„æºæ²¡æœ‰äº†ï¼‰ã€æ’é˜Ÿç­‰å¾…ï¼ˆæ¯”å¦‚ç§’æ€ã€è¯„è®ºã€ä¸‹å•ï¼‰ã€é™çº§ï¼ˆè¿”å›å…œåº•æ•°æ®æˆ–é»˜è®¤æ•°æ®ï¼‰ã€‚\nå¦‚ å›¾:\nå¦‚å›¾ä¸Šçš„æ¼«ç”»ï¼Œåœ¨æŸä¸ªæ—¶é—´æ®µæµé‡ä¸Šæ¥äº†ï¼ŒæœåŠ¡çš„æ¥å£è®¿é—®é¢‘ç‡å¯èƒ½ä¼šéå¸¸å¿«ï¼Œå¦‚æœæˆ‘ä»¬æ²¡æœ‰å¯¹æ¥å£è®¿é—®é¢‘æ¬¡åšé™åˆ¶å¯èƒ½ä¼šå¯¼è‡´æœåŠ¡å™¨æ— æ³•æ‰¿å—è¿‡é«˜çš„å‹åŠ›æŒ‚æ‰ï¼Œè¿™æ—¶å€™ä¹Ÿå¯èƒ½ä¼šäº§ç”Ÿæ•°æ®ä¸¢å¤±ï¼Œæ‰€ä»¥å°±è¦å¯¹å…¶è¿›è¡Œé™æµå¤„ç†ã€‚\né™æµç®—æ³•å°±å¯ä»¥å¸®åŠ©æˆ‘ä»¬å»æ§åˆ¶æ¯ä¸ªæ¥å£æˆ–ç¨‹åºçš„å‡½æ•°è¢«è°ƒç”¨é¢‘ç‡ï¼Œå®ƒæœ‰ç‚¹å„¿åƒä¿é™©ä¸ï¼Œé˜²æ­¢ç³»ç»Ÿå› ä¸ºè¶…è¿‡è®¿é—®é¢‘ç‡æˆ–å¹¶å‘é‡è€Œå¼•èµ·ç˜«ç—ªã€‚æˆ‘ä»¬å¯èƒ½åœ¨è°ƒç”¨æŸäº›ç¬¬ä¸‰æ–¹çš„æ¥å£çš„æ—¶å€™ä¼šçœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„å“åº”å¤´ï¼š\n1 2 3  X-RateLimit-Limit:60//æ¯ç§’60æ¬¡è¯·æ±‚X-RateLimit-Remaining:22//å½“å‰è¿˜å‰©ä¸‹å¤šå°‘æ¬¡X-RateLimit-Reset:1612184024//é™åˆ¶é‡ç½®æ—¶é—´  ä¸Šé¢çš„ HTTP Response æ˜¯é€šè¿‡å“åº”å¤´å‘Šè¯‰è°ƒç”¨æ–¹æœåŠ¡ç«¯çš„é™æµé¢‘æ¬¡æ˜¯æ€æ ·çš„ï¼Œä¿è¯åç«¯çš„æ¥å£è®¿é—®ä¸Šé™ã€‚ä¸ºäº†è§£å†³é™æµé—®é¢˜å‡ºç°äº†å¾ˆå¤šçš„ç®—æ³•ï¼Œå®ƒä»¬éƒ½æœ‰ä¸åŒçš„ç”¨é€”ï¼Œé€šå¸¸çš„ç­–ç•¥å°±æ˜¯æ‹’ç»è¶…å‡ºçš„è¯·æ±‚ï¼Œæˆ–è€…è®©è¶…å‡ºçš„è¯·æ±‚æ’é˜Ÿç­‰å¾…ã€‚\nä¸€èˆ¬æ¥è¯´ï¼Œé™æµçš„å¸¸ç”¨å¤„ç†æ‰‹æ®µæœ‰ï¼š\n è®¡æ•°å™¨ æ»‘åŠ¨çª—å£ æ¼æ¡¶ ä»¤ç‰Œæ¡¶     è®¡æ•°å™¨   è®¡æ•°å™¨æ˜¯ä¸€ç§æœ€ç®€å•é™æµç®—æ³•ï¼Œå…¶åŸç†å°±æ˜¯ï¼šåœ¨ä¸€æ®µæ—¶é—´é—´éš”å†…ï¼Œå¯¹è¯·æ±‚è¿›è¡Œè®¡æ•°ï¼Œä¸é˜€å€¼è¿›è¡Œæ¯”è¾ƒåˆ¤æ–­æ˜¯å¦éœ€è¦é™æµï¼Œä¸€æ—¦åˆ°äº†æ—¶é—´ä¸´ç•Œç‚¹ï¼Œå°†è®¡æ•°å™¨æ¸…é›¶ã€‚ è¿™ä¸ªå°±åƒä½ å»åè½¦ä¸€æ ·ï¼Œè½¦å¢è§„å®šäº†å¤šå°‘ä¸ªä½ç½®ï¼Œæ»¡äº†å°±ä¸è®©ä¸Šè½¦äº†ï¼Œä¸ç„¶å°±æ˜¯è¶…è½½äº†ï¼Œè¢«äº¤è­¦å”å”æŠ“åˆ°äº†å°±è¦ç½šæ¬¾çš„ï¼Œå¦‚æœæˆ‘ä»¬çš„ç³»ç»Ÿé‚£å°±ä¸æ˜¯ç½šæ¬¾çš„äº‹æƒ…äº†ï¼Œå¯èƒ½ç›´æ¥å´©æ‰äº†ã€‚\n  å¯ä»¥åœ¨ç¨‹åºä¸­è®¾ç½®ä¸€ä¸ªå˜é‡ countï¼Œå½“è¿‡æ¥ä¸€ä¸ªè¯·æ±‚æˆ‘å°±å°†è¿™ä¸ªæ•° +1ï¼ŒåŒæ—¶è®°å½•è¯·æ±‚æ—¶é—´ã€‚ å½“ä¸‹ä¸€ä¸ªè¯·æ±‚æ¥çš„æ—¶å€™åˆ¤æ–­ count çš„è®¡æ•°å€¼æ˜¯å¦è¶…è¿‡è®¾å®šçš„é¢‘æ¬¡ï¼Œä»¥åŠå½“å‰è¯·æ±‚çš„æ—¶é—´å’Œç¬¬ä¸€æ¬¡è¯·æ±‚æ—¶é—´æ˜¯å¦åœ¨ 1 åˆ†é’Ÿå†…ã€‚ å¦‚æœåœ¨ 1 åˆ†é’Ÿå†…å¹¶ä¸”è¶…è¿‡è®¾å®šçš„é¢‘æ¬¡åˆ™è¯æ˜è¯·æ±‚è¿‡å¤šï¼Œåé¢çš„è¯·æ±‚å°±æ‹’ç»æ‰ã€‚ å¦‚æœè¯¥è¯·æ±‚ä¸ç¬¬ä¸€ä¸ªè¯·æ±‚çš„é—´éš”æ—¶é—´å¤§äºè®¡æ•°å‘¨æœŸï¼Œä¸” count å€¼è¿˜åœ¨é™æµèŒƒå›´å†…ï¼Œå°±é‡ç½® countã€‚  ä»£ç å®ç°:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66  package main import ( \u0026#34;log\u0026#34; \u0026#34;sync\u0026#34; \u0026#34;time\u0026#34; ) type Counter struct { rate int //è®¡æ•°å‘¨æœŸå†…æœ€å¤šå…è®¸çš„è¯·æ±‚æ•°  begin time.Time //è®¡æ•°å¼€å§‹æ—¶é—´  cycle time.Duration //è®¡æ•°å‘¨æœŸ  count int //è®¡æ•°å‘¨æœŸå†…ç´¯è®¡æ”¶åˆ°çš„è¯·æ±‚æ•°  lock sync.Mutex } func (l *Counter) Allow() bool { l.lock.Lock() defer l.lock.Unlock() if l.count == l.rate-1 { now := time.Now() if now.Sub(l.begin) \u0026gt;= l.cycle { //é€Ÿåº¦å…è®¸èŒƒå›´å†…ï¼Œ é‡ç½®è®¡æ•°å™¨  l.Reset(now) return true } else { return false } } else { //æ²¡æœ‰è¾¾åˆ°é€Ÿç‡é™åˆ¶ï¼Œè®¡æ•°åŠ 1  l.count++ return true } } func (l *Counter) Set(r int, cycle time.Duration) { l.rate = r l.begin = time.Now() l.cycle = cycle l.count = 0 } func (l *Counter) Reset(t time.Time) { l.begin = t l.count = 0 } func main() { var wg sync.WaitGroup var lr Counter lr.Set(3, time.Second) // 1så†…æœ€å¤šè¯·æ±‚3æ¬¡  for i := 0; i \u0026lt; 10; i++ { wg.Add(1) log.Println(\u0026#34;åˆ›å»ºè¯·æ±‚:\u0026#34;, i) go func(i int) { if lr.Allow() { log.Println(\u0026#34;å“åº”è¯·æ±‚:\u0026#34;, i) } wg.Done() }(i) time.Sleep(200 * time.Millisecond) } wg.Wait() }   OutPut:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15  2021/02/01 21:16:12 åˆ›å»ºè¯·æ±‚: 0 2021/02/01 21:16:12 å“åº”è¯·æ±‚: 0 2021/02/01 21:16:12 åˆ›å»ºè¯·æ±‚: 1 2021/02/01 21:16:12 å“åº”è¯·æ±‚: 1 2021/02/01 21:16:12 åˆ›å»ºè¯·æ±‚: 2 2021/02/01 21:16:13 åˆ›å»ºè¯·æ±‚: 3 2021/02/01 21:16:13 åˆ›å»ºè¯·æ±‚: 4 2021/02/01 21:16:13 åˆ›å»ºè¯·æ±‚: 5 2021/02/01 21:16:13 å“åº”è¯·æ±‚: 5 2021/02/01 21:16:13 åˆ›å»ºè¯·æ±‚: 6 2021/02/01 21:16:13 å“åº”è¯·æ±‚: 6 2021/02/01 21:16:13 åˆ›å»ºè¯·æ±‚: 7 2021/02/01 21:16:13 å“åº”è¯·æ±‚: 7 2021/02/01 21:16:14 åˆ›å»ºè¯·æ±‚: 8 2021/02/01 21:16:14 åˆ›å»ºè¯·æ±‚: 9   å¯ä»¥çœ‹åˆ°æˆ‘ä»¬è®¾ç½®çš„æ˜¯æ¯200msåˆ›å»ºä¸€ä¸ªè¯·æ±‚ï¼Œæ˜æ˜¾é«˜äº1ç§’æœ€å¤š3ä¸ªè¯·æ±‚çš„é™åˆ¶ï¼Œè¿è¡Œèµ·æ¥ä¹‹åå‘ç°ç¼–å·ä¸º 2ã€3ã€4ã€8ã€9 çš„è¯·æ±‚è¢«ä¸¢å¼ƒï¼Œè¯´æ˜é™æµæˆåŠŸã€‚\né‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå¦‚æœæœ‰ä¸ªéœ€æ±‚å¯¹äºæŸä¸ªæ¥å£ /query æ¯åˆ†é’Ÿæœ€å¤šå…è®¸è®¿é—® 200 æ¬¡ï¼Œå‡è®¾æœ‰ä¸ªç”¨æˆ·åœ¨ç¬¬ 59 ç§’çš„æœ€åå‡ æ¯«ç§’ç¬é—´å‘é€ 200 ä¸ªè¯·æ±‚ï¼Œå½“ 59 ç§’ç»“æŸå Counter æ¸…é›¶äº†ï¼Œä»–åœ¨ä¸‹ä¸€ç§’çš„æ—¶å€™åˆå‘é€ 200 ä¸ªè¯·æ±‚ã€‚é‚£ä¹ˆåœ¨ 1 ç§’é’Ÿå†…è¿™ä¸ªç”¨æˆ·å‘é€äº† 2 å€çš„è¯·æ±‚ï¼Œè¿™ä¸ªæ˜¯ç¬¦åˆæˆ‘ä»¬çš„è®¾è®¡é€»è¾‘çš„ï¼Œè¿™ä¹Ÿæ˜¯è®¡æ•°å™¨æ–¹æ³•çš„è®¾è®¡ç¼ºé™·ï¼Œç³»ç»Ÿå¯èƒ½ä¼šæ‰¿å—æ¶æ„ç”¨æˆ·çš„å¤§é‡è¯·æ±‚ï¼Œç”šè‡³å‡»ç©¿ç³»ç»Ÿã€‚\nå¦‚ä¸‹å›¾:\nè¿™ç§æ–¹æ³•è™½ç„¶ç®€å•ï¼Œä½†ä¹Ÿæœ‰ä¸ªå¤§é—®é¢˜å°±æ˜¯æ²¡æœ‰å¾ˆå¥½çš„å¤„ç†å•ä½æ—¶é—´çš„è¾¹ç•Œã€‚\n   æ»‘åŠ¨çª—å£  æ»‘åŠ¨çª—å£æ˜¯é’ˆå¯¹è®¡æ•°å™¨å­˜åœ¨çš„ä¸´ç•Œç‚¹ç¼ºé™·ï¼Œæ‰€è°“ æ»‘åŠ¨çª—å£ï¼ˆSliding windowï¼‰ æ˜¯ä¸€ç§æµé‡æ§åˆ¶æŠ€æœ¯ï¼Œè¿™ä¸ªè¯å‡ºç°åœ¨ TCP åè®®ä¸­ã€‚æ»‘åŠ¨çª—å£æŠŠå›ºå®šæ—¶é—´ç‰‡è¿›è¡Œåˆ’åˆ†ï¼Œå¹¶ä¸”éšç€æ—¶é—´çš„æµé€ï¼Œè¿›è¡Œç§»åŠ¨ï¼Œå›ºå®šæ•°é‡çš„å¯ä»¥ç§»åŠ¨çš„æ ¼å­ï¼Œè¿›è¡Œè®¡æ•°å¹¶åˆ¤æ–­é˜€å€¼ã€‚\nå¦‚ å›¾ï¼š\nä¸Šå›¾ä¸­æˆ‘ä»¬ç”¨çº¢è‰²çš„è™šçº¿ä»£è¡¨ä¸€ä¸ªæ—¶é—´çª—å£ï¼ˆä¸€åˆ†é’Ÿï¼‰ï¼Œæ¯ä¸ªæ—¶é—´çª—å£æœ‰ 6 ä¸ªæ ¼å­ï¼Œæ¯ä¸ªæ ¼å­æ˜¯ 10 ç§’é’Ÿã€‚æ¯è¿‡ 10 ç§’é’Ÿæ—¶é—´çª—å£å‘å³ç§»åŠ¨ä¸€æ ¼ï¼Œå¯ä»¥çœ‹çº¢è‰²ç®­å¤´çš„æ–¹å‘ã€‚æˆ‘ä»¬ä¸ºæ¯ä¸ªæ ¼å­éƒ½è®¾ç½®ä¸€ä¸ªç‹¬ç«‹çš„è®¡æ•°å™¨ Counterï¼Œå‡å¦‚ä¸€ä¸ªè¯·æ±‚åœ¨ 0:45 è®¿é—®äº†é‚£ä¹ˆæˆ‘ä»¬å°†ç¬¬äº”ä¸ªæ ¼å­çš„è®¡æ•°å™¨ +1ï¼ˆä¹Ÿæ˜¯å°±æ˜¯ 0:40~0:50ï¼‰ï¼Œåœ¨åˆ¤æ–­é™æµçš„æ—¶å€™éœ€è¦æŠŠæ‰€æœ‰æ ¼å­çš„è®¡æ•°åŠ èµ·æ¥å’Œè®¾å®šçš„é¢‘æ¬¡è¿›è¡Œæ¯”è¾ƒå³å¯ã€‚\né‚£ä¹ˆæ»‘åŠ¨çª—å£å¦‚ä½•è§£å†³æˆ‘ä»¬ä¸Šé¢é‡åˆ°çš„é—®é¢˜å‘¢ï¼Ÿæ¥çœ‹ä¸‹é¢çš„å›¾ï¼š\nå½“ç”¨æˆ·åœ¨0:59 ç§’é’Ÿå‘é€äº† 200 ä¸ªè¯·æ±‚å°±ä¼šè¢«ç¬¬å…­ä¸ªæ ¼å­çš„è®¡æ•°å™¨è®°å½• +200ï¼Œå½“ä¸‹ä¸€ç§’çš„æ—¶å€™æ—¶é—´çª—å£å‘å³ç§»åŠ¨äº†ä¸€ä¸ªï¼Œæ­¤æ—¶è®¡æ•°å™¨å·²ç»è®°å½•äº†è¯¥ç”¨æˆ·å‘é€çš„ 200 ä¸ªè¯·æ±‚ï¼Œæ‰€ä»¥å†å‘é€çš„è¯å°±ä¼šè§¦å‘é™æµï¼Œåˆ™æ‹’ç»æ–°çš„è¯·æ±‚ã€‚\nå…¶å®è®¡æ•°å™¨å°±æ˜¯æ»‘åŠ¨çª—å£å•Šï¼Œåªä¸è¿‡åªæœ‰ä¸€ä¸ªæ ¼å­è€Œå·²ï¼Œæ‰€ä»¥æƒ³è®©é™æµåšçš„æ›´ç²¾ç¡®åªéœ€è¦åˆ’åˆ†æ›´å¤šçš„æ ¼å­å°±å¯ä»¥äº†ï¼Œä¸ºäº†æ›´ç²¾ç¡®æˆ‘ä»¬ä¹Ÿä¸çŸ¥é“åˆ°åº•è¯¥è®¾ç½®å¤šå°‘ä¸ªæ ¼å­ï¼Œæ ¼å­çš„æ•°é‡å½±å“ç€æ»‘åŠ¨çª—å£ç®—æ³•çš„ç²¾åº¦ï¼Œä¾ç„¶æœ‰æ—¶é—´ç‰‡çš„æ¦‚å¿µï¼Œæ— æ³•æ ¹æœ¬è§£å†³ä¸´ç•Œç‚¹é—®é¢˜ã€‚\n ç›¸å…³ç®—æ³•å®ç° github.com/RussellLuo/slidingwindow     æ¼ æ¡¶  æ¼æ¡¶ç®—æ³•ï¼ˆLeaky Bucketï¼‰ï¼ŒåŸç†å°±æ˜¯ä¸€ä¸ªå›ºå®šå®¹é‡çš„æ¼æ¡¶ï¼ŒæŒ‰ç…§å›ºå®šé€Ÿç‡æµå‡ºæ°´æ»´ã€‚ç”¨è¿‡æ°´é¾™å¤´éƒ½çŸ¥é“ï¼Œæ‰“å¼€é¾™å¤´å¼€å…³æ°´å°±ä¼šæµä¸‹æ»´åˆ°æ°´æ¡¶é‡Œï¼Œè€Œæ¼æ¡¶æŒ‡çš„æ˜¯æ°´æ¡¶ä¸‹é¢æœ‰ä¸ªæ¼æ´å¯ä»¥å‡ºæ°´ã€‚å¦‚æœæ°´é¾™å¤´å¼€çš„ç‰¹åˆ«å¤§é‚£ä¹ˆæ°´æµé€Ÿå°±ä¼šè¿‡å¤§ï¼Œè¿™æ ·å°±å¯èƒ½å¯¼è‡´æ°´æ¡¶çš„æ°´æ»¡äº†ç„¶åæº¢å‡ºã€‚\nå¦‚ å›¾ï¼š\nä¸€ä¸ªå›ºå®šå®¹é‡çš„æ¡¶ï¼Œæœ‰æ°´æµè¿›æ¥ï¼Œä¹Ÿæœ‰æ°´æµå‡ºå»ã€‚å¯¹äºæµè¿›æ¥çš„æ°´æ¥è¯´ï¼Œæˆ‘ä»¬æ— æ³•é¢„è®¡ä¸€å…±æœ‰å¤šå°‘æ°´ä¼šæµè¿›æ¥ï¼Œä¹Ÿæ— æ³•é¢„è®¡æ°´æµçš„é€Ÿåº¦ã€‚ä½†æ˜¯å¯¹äºæµå‡ºå»çš„æ°´æ¥è¯´ï¼Œè¿™ä¸ªæ¡¶å¯ä»¥å›ºå®šæ°´æµå‡ºçš„é€Ÿç‡ï¼ˆå¤„ç†é€Ÿåº¦ï¼‰ï¼Œä»è€Œè¾¾åˆ° æµé‡æ•´å½¢ å’Œ æµé‡æ§åˆ¶ çš„æ•ˆæœã€‚\nä»£ç å®ç°:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34  type LeakyBucket struct { rate float64 //å›ºå®šæ¯ç§’å‡ºæ°´é€Ÿç‡  capacity float64 //æ¡¶çš„å®¹é‡  water float64 //æ¡¶ä¸­å½“å‰æ°´é‡  lastLeakMs int64 //æ¡¶ä¸Šæ¬¡æ¼æ°´æ—¶é—´æˆ³ ms  lock sync.Mutex } func (l *LeakyBucket) Allow() bool { l.lock.Lock() defer l.lock.Unlock() now := time.Now().UnixNano() / 1e6 eclipse := float64((now - l.lastLeakMs)) * l.rate / 1000 //å…ˆæ‰§è¡Œæ¼æ°´  l.water = l.water - eclipse //è®¡ç®—å‰©ä½™æ°´é‡  l.water = math.Max(0, l.water) //æ¡¶å¹²äº†  l.lastLeakMs = now if (l.water + 1) \u0026lt; l.capacity { // å°è¯•åŠ æ°´,å¹¶ä¸”æ°´è¿˜æœªæ»¡  l.water++ return true } else { // æ°´æ»¡ï¼Œæ‹’ç»åŠ æ°´  return false } } func (l *LeakyBucket) Set(r, c float64) { l.rate = r l.capacity = c l.water = 0 l.lastLeakMs = time.Now().UnixNano() / 1e6 }   æ¼æ¡¶ç®—æ³•æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š\n æ¼æ¡¶å…·æœ‰å›ºå®šå®¹é‡ï¼Œå‡ºæ°´é€Ÿç‡æ˜¯å›ºå®šå¸¸é‡ï¼ˆæµå‡ºè¯·æ±‚ï¼‰ å¦‚æœæ¡¶æ˜¯ç©ºçš„ï¼Œåˆ™ä¸éœ€æµå‡ºæ°´æ»´ å¯ä»¥ä»¥ä»»æ„é€Ÿç‡æµå…¥æ°´æ»´åˆ°æ¼æ¡¶ï¼ˆæµå…¥è¯·æ±‚ï¼‰ å¦‚æœæµå…¥æ°´æ»´è¶…å‡ºäº†æ¡¶çš„å®¹é‡ï¼Œåˆ™æµå…¥çš„æ°´æ»´æº¢å‡ºï¼ˆæ–°è¯·æ±‚è¢«æ‹’ç»ï¼‰  æ¼æ¡¶é™åˆ¶çš„æ˜¯å¸¸é‡æµå‡ºé€Ÿç‡ï¼ˆå³æµå‡ºé€Ÿç‡æ˜¯ä¸€ä¸ªå›ºå®šå¸¸é‡å€¼ï¼‰ï¼Œæ‰€ä»¥æœ€å¤§çš„é€Ÿç‡å°±æ˜¯å‡ºæ°´çš„é€Ÿç‡ï¼Œä¸èƒ½å‡ºç°çªå‘æµé‡ã€‚\n   ä»¤ç‰Œæ¡¶ç®—æ³•  ä»¤ç‰Œæ¡¶ç®—æ³•ï¼ˆToken Bucketï¼‰æ˜¯ç½‘ç»œæµé‡æ•´å½¢ï¼ˆTraffic Shapingï¼‰å’Œé€Ÿç‡é™åˆ¶ï¼ˆRate Limitingï¼‰ä¸­æœ€å¸¸ä½¿ç”¨çš„ä¸€ç§ç®—æ³•ã€‚å…¸å‹æƒ…å†µä¸‹ï¼Œä»¤ç‰Œæ¡¶ç®—æ³•ç”¨æ¥æ§åˆ¶å‘é€åˆ°ç½‘ç»œä¸Šçš„æ•°æ®çš„æ•°ç›®ï¼Œå¹¶å…è®¸çªå‘æ•°æ®çš„å‘é€ã€‚\næˆ‘ä»¬æœ‰ä¸€ä¸ªå›ºå®šçš„æ¡¶ï¼Œæ¡¶é‡Œå­˜æ”¾ç€ä»¤ç‰Œï¼ˆtokenï¼‰ã€‚ä¸€å¼€å§‹æ¡¶æ˜¯ç©ºçš„ï¼Œç³»ç»ŸæŒ‰å›ºå®šçš„æ—¶é—´ï¼ˆrateï¼‰å¾€æ¡¶é‡Œæ·»åŠ ä»¤ç‰Œï¼Œç›´åˆ°æ¡¶é‡Œçš„ä»¤ç‰Œæ•°æ»¡ï¼Œå¤šä½™çš„è¯·æ±‚ä¼šè¢«ä¸¢å¼ƒã€‚å½“è¯·æ±‚æ¥çš„æ—¶å€™ï¼Œä»æ¡¶é‡Œç§»é™¤ä¸€ä¸ªä»¤ç‰Œï¼Œå¦‚æœæ¡¶æ˜¯ç©ºçš„åˆ™æ‹’ç»è¯·æ±‚æˆ–è€…é˜»å¡ã€‚\nå®ç°ä»£ç ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35  type TokenBucket struct { rate int64 //å›ºå®šçš„tokenæ”¾å…¥é€Ÿç‡, r/s  capacity int64 //æ¡¶çš„å®¹é‡  tokens int64 //æ¡¶ä¸­å½“å‰tokenæ•°é‡  lastTokenSec int64 //æ¡¶ä¸Šæ¬¡æ”¾tokençš„æ—¶é—´æˆ³ s  lock sync.Mutex } func (l *TokenBucket) Allow() bool { l.lock.Lock() defer l.lock.Unlock() now := time.Now().Unix() l.tokens = l.tokens + (now-l.lastTokenSec)*l.rate // å…ˆæ·»åŠ ä»¤ç‰Œ  if l.tokens \u0026gt; l.capacity { l.tokens = l.capacity } l.lastTokenSec = now if l.tokens \u0026gt; 0 { // è¿˜æœ‰ä»¤ç‰Œï¼Œé¢†å–ä»¤ç‰Œ  l.tokens-- return true } else { // æ²¡æœ‰ä»¤ç‰Œ,åˆ™æ‹’ç»  return false } } func (l *TokenBucket) Set(r, c int64) { l.rate = r l.capacity = c l.tokens = 0 l.lastTokenSec = time.Now().Unix() }   ä»¤ç‰Œæ¡¶æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š\n ä»¤ç‰ŒæŒ‰å›ºå®šçš„é€Ÿç‡è¢«æ”¾å…¥ä»¤ç‰Œæ¡¶ä¸­ æ¡¶ä¸­æœ€å¤šå­˜æ”¾ B ä¸ªä»¤ç‰Œï¼Œå½“æ¡¶æ»¡æ—¶ï¼Œæ–°æ·»åŠ çš„ä»¤ç‰Œè¢«ä¸¢å¼ƒæˆ–æ‹’ç» å¦‚æœæ¡¶ä¸­çš„ä»¤ç‰Œä¸è¶³ N ä¸ªï¼Œåˆ™ä¸ä¼šåˆ é™¤ä»¤ç‰Œï¼Œä¸”è¯·æ±‚å°†è¢«é™æµï¼ˆä¸¢å¼ƒæˆ–é˜»å¡ç­‰å¾…ï¼‰  ä»¤ç‰Œæ¡¶é™åˆ¶çš„æ˜¯å¹³å‡æµå…¥é€Ÿç‡ï¼ˆå…è®¸çªå‘è¯·æ±‚ï¼Œåªè¦æœ‰ä»¤ç‰Œå°±å¯ä»¥å¤„ç†ï¼Œæ”¯æŒä¸€æ¬¡æ‹¿3ä¸ªä»¤ç‰Œï¼Œ4ä¸ªä»¤ç‰Œ\u0026hellip;ï¼‰ï¼Œå¹¶å…è®¸ä¸€å®šç¨‹åº¦çªå‘æµé‡ã€‚\n   å° ç»“  ç›®å‰å¸¸ç”¨çš„æ˜¯ä»¤ç‰Œæ¡¶è¿™ç§ï¼Œæœ¬æ–‡ä»‹ç»äº†å‡ ç§å¸¸è§çš„é™æµç®—æ³•å®ç°ï¼Œæ–‡ç« æ’°å†™ä¸æ˜“ï¼Œç‚¹ä¸ªå…³æ³¨ä¸è¿·è·¯ã€‚\n","date":"Sep 16","permalink":"http://blog.ibyte.me/post/traffic-restrictions/","tags":null,"title":"Traffic Restrictions"},{"categories":null,"contents":"   æ¦‚ è¿°  éšç€äº’è”ç½‘çš„é«˜é€Ÿå‘å±•ï¼Œä¿¡æ¯å®‰å…¨é—®é¢˜å·²ç»æˆä¸ºä¼ä¸šæœ€ä¸ºå…³æ³¨çš„ç„¦ç‚¹ä¹‹ä¸€ï¼Œè€Œå‰ç«¯åˆæ˜¯å¼•å‘ä¼ä¸šå®‰å…¨é—®é¢˜çš„é«˜å±æ®ç‚¹ã€‚åœ¨ç§»åŠ¨äº’è”ç½‘æ—¶ä»£ï¼Œå‰ç«¯äººå‘˜é™¤äº†ä¼ ç»Ÿçš„ XSSã€CSRF ç­‰å®‰å…¨é—®é¢˜ä¹‹å¤–ï¼Œåˆæ—¶å¸¸é­é‡ç½‘ç»œåŠ«æŒã€éæ³•è°ƒç”¨ API ç­‰æ–°å‹å®‰å…¨é—®é¢˜ã€‚å½“ç„¶ï¼Œæµè§ˆå™¨è‡ªèº«ä¹Ÿåœ¨ä¸æ–­åœ¨è¿›åŒ–å’Œå‘å±•ï¼Œä¸æ–­å¼•å…¥ CSPã€Same-Site Cookies ç­‰æ–°æŠ€æœ¯æ¥å¢å¼ºå®‰å…¨æ€§ï¼Œä½†æ˜¯ä»å­˜åœ¨å¾ˆå¤šæ½œåœ¨çš„å¨èƒï¼Œè¿™éœ€è¦æˆ‘ä»¬æŠ€æœ¯äººå‘˜ä¸æ–­å¯¹ç³»ç»Ÿè¿›è¡Œâ€œæŸ¥æ¼è¡¥ç¼ºâ€ã€‚\n   åºŸè¯å°‘è¯´ï¼Œå…ˆçœ‹é—®é¢˜  ä¸ºäº†æ¨¡æ‹Ÿé—®é¢˜æˆ‘è¿™è¾¹ç”¨goå†™äº†2ä¸ªæœåŠ¡ç«¯çš„ä»£ç ï¼Œæ­£å¸¸äº¤æ˜“ç³»ç»Ÿçš„APIï¼Œå½“ç„¶è¿™é‡Œåªæ˜¯ä¸ºäº†æ¼”ç¤ºæ¼æ´åˆ©ç”¨ï¼Œä»£ç æ¯”è¾ƒç®€å•å¦‚ä¸‹:\ntransaction.go å†…å®¹:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86  package main import ( \u0026#34;errors\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;github.com/spf13/cast\u0026#34; \u0026#34;log\u0026#34; \u0026#34;net/http\u0026#34; ) // æ¨¡æ‹Ÿæ•°æ®å­˜å‚¨ type user struct { id string money int } var userdata []*user func init() { userdata = append(userdata, \u0026amp;user{id: \u0026#34;Tom\u0026#34;, money: 10000}) userdata = append(userdata, \u0026amp;user{id: \u0026#34;John\u0026#34;, money: 10000}) userdata = append(userdata, \u0026amp;user{id: \u0026#34;hack\u0026#34;, money: 0}) } // æ¨¡æ‹Ÿäº¤æ˜“ç³»ç»ŸAPI func main() { http.HandleFunc(\u0026#34;/transaction\u0026#34;, transactionHandler) http.ListenAndServe(\u0026#34;:1999\u0026#34;, nil) } // å‡è®¾è¿™æ˜¯äº¤æ˜“å¤„ç†å™¨ func transactionHandler(w http.ResponseWriter, req *http.Request) { if req.URL.Path != \u0026#34;/transaction\u0026#34; { http.Error(w, \u0026#34;404 not found.\u0026#34;, http.StatusNotFound) return } switch req.Method { case \u0026#34;GET\u0026#34;: http.ServeFile(w, req, \u0026#34;form.html\u0026#34;) case \u0026#34;POST\u0026#34;: if err := req.ParseForm(); err != nil { fmt.Fprintf(w, \u0026#34;ParseForm() err: %v\u0026#34;, err) return } if e := transaction(req.FormValue(\u0026#34;Id\u0026#34;), req.FormValue(\u0026#34;toId\u0026#34;), req.FormValue(\u0026#34;money\u0026#34;)); e != nil { fmt.Fprintf(w,\u0026#34;%s\u0026#34;,e.Error()) return } fmt.Fprintf(w,\u0026#34;transaction successful.\u0026#34;) default: fmt.Fprintf(w, \u0026#34;Sorry, only GET and POST methods are supported.\u0026#34;) } } func transaction(Id, toId, money string) error { if len(Id) \u0026lt;= 0 || len(toId) \u0026lt;= 0 || cast.ToInt(money) \u0026lt;= 0 { return errors.New(\u0026#34;form invalid parameter\u0026#34;) } var user, recipient *user for _, u := range userdata { if u.id == Id { user = u break } } for _, r := range userdata { if r.id == toId { recipient = r break } } // ç”¨æˆ·ä¸å­˜åœ¨ \tif user == nil || recipient == nil { return errors.New(\u0026#34;user does not exist\u0026#34;) } // æœ‰é’±æ‰èƒ½è½¬è´¦ \tif user.money \u0026lt; 0 || user.money \u0026lt; cast.ToInt(money) { return errors.New(\u0026#34;your balance is insufficient\u0026#34;) } user.money = user.money - cast.ToInt(money) recipient.money = recipient.money + cast.ToInt(money) log.Printf(\u0026#34;ç”¨æˆ· %s å‘ç”¨æˆ· %s è½¬è´¦ %s å…ƒ.\u0026#34;, Id, toId, money) return nil }   æˆ‘ä»¬æŠŠä¸Šé¢çš„ä»£ç è·‘èµ·æ¥ï¼Œgo run transaction.go\n[Running] go run \u0026quot;/Users/ding/Desktop/CSRF_Demo/transaction.go\u0026quot; 2021/03/12 21:50:08 Transaction Server Running.... å¥½äº†ï¼ŒæœåŠ¡å™¨æ­£å¸¸è·‘èµ·æ¥äº†ï¼ŒæŒ‰ç…§æˆ‘ä»¬æ­£å¸¸çš„ç³»ç»Ÿæµç¨‹æ˜¯ï¼Œæˆ‘ä»¬ç™»é™†åˆ°äº†ç³»ç»Ÿé‡Œé¢ï¼Œç³»ç»Ÿé‡Œé¢æœ‰æˆ‘ä»¬çš„æµè§ˆå™¨ä¼šè¯æ•°æ®ï¼Œè¿™æ—¶æˆ‘ä»¬åªæƒ³é€šè¿‡ç³»ç»Ÿç»™å‡ºçš„äº¤æ˜“æ¥å£æ“ä½œå°±å¯ä»¥äº†ï¼Œè¿™é‡Œä¸ºäº†æ–¹ä¾¿æ¼”ç¤ºæˆ‘ä½¿ç”¨postmanè¿›è¡Œæµ‹è¯•ã€‚\nå¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„äº¤æ˜“ç³»ç»Ÿè®¾è®¡çš„æ‰€éœ€çš„å‚æ•°ï¼Œå¹¶ä¸”æˆ‘ä»¬å¡«å†™äº†è¯·æ±‚è¡¨å•æ•°æ®ï¼Œå¹¶ä¸”æäº¤äº†è¿™ä¸ªè¯·æ±‚ã€‚æˆ‘ä»¬å»æœåŠ¡å™¨çœ‹çœ‹æ—¥å¿—:\n[Running] go run \u0026quot;/Users/ding/Desktop/CSRF_Demo/transaction.go\u0026quot; 2021/03/12 21:50:08 Transaction Server Running.... 2021/03/12 21:54:41 ç”¨æˆ· Tom å‘ç”¨æˆ· John è½¬è´¦ 2000 å…ƒ. å¯ä»¥çœ‹åˆ°æœ‰ä¸€æ¡è½¬è´¦è®°å½•ï¼Œè¯´æ˜æˆ‘ä»¬æ“ä½œæˆåŠŸäº†ã€‚\n   å¼€å§‹æ¼æ´åˆ©ç”¨  æŒ‰ç…§æ­£å¸¸äººçš„æ€ç»´æˆ‘ä»¬å°±æ­£å¸¸æ“ä½œå°±è¡Œäº†ï¼Œä½†æ˜¯ä¸–ç•Œè¿™ä¹ˆå¤§æ€ä¹ˆå¯èƒ½æ²¡æœ‰åäººå‘¢ï¼Ÿï¼Ÿï¼Ÿé‚£ä¸‹é¢æŠŠç¬¬ä¸€ä¸ªæœåŠ¡å™¨è·‘èµ·æ¥ï¼Œå¹¶ä¸”è®¿é—®ç¬¬äºŒä¸ªæœåŠ¡å™¨çœ‹çœ‹ç»“æœæ€ä¹ˆæ ·ï¼Ÿï¼Ÿ\ncsrf.goæ–‡ä»¶é‡Œé¢å†…å®¹:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16  package main import ( \u0026#34;log\u0026#34; \u0026#34;net/http\u0026#34; ) func main(){ http.HandleFunc(\u0026#34;/csrf\u0026#34;,csrfHandler) log.Println(\u0026#34;CSRF Server Running....\u0026#34;) http.ListenAndServe(\u0026#34;:2021\u0026#34;, nil) } func csrfHandler(writer http.ResponseWriter, request *http.Request) { http.ServeFile(writer, request, \u0026#34;csrf.html\u0026#34;) }   é¦–å…ˆæˆ‘æŠŠæ”»å‡»åˆ©ç”¨æœåŠ¡å™¨å¯åŠ¨ go run csrf.go\n1  2021/03/12 22:16:43 CSRF Server Running....   ç„¶åæˆ‘åœ¨åŒä¸€æµè§ˆå™¨é‡Œé¢è®¿é—®è¿™ä¸ªåœ°å€http://127.0.0.1:2021/csrfã€‚\nåœ¨ä½ å›è½¦çš„é‚£ä¸€ç§’ï¼Œå…¶å®è¿™ä¸ªæ¼æ´å·²ç»åˆ©ç”¨æˆåŠŸäº†ã€‚è¿™ä¸ªè¿‡ç¨‹å¯èƒ½ä¸æ˜¯ä½ ç›´æ¥åœ¨æµè§ˆå™¨åœ°å€æ¡†ç›´æ¥è¾“å…¥ï¼Œä¹Ÿå¯èƒ½æ˜¯ä½ åœ¨æ‰“å¼€å…¶ä»–ç½‘ç«™ï¼Œå…¶ä»–ç½‘ç«™é‡Œé¢æœ‰ä¸€ä¸ªåœ°å€å°±æ˜¯è¿™ä¸ªåœ°å€ï¼Œæˆ–è€…æ˜¯ä½ åœ¨QQæˆ–è€…ä¸€äº›èŠå¤©è½¯ä»¶ä¸Šï¼Œåˆ«äººç»™ä½ å‘é€ä¸€ä¸ªåœ°å€ï¼Œåœ¨ä½ ç‚¹å‡»é‚£ä¸€ç§’è¿™ä¸ªæ”»å‡»å°±æˆåŠŸäº†ã€‚\né‚£æ€ä¹ˆè¯æ˜æˆåŠŸäº†å‘¢ï¼Ÿæˆ‘ä»¬å»çœ‹çœ‹è½¬è´¦ç³»ç»Ÿçš„æ—¥å¿—ã€‚ã€‚\nå¯ä»¥çœ‹åˆ°æœ‰ä¸€æ¡è½¬è´¦æ—¥å¿—è®°å½•ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬åˆšåˆšé€šè¿‡æ¼æ´åˆ©ç”¨è¾¾æˆçš„è½¬è´¦æ•ˆæœã€‚\n   é‚£è¿™ä¸ªæ˜¯æ€ä¹ˆåšåˆ°çš„å‘¢ï¼Ÿ  é€šè¿‡æˆ‘ä»¬æ”»å‡»åˆ©ç”¨æœåŠ¡å™¨ä¸Šçš„ä»£ç å¯ä»¥çœ‹å‡ºæ¥æˆ‘ä»¬åœ¨æœåŠ¡å™¨è¿”å›äº†ä¸€ä¸ªcsrf.htmlæ–‡ä»¶ï¼Œé‚£è¿™ä¸ªæ–‡ä»¶åšäº†ä»€ä¹ˆï¼Ÿï¼Ÿï¼Ÿ\næ–‡ä»¶å†…å®¹å¦‚ä¸‹:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15  \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; \u0026lt;title\u0026gt;csrf æ”»å‡»æ¼”ç¤º\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;form action=\u0026#34;http://127.0.0.01:1999/transaction\u0026#34; method=POST\u0026gt; \u0026lt;input type=\u0026#34;hidden\u0026#34; name=\u0026#34;Id\u0026#34; value=\u0026#34;Tom\u0026#34; /\u0026gt; \u0026lt;input type=\u0026#34;hidden\u0026#34; name=\u0026#34;money\u0026#34; value=\u0026#34;5000\u0026#34; /\u0026gt; \u0026lt;input type=\u0026#34;hidden\u0026#34; name=\u0026#34;toId\u0026#34; value=\u0026#34;hack\u0026#34; /\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;script\u0026gt; document.forms[0].submit(); \u0026lt;/script\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt;   ç›¸ä¿¡æ˜¯ä¸ªç¨‹åºå‘˜éƒ½èƒ½çœ‹æ‡‚æˆ‘åšäº†ä»€ä¹ˆå§ï¼Œä¸ç”¨ç»†è¯´ã€‚\n   CSRFæ”»å‡»å’Œé˜²èŒƒ  ä¸Šé¢æ”»å‡»è¿‡ç¨‹å°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„CSRFæ”»å‡»ï¼Œç›¸æ¯”XSSï¼ŒCSRFçš„åæ°”ä¼¼ä¹å¹¶ä¸æ˜¯é‚£ä¹ˆå¤§ï¼Œå¾ˆå¤šäººéƒ½è®¤ä¸ºCSRFâ€œä¸é‚£ä¹ˆæœ‰ç ´åæ€§â€ï¼ŒçœŸçš„æ˜¯è¿™æ ·å—ï¼Ÿ\nCSRFæ”»å‡»çš„ä¾‹å­å·²ç»ä¸æ˜¯å•ä¸ªä¸ªä¾‹äº†ï¼ŒGmailï¼ŒFacebookï¼ŒTwitterï¼ŒYouTubeè¿™äº›éƒ½æœ‰ä¸ªç±»ä¼¼çš„æ¼æ´äº‹ä»¶ã€‚\n https://www.davidairey.com/google-gmail-security-hijack/   CSRFï¼ˆCross-site request forgeryï¼‰è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼šæ”»å‡»è€…è¯±å¯¼å—å®³è€…è¿›å…¥ç¬¬ä¸‰æ–¹ç½‘ç«™ï¼Œåœ¨ç¬¬ä¸‰æ–¹ç½‘ç«™ä¸­ï¼Œå‘è¢«æ”»å‡»ç½‘ç«™å‘é€è·¨ç«™è¯·æ±‚ã€‚åˆ©ç”¨å—å®³è€…åœ¨è¢«æ”»å‡»ç½‘ç«™å·²ç»è·å–çš„æ³¨å†Œå‡­è¯ï¼Œç»•è¿‡åå°çš„ç”¨æˆ·éªŒè¯ï¼Œè¾¾åˆ°å†’å……ç”¨æˆ·å¯¹è¢«æ”»å‡»çš„ç½‘ç«™æ‰§è¡ŒæŸé¡¹æ“ä½œçš„ç›®çš„ã€‚\n æˆ‘åˆšæ‰çš„ä¾‹å­å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„CSRFä¾‹å­ï¼Œå—å®³è€…ç™»å½•a.comï¼Œå¹¶ä¿ç•™äº†ç™»å½•å‡­è¯ï¼ˆCookieï¼‰ï¼Œæ”»å‡»è€…å¼•è¯±å—å®³è€…è®¿é—®äº†b.comï¼Œb.com å‘ a.com å‘é€äº†ä¸€ä¸ªè¯·æ±‚ï¼ša.com/xxã€‚æµè§ˆå™¨ä¼šé»˜è®¤æºå¸¦a.comçš„Cookieï¼Œa.comæ¥æ”¶åˆ°è¯·æ±‚åï¼Œå¯¹è¯·æ±‚è¿›è¡ŒéªŒè¯ï¼Œå¹¶ç¡®è®¤æ˜¯å—å®³è€…çš„å‡­è¯ï¼Œè¯¯ä»¥ä¸ºæ˜¯å—å®³è€…è‡ªå·±å‘é€çš„è¯·æ±‚ï¼Œä»è€Œè¾¾åˆ°é»‘å®¢çš„ç›®çš„ã€‚\n   å° ç»“  æ¶‰åŠåˆ°é“­æ„Ÿæ•°æ®æ“ä½œçš„åŠ å¼ºéªŒè¯ï¼Œå®¢æˆ·ç«¯çš„æ•°æ®ä¸å¯ä¿¡ï¼ŒæœåŠ¡å™¨åŠ å¼ºå¯¹æ•°æ®æ ¡éªŒï¼Œå’ŒåŠ ä¸€äº›é£æ§ç­–ç•¥ï¼Œä¾‹å¦‚éªŒè¯ç ï¼Œæ‰‹æœºçŸ­ä¿¡ï¼Œjwtï¼Œæˆ–è€…ç¬¬ä¸‰æ–¹éªŒè¯ç é˜²ç«å¢™ï¼Œä¹Ÿå¯ä»¥åœ¨è¯·æ±‚çš„ä¹‹å‰å…ˆæ‹¿åˆ°ä¸€ä¸ªå”¯ä¸€çš„tokenï¼ŒåŒæºæ£€æµ‹ï¼ˆOrigin å’Œ Referer éªŒè¯ï¼‰ï¼Œå½“ç„¶è¿™äº›æ–¹æ³•è¿˜ä¸å®‰å…¨ï¼Œå¦‚æœæœ‰ç©ºä¼šç»­æ›´ã€‚\n","date":"Sep 16","permalink":"http://blog.ibyte.me/post/web-safe-csrf/","tags":null,"title":"Web Safe Csrf"},{"categories":null,"contents":"   æ¦‚ è¿°  å¤§å®¶éƒ½çŸ¥é“ session æ˜¯webåº”ç”¨åœ¨æœåŠ¡å™¨ç«¯å®ç°çš„ä¸€ç§ç”¨æˆ·å’ŒæœåŠ¡å™¨ä¹‹é—´è®¤è¯çš„è§£å†³æ–¹æ¡ˆï¼Œç›®å‰ Go æ ‡å‡†åŒ…æ²¡æœ‰ä¸º session æä¾›ä»»ä½•æ”¯æŒï¼Œæœ¬æ–‡æˆ‘å°†è®²è§£sessionçš„å®ç°åŸç†ï¼Œå’Œä¸€äº›å¸¸è§åŸºäºsessionå®‰å…¨äº§ç”Ÿçš„é˜²å¾¡é—®é¢˜ã€‚\nå½“ç„¶æœ‰äººå¯èƒ½çœ‹äº†ä¼šæŠ¬æ ï¼Œè¯´ç°åœ¨å¤§éƒ¨åˆ†ä¸æ˜¯å‰åç«¯åˆ†ç¦»æ¶æ„å—ï¼Ÿå¯¹ï¼Œä½ å¯ä»¥ä½¿ç”¨JWTè§£å†³ä½ çš„é—®é¢˜ã€‚ä½†æ˜¯ä¹Ÿæœ‰ä¸€äº›ä¸€ä½“åŒ–webåº”ç”¨éœ€è¦sessionï¼Œæ‰€ä»¥æˆ‘å‡†å¤‡é€ ä¸ªè½®å­ã€‚è‡ªå·±é€ çš„è½®å­å“ªé‡Œå‡ºé—®é¢˜äº†ï¼Œæ¯”åˆ«äººæ›´ç†Ÿæ‚‰ï¼Œæœ‰bugäº†ï¼Œè¿˜ä¸ç”¨æ±‚ç€åˆ«äººä¿®bug,è‡ªå·±ä¿®å°±å¥½äº†ï¼Œå‘µå‘µå“ˆå“ˆå“ˆï¼Œå½“ç„¶è¿™å‡ å¥è¯æœ‰ç‚¹çš®ğŸ˜œã€‚\n   éœ€ æ±‚  æˆ‘è§‰å¾—ä¸€åå¥½çš„ç¨‹åºå‘˜ï¼Œåœ¨å†™ç¨‹åºä¹‹å‰åº”è¯¥åˆ—ä¸€ä¸‹éœ€æ±‚åˆ†æï¼Œæ•´ç†ä¸€ä¸‹æ€è·¯ï¼Œç„¶åå†å»å†™ä»£ç ã€‚\n æ”¯æŒå†…å­˜å­˜å‚¨ä¼šè¯æ•°æ® æ”¯æŒåˆ†å¸ƒå¼redisä¼šè¯å­˜å‚¨ ä¼šè¯å¦‚æœæœ‰å¿ƒè·³å°±è‡ªåŠ¨ç»­å‘½30åˆ†é’Ÿï¼ˆç”Ÿå‘½å‘¨æœŸï¼‰ æä¾›é˜²å¾¡ï¼šä¸­é—´äººï¼Œä¼šè¯åŠ«æŒï¼Œä¼šè¯é‡æ”¾ç­‰æ”»å‡»     å·¥ä½œåŸç†  é¦–å…ˆå¿…é¡»äº†è§£å·¥ä½œåŸç†æ‰èƒ½å†™ä»£ç ï¼Œè¿™é‡Œæˆ‘å°±ç¨å¾®è¯´ä¸€ä¸‹ï¼Œsessionæ˜¯åŸºäºcookieå®ç°çš„ï¼Œä¸€ä¸ªsessionå¯¹åº”ä¸€ä¸ªuuidä¹Ÿæ˜¯sessionidï¼Œåœ¨æœåŠ¡å™¨åˆ›å»ºä¸€ä¸ªç›¸å…³çš„æ•°æ®ç»“æ„ï¼Œç„¶åæŠŠè¿™ä¸ªsessionidé€šè¿‡cookieè®©æµè§ˆå™¨ä¿å­˜ç€ï¼Œä¸‹æ¬¡æµè§ˆå™¨è¯·æ±‚è¿‡æ¥äº†å°±ä¼šæœ‰sessionidï¼Œç„¶åé€šè¿‡sessionidè·å–è¿™ä¸ªä¼šè¯çš„æ•°æ®ã€‚\n   ä»£ç å®ç°  éƒ½æ˜¯è¯´ç€å®¹æ˜“ï¼Œå®é™…å†™èµ·æ¥å°±æ˜¯å„ç§å‘ï¼Œä¸è¿‡æˆ‘è¿˜æ˜¯å®ç°äº†ã€‚\nå°‘è¯´åºŸè¯ï¼Œè¿˜æ˜¯ç›´æ¥å¹²ä»£ç å§ã€‚\n ä¾èµ–å…³ç³»  ä¸Šé¢æ˜¯è®¾è®¡çš„ç›¸å…³ä¾èµ–å…³ç³»å›¾ï¼Œsessionæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ç»“æ„ä½“ï¼Œ GlobalManageræ˜¯æ•´ä½“çš„ä¼šè¯ç®¡ç†å™¨è´Ÿè´£æ•°æ®æŒä¹…åŒ–ï¼Œè¿‡æœŸä¼šè¯åƒåœ¾å›æ”¶å·¥ä½œâ™»ï¸ï¼Œstorageæ˜¯å­˜å‚¨å™¨æ¥å£ï¼Œå› ä¸ºæˆ‘ä»¬è¦å®ç°ä¸¤ç§æ–¹å¼å­˜å‚¨ä¼šè¯æ•°æ®æˆ–è€…ä»¥åè¦å¢åŠ å…¶ä»–æŒä¹…åŒ–å­˜å‚¨ï¼Œæ‰€ä»¥å¿…é¡»éœ€è¦æ¥å£æŠ½è±¡æ”¯æŒï¼Œmemoryå’Œredisæ˜¯å­˜å‚¨çš„å…·ä½“å®ç°ã€‚\nstorageæ¥å£  1 2 3 4 5 6 7 8 9  package sessionx // session storage interface type storage interface { Read(s *Session) error Create(s *Session) error Update(s *Session) error Remove(s *Session) error }   storageå°±9è¡Œä»£ç ï¼Œæ˜¯å…·ä½“çš„ä¼šè¯æ•°æ®æ“ä½œåŠ¨ä½œçš„æŠ½è±¡ï¼Œå…¨éƒ¨å‚æ•°ä½¿ç”¨çš„æ˜¯sessionè¿™ä¸ªç»“æ„çš„æŒ‡é’ˆï¼Œå¦‚æœå¤„ç†å¼‚å¸¸äº†å°±å³é”™å³è¿”å›ã€‚\nä¸ºä»€ä¹ˆæŠŠå‡½æ•°ç­¾åçš„å½¢å‚ä½¿ç”¨æŒ‡é’ˆç±»å‹çš„ï¼Œè¿™ä¸ªæˆ‘æƒ³çœ‹çš„æ‡‚äººåº”è¯¥çŸ¥é“è¿™æ˜¯ä¸ºä»€ä¹ˆäº†ğŸ˜\nmemoryStoreç»“æ„ä½“  1 2 3  type memoryStore struct { sync.Map }   memoryStoreç»“æ„ä½“é‡Œé¢å°±åµŒå…¥sync.Mapç»“æ„ä½“ï¼Œä¸€å¼€å§‹æ˜¯ä½¿ç”¨çš„mapè¿™ç§ï¼Œä½†æ˜¯åé¢å‘ç°åœ¨å¹¶å‘è¯»å†™ç„¶ååŠ sync.Mutexé”ğŸ”ï¼Œæ€§èƒ½è¿˜ä¸å¦‚ç›´æ¥ä½¿ç”¨sync.Mapé€Ÿåº¦å¿«ã€‚sync.Mapç”¨æ¥åšK:Vå­˜å‚¨çš„ï¼Œä¹Ÿå°±æ˜¯sessionidå¯¹åº”session dataçš„ã€‚\nå®ç°storageå…·ä½“æ–¹æ³•å¦‚ä¸‹:\n1 2 3 4 5 6 7 8 9  func (m *memoryStore) Read(s *Session) error { if ele, ok := m.Load(s.ID); ok { // bug è¿™ä¸ªä¸èƒ½ç›´æ¥ s = ele  s.Data = ele.(*Session).Data return nil } // s = nil  return fmt.Errorf(\u0026#34;id `%s` not exist session data\u0026#34;, s.ID) }   è¯»å–æ•°æ®çš„æ—¶å€™å…ˆå°†æŒä¹…åŒ–çš„æ•°æ®è¯»å‡ºæ¥ç„¶åèµ‹å€¼ç»™æœ¬æ¬¡ä¼šè¯çš„sessionã€‚\næ³¨æ„: åœ¨goçš„mapä¸­çš„structä¸­çš„å­—æ®µä¸èƒ½å¤Ÿç›´æ¥å¯»å€ï¼Œå®˜æ–¹issue https://github.com/golang/go/issues/3117\nå…¶ä»–å‡ ä¸ªå‡½æ•°:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20  func (m *memoryStore) Create(s *Session) error { m.Store(s.ID, s) return nil } func (m *memoryStore) Remove(s *Session) error { m.Delete(s.ID) return nil } func (m *memoryStore) Update(s *Session) error { if ele, ok := m.Load(s.ID); ok { // ä¸ºä»€ä¹ˆæ˜¯äº¤æ¢data å› ä¸ºæˆ‘ä»¬ä¸ç¡®å®šä¸Šå±‚æ˜¯å¦æ‰©å®¹æ¢äº†åœ°å€  ele.(*Session).Data = s.Data ele.(*Session).Expires = s.Expires //m.sessions[s.ID] = ele  return nil } return fmt.Errorf(\u0026#34;id `%s` updated session fail\u0026#34;, s.ID) }   è¿™å¥è¯ä»£ç æ²¡æœ‰ä»€ä¹ˆå¥½è¯´çš„ï¼Œå†™è¿‡goéƒ½èƒ½çœ‹å¾—æ‡‚ã€‚\nåƒåœ¾å›æ”¶:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15  func (m *memoryStore) gc() { // recycle your trash every 10 minutes  for { time.Sleep(time.Minute * 10) m.Range(func(key, value interface{}) bool { if time.Now().UnixNano() \u0026gt;= value.(*Session).Expires.UnixNano() { m.Delete(key) } return true }) runtime.GC() // log.Println(\u0026#34;gc running...\u0026#34;)  } }   æ¯”è¾ƒä¼šè¯è¿‡æœŸæ—¶é—´ï¼Œè¿‡æœŸå°±åˆ é™¤ä¼šè¯ï¼Œä»¥ä¸Šå°±æ˜¯å†…å­˜å­˜å‚¨çš„å®ç°ã€‚\nredisStoreç»“æ„ä½“  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41  type redisStore struct { sync.Mutex sessions *redis.Client } func (rs *redisStore) Read(s *Session) error { sid := fmt.Sprintf(\u0026#34;%s:%s\u0026#34;, mgr.cfg.RedisKeyPrefix, s.ID) bytes, err := rs.sessions.Get(ctx, sid).Bytes() if err != nil { return err } if err := rs.sessions.Expire(ctx, sid, mgr.cfg.TimeOut).Err(); err != nil { return err } if err := decoder(bytes, s); err != nil { return err } // log.Println(\u0026#34;redis read:\u0026#34;, s)  return nil } func (rs *redisStore) Create(s *Session) error { return rs.setValue(s) } func (rs *redisStore) Update(s *Session) error { return rs.setValue(s) } func (rs *redisStore) Remove(s *Session) error { return rs.sessions.Del(ctx, fmt.Sprintf(\u0026#34;%s:%s\u0026#34;, mgr.cfg.RedisKeyPrefix, s.ID)).Err() } func (rs *redisStore) setValue(s *Session) error { bytes, err := encoder(s) if err != nil { return err } err = rs.sessions.Set(ctx, fmt.Sprintf(\u0026#34;%s:%s\u0026#34;, mgr.cfg.RedisKeyPrefix, s.ID), bytes, mgr.cfg.TimeOut).Err() return err }   ä»£ç ä¹Ÿå°±50è¡Œå·¦å³ï¼Œå¾ˆç®€å•å°±æ˜¯é€šè¿‡rediså®¢æˆ·ç«¯å¯¹æ•°æ®è¿›è¡ŒæŒä¹…åŒ–æ“ä½œï¼ŒæŠŠæœ¬åœ°çš„ä¼šè¯æ•°æ®æä¾›encoding/gobåºåˆ—åŒ–æˆäºŒè¿›åˆ¶å†™åˆ°redisæœåŠ¡å™¨ä¸Šå­˜å‚¨ï¼Œéœ€è¦çš„æ—¶å€™å†ååºåˆ—åŒ–å‡ºæ¥ã€‚\né‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œä¼šæœ‰äººé—®äº†ï¼Œredisæ²¡æœ‰å¹¶å‘é—®é¢˜å—ï¼Ÿ\nğŸ‘¨â€ğŸ’»â€ï¼š é‚£æˆ‘è‚¯å®šä¼šå›ç­”ï¼Œä½ åœ¨é—®è¿™ä¸ªé—®é¢˜ä¹‹å‰æˆ‘ä¸çŸ¥é“ä½ æœ‰æ²¡æœ‰äº†è§£è¿‡redisï¼Ÿï¼Ÿï¼Ÿ\nRedis å¹¶å‘ç«äº‰æŒ‡çš„æ˜¯å¤šä¸ª Redis å®¢æˆ·ç«¯åŒæ—¶ set key å¼•èµ·çš„å¹¶å‘é—®é¢˜ï¼ŒRedis æ˜¯ä¸€ç§å•çº¿ç¨‹æœºåˆ¶çš„ NoSQL æ•°æ®åº“ï¼Œæ‰€ä»¥ Redis æœ¬èº«å¹¶æ²¡æœ‰é”çš„æ¦‚å¿µã€‚\nä½†æ˜¯å¤šå®¢æˆ·ç«¯åŒæ—¶å¹¶å‘å†™åŒä¸€ä¸ª keyï¼Œä¸€ä¸ª key çš„å€¼æ˜¯ 1ï¼Œæœ¬æ¥æŒ‰é¡ºåºä¿®æ”¹ä¸º 2,3,4 ï¼Œæœ€å key å€¼æ˜¯ 4ï¼Œä½†æ˜¯å› ä¸ºå¹¶å‘å»å†™ keyï¼Œé¡ºåºå¯èƒ½å°±å˜æˆäº† 4,3,2ï¼Œæœ€å key å€¼å°±å˜æˆäº† 2ã€‚\næˆ‘è¿™ä¸ªåº“å½“å‰ä¹Ÿå°±ä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œå¦‚æœä½ éƒ¨ç½²åˆ°å¤šä¸ªæœºå­ï¼Œé‚£å°±ä½¿ç”¨ setnx(key, value) æ¥å®ç°åˆ†å¸ƒå¼é”ï¼Œæˆ‘å½“å‰å†™çš„è¿™ä¸ªåº“æ²¡æœ‰æä¾›åˆ†å¸ƒå¼é”ï¼Œå…·ä½“è¯·è‡ªè¡Œgoogleã€‚\nmanagerç»“æ„ä½“  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51  type storeType uint8 const ( // memoryStore store type  M storeType = iota // redis store type  R SessionKey = \u0026#34;session-id\u0026#34; ) // manager for session manager type manager struct { cfg *Configs store storage } func New(t storeType, cfg *Configs) { switch t { case M: // init memory storage  m := new(memoryStore) go m.gc() mgr = \u0026amp;manager{cfg: cfg, store: m} case R: // parameter verify  validate := validator.New() if err := validate.Struct(cfg); err != nil { panic(err.Error()) } // init redis storage  r := new(redisStore) r.sessions = redis.NewClient(\u0026amp;redis.Options{ Addr: cfg.RedisAddr, Password: cfg.RedisPassword, // no password set  DB: cfg.RedisDB, // use default DB  PoolSize: int(cfg.PoolSize), // connection pool size  }) // test connection  timeout, cancelFunc := context.WithTimeout(context.Background(), 8*time.Second) defer cancelFunc() if err := r.sessions.Ping(timeout).Err(); err != nil { panic(err.Error()) } mgr = \u0026amp;manager{cfg: cfg, store: r} default: panic(\u0026#34;not implement store type\u0026#34;) } }   managerç»“æ„ä½“ä¹Ÿå°±ä¸¤ä¸ªå­—æ®µï¼Œä¸€ä¸ªå­˜æ”¾æˆ‘ä»¬å…¨å±€é…ç½®ä¿¡æ¯ï¼Œä¸€ä¸ªæˆ‘ä»¬å®ä¾‹åŒ–ä¸åŒçš„æŒä¹…åŒ–å­˜å‚¨çš„å­˜å‚¨å™¨ï¼Œå…¶ä»–ä»£ç å°±æ˜¯è¾…åŠ©æ€§çš„ä»£ç ï¼Œä¸ç»†è¯´äº†ã€‚\nSessionç»“æ„ä½“  è¿™ä¸ªç»“æ„ä½“æ˜¯å¯¹åº”ç€æµè§ˆå™¨ä¼šè¯çš„ç»“æ„ä½“ï¼Œè®¾è®¡åŸåˆ™æ˜¯ä¸€ä¸ªidå¯¹åº”ä¸€ä¸ªsessionç»“æ„ä½“ã€‚\n1 2 3 4 5 6 7 8 9 10 11  type Session struct { // ä¼šè¯ID  ID string // sessionè¶…æ—¶æ—¶é—´  Expires time.Time // å­˜å‚¨æ•°æ®çš„map  Data map[interface{}]interface{} _w http.ResponseWriter // æ¯ä¸ªsessionå¯¹åº”ä¸€ä¸ªcookie  Cookie *http.Cookie }   å…·ä½“æ“ä½œå‡½æ•°:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54  // Get Retrieves the stored element data from the session via the key func (s *Session) Get(key interface{}) (interface{}, error) { err := mgr.store.Read(s) if err != nil { return nil, err } s.refreshCookie() if ele, ok := s.Data[key]; ok { return ele, nil } return nil, fmt.Errorf(\u0026#34;key \u0026#39;%s\u0026#39; does not exist\u0026#34;, key) } // Set Stores information in the session func (s *Session) Set(key, v interface{}) error { lock[\u0026#34;W\u0026#34;](func() { if s.Data == nil { s.Data = make(map[interface{}]interface{}, 8) } s.Data[key] = v }) s.refreshCookie() return mgr.store.Update(s) } // Remove an element stored in the session func (s *Session) Remove(key interface{}) error { s.refreshCookie() lock[\u0026#34;R\u0026#34;](func() { delete(s.Data, key) }) return mgr.store.Update(s) } // Clean up all data for this session func (s *Session) Clean() error { s.refreshCookie() return mgr.store.Remove(s) } // åˆ·æ–°cookie ä¼šè¯åªè¦æœ‰æ“ä½œå°±é‡ç½®ä¼šè¯ç”Ÿå‘½å‘¨æœŸ func (s *Session) refreshCookie() { s.Expires = time.Now().Add(mgr.cfg.TimeOut) s.Cookie.Expires = s.Expires // è¿™é‡Œä¸æ˜¯ä½¿ç”¨æŒ‡é’ˆ  // å› ä¸ºè¿™é‡Œæˆ‘ä»¬æ”¯æŒredis å¦‚æœwebæœåŠ¡å™¨é‡å¯äº†  // é‚£ä¹ˆsessionæ•°æ®åœ¨å†…å­˜é‡Œæ¸…ç©º  // ä»redisè¯»å–çš„\u0008æ•°æ®ååºåˆ—åŒ–åœ°å€å’Œé‡æ–°å¯åŠ¨çš„ä¸ä¸€æ ·  // æ‰€æœ‰ç›´æ¥æ•°æ®æ‹·è´  http.SetCookie(s._w, s.Cookie) }   ä¸Šé¢æ˜¯å‡ ä¸ªå‡½æ•°æ˜¯ï¼Œä¼šè¯çš„æ•°æ®æ“ä½œå‡½æ•°ï¼ŒrefreshCookie()æ˜¯ç”¨æ¥åˆ·æ–°æµè§ˆå™¨cookieä¿¡æ¯çš„ï¼Œå› ä¸ºæˆ‘åœ¨è®¾è®¡çš„æ—¶å€™åªæœ‰æµè§ˆå™¨æœ‰å¿ƒè·³ä¹Ÿå°±æ˜¯æœ‰æ“ä½œæ•°æ®çš„æ—¶å€™ï¼Œç®¡ç†å™¨å°±é»˜è®¤ä¸ºè¿™ä¸ªæµè§ˆå™¨ä¼šè¯è¿˜æ˜¯æ´»ç€çš„ï¼Œä¼šè‡ªåŠ¨åŒæ­¥æ›´æ–°cookieè¿‡æœŸæ—¶é—´ï¼Œè¿™ä¸ªæ›´æ–°è¿‡ç¨‹å¯ä¸æ˜¯å…‰åˆ·æ–°cookieå°±å®Œäº‹çš„äº†ï¼ŒæŒä¹…åŒ–çš„è¯çš„æ•°æ®è¿‡æœŸæ—¶é—´ä¹Ÿä¸€æ ·æ›´æ–°äº†ã€‚\nHandleræ–¹æ³•\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46  // Handler Get session data from the Request func Handler(w http.ResponseWriter, req *http.Request) *Session { // ä»è¯·æ±‚é‡Œé¢å–session  var session Session session._w = w cookie, err := req.Cookie(mgr.cfg.Cookie.Name) if err != nil || cookie == nil || len(cookie.Value) \u0026lt;= 0 { return createSession(w, cookie, \u0026amp;session) } // IDé€šè¿‡ç¼–ç ä¹‹åé•¿åº¦æ˜¯73ä½  if len(cookie.Value) \u0026gt;= 73 { session.ID = cookie.Value if mgr.store.Read(\u0026amp;session) != nil { return createSession(w, cookie, \u0026amp;session) } // é˜²æ­¢webæœåŠ¡å™¨é‡å¯ä¹‹åredisä¼šè¯æ•°æ®è¿˜åœ¨  // ä½†æ˜¯æµè§ˆå™¨cookieæ²¡æœ‰æ›´æ–°  // é‡æ–°åˆ·æ–°cookie  // å­˜åœ¨æŒ‡é’ˆä¸€è‡´é—®é¢˜ï¼Œè¿™æ ·æ“ä½œè¿˜æ˜¯ä¸€å—å†…å­˜ï¼Œæ‰€æœ‰æˆ‘ä»¬éœ€è¦å¤åˆ¶å‰¯æœ¬  _ = session.copy(mgr.cfg.Cookie) session.Cookie.Value = session.ID session.Cookie.Expires = session.Expires http.SetCookie(w, session.Cookie) } // åœ°å€ä¸€æ ·ä¸è¡Œï¼ï¼ï¼  // log.Printf(\u0026#34;mgr.cfg.Cookie pointer:%p \\n\u0026#34;, mgr.cfg.Cookie)  // log.Printf(\u0026#34;session.cookie pointer:%p \\n\u0026#34;, session.Cookie)  return \u0026amp;session } func createSession(w http.ResponseWriter, cookie *http.Cookie, session *Session) *Session { // init session parameter  session.ID = generateUUID() session.Expires = time.Now().Add(mgr.cfg.TimeOut) _ = mgr.store.Create(session) // é‡ç½®é…ç½®cookieæ¨¡æ¿  session.copy(mgr.cfg.Cookie) session.Cookie.Value = session.ID session.Cookie.Expires = session.Expires http.SetCookie(w, session.Cookie) return session }   Handlerå‡½æ•°æ˜¯ä»httpè¯·æ±‚é‡Œé¢è¯»å–åˆ°sessionidç„¶åä»æŒä¹…åŒ–å±‚è¯»å–æ•°æ®ç„¶åå®ä¾‹åŒ–ä¸€ä¸ªsessionç»“æ„ä½“çš„å‡½æ•°ï¼Œæ²¡æœ‰å•¥å¥½è¯´çš„ï¼Œæ³¨é‡Šå†™ä¸Šé¢äº†ã€‚\n   å®‰å…¨é˜²å¾¡é—®é¢˜  é¦–å…ˆæˆ‘è¿˜æ˜¯é‚£å¥è¯ï¼šä¸æ‡‚æ”»å‡»ï¼Œæ€ä¹ˆåšé˜²å®ˆã€‚ é‚£æˆ‘ä»¬å…ˆè¯´è¯´è¿™ä¸ªé—®é¢˜æ€ä¹ˆäº§ç”Ÿçš„:\n ä¸­é—´äººæ”»å‡»ï¼ˆMan-in-the-MiddleAttackï¼Œç®€ç§°MITMæ”»å‡»ï¼‰æ˜¯ä¸€ç§é—´æ¥çš„å…¥ä¾µæ”»å‡»ï¼Œè¿™ç§æ”»å‡»æ¨¡å¼æ˜¯é€šè¿‡å„ç§æŠ€æœ¯æ‰‹æ®µå°†å—å…¥ä¾µè€…æ§åˆ¶çš„ä¸€å°è®¡ç®—æœºè™šæ‹Ÿæ”¾ç½®åœ¨ç½‘ç»œè¿æ¥ä¸­çš„ä¸¤å°é€šä¿¡è®¡ç®—æœºä¹‹é—´ï¼Œè¿™å°è®¡ç®—æœºå°±ç§°ä¸ºä¸­é—´äººã€‚\n è¿™ä¸ªè¿‡ç¨‹ï¼Œæ­£å¸¸ç”¨æˆ·åœ¨é€šè¿‡æµè§ˆå™¨è®¿é—®æˆ‘ä»¬ç¼–å†™çš„ç½‘ç«™ï¼Œä½†æ˜¯è¿™ä¸ªæ—¶å€™æœ‰ä¸ªhacké€šè¿‡arpæ¬ºéª—ï¼ŒæŠŠè·¯ç”±å™¨çš„æµé‡åŠ«æŒåˆ°ä»–çš„ç”µè„‘ä¸Šï¼Œç„¶åé»‘å®¢é€šè¿‡ä¸€äº›ç‰¹æ®Šçš„è½¯ä»¶æŠ“åŒ…ä½ çš„ç½‘ç»œè¯·æ±‚æµé‡ä¿¡æ¯ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­å¦‚æœä½ sessionidå¦‚æœå­˜æ”¾åœ¨cookieä¸­ï¼Œå¾ˆæœ‰å¯èƒ½è¢«é»‘å®¢æå–å¤„ç†ï¼Œå¦‚æœä½ è¿™ä¸ªæ—¶å€™ç™»å½•äº†ç½‘ç«™ï¼Œè¿™æ˜¯é»‘å®¢å°±æ‹¿åˆ°ä½ çš„ç™»å½•å‡­è¯ï¼Œç„¶ååœ¨ç™»å½•è¿›è¡Œé‡æ”¾ä¹Ÿå°±æ˜¯ä½¿ç”¨ä½ çš„sessionidï¼Œä»è€Œè¾¾åˆ°è®¿é—®ä½ è´¦æˆ·ç›¸å…³çš„æ•°æ®ç›®çš„ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19  func (s *Session) MigrateSession() error { // è¿ç§»åˆ°æ–°å†…å­˜ é˜²æ­¢ä¼šè¯ä¸€è‡´å¼•å‘å®‰å…¨é—®é¢˜  // è¿™ä¸ªé—®é¢˜çš„æ ¹æºåœ¨ sessionid ä¸å˜ï¼Œå¦‚æœç”¨æˆ·åœ¨æœªç™»å½•æ—¶æ‹¿åˆ°çš„æ˜¯ä¸€ä¸ª sessionidï¼Œç™»å½•ä¹‹åæœåŠ¡ç«¯ç»™ç”¨æˆ·é‡æ–°æ¢ä¸€ä¸ª sessionidï¼Œå°±å¯ä»¥é˜²æ­¢ä¼šè¯å›ºå®šæ”»å‡»äº†ã€‚  s.ID = generateUUID() newSession, err := deepcopy.Anything(s) if err != nil { return errors.New(\u0026#34;migrate session make a deep copy from src into dst failed\u0026#34;) } newSession.(*Session).ID = s.ID newSession.(*Session).Cookie.Value = s.ID newSession.(*Session).Expires = time.Now().Add(mgr.cfg.TimeOut) newSession.(*Session)._w = s._w newSession.(*Session).refreshCookie() // æ–°å†…å­˜å¼€å§‹æŒä¹…åŒ–  // log.Printf(\u0026#34;old session pointer:%p \\n\u0026#34;, s)  // log.Printf(\u0026#34;new session pointer:%p \\n\u0026#34;, newSession.(*Session))  //log.Println(\u0026#34;MigrateSession:\u0026#34;, newSession.(*Session))  return mgr.store.Create(newSession.(*Session)) }   å¦‚æœå¤§å®¶å†™è¿‡Javaè¯­è¨€ï¼Œéƒ½åº”è¯¥ä½¿ç”¨è¿‡springbootè¿™ä¸ªæ¡†æ¶ï¼Œå¦‚æœä½ çœ‹è¿‡æºä»£ç ï¼Œé‚£å°±çŸ¥é“è¿™ä¸ªæ¡†æ¶é‡Œé¢çš„sessionå®‰å…¨ç­–ç•¥æœ‰ä¸€ä¸ªmigrateSessioné€‰é¡¹ï¼Œè¡¨ç¤ºåœ¨ç™»å½•æˆåŠŸä¹‹åï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ä¼šè¯ï¼Œç„¶åè®²æ—§çš„ session ä¸­çš„ä¿¡æ¯å¤åˆ¶åˆ°æ–°çš„ session ä¸­ã€‚\næˆ‘å‚ç…§ä»–çš„ç­–ç•¥ï¼Œä¹ŸåŒæ ·åœ¨æˆ‘è¿™ä¸ªåº“é‡Œé¢å®ç°äº†ï¼Œåœ¨ç”¨æˆ·åŒ¿åè®¿é—®çš„æ—¶å€™æ˜¯ä¸€ä¸ª sessionidï¼Œå½“ç”¨æˆ·æˆåŠŸç™»å½•ä¹‹åï¼Œåˆæ˜¯å¦å¤–ä¸€ä¸ª sessionidï¼Œè¿™æ ·å°±å¯ä»¥æœ‰æ•ˆé¿å…ä¼šè¯å›ºå®šæ”»å‡»ã€‚\nä½¿ç”¨çš„æ—¶å€™ä¹Ÿå¯ä»¥éšæ—¶ä½¿ç”¨é€šè¿‡MigrateSessionè¿›è¡Œè°ƒç”¨ï¼Œè¿™ä¸ªå‡½æ•°ä¸€ä½†è¢«è°ƒç”¨ï¼ŒåŸå§‹æ•°æ®å’Œidå…¨éƒ¨è¢«åˆ·æ–°äº†ï¼Œå†…å­˜åœ°å€ä¹Ÿæ¢äº†ï¼Œå¯ä»¥çœ‹æˆ‘çš„æºä»£ç ã€‚\n   ä½¿ç”¨æ¼”ç¤º  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60  package main import ( \u0026#34;fmt\u0026#34; \u0026#34;log\u0026#34; \u0026#34;net/http\u0026#34; \u0026#34;time\u0026#34; sessionx \u0026#34;github.com/higker/sesssionx\u0026#34; ) var ( // é…ç½®ä¿¡æ¯  cfg = \u0026amp;sessionx.Configs{ TimeOut: time.Minute * 30, RedisAddr: \u0026#34;127.0.0.1:6379\u0026#34;, RedisDB: 0, RedisPassword: \u0026#34;redis.nosql\u0026#34;, RedisKeyPrefix: sessionx.SessionKey, PoolSize: 100, Cookie: \u0026amp;http.Cookie{ Name: sessionx.SessionKey, Path: \u0026#34;/\u0026#34;, Expires: time.Now().Add(time.Minute * 30), // TimeOut  Secure: false, HttpOnly: true, }, } ) func main() { // Rè¡¨ç¤ºrediså­˜å‚¨ cfgæ˜¯é…ç½®ä¿¡æ¯ \tsessionx.New(sessionx.R, cfg) http.HandleFunc(\u0026#34;/set\u0026#34;, func(writer http.ResponseWriter, request *http.Request) { session := sessionx.Handler(writer, request) session.Set(\u0026#34;K\u0026#34;, time.Now().Format(\u0026#34;2006 01-02 15:04:05\u0026#34;)) fmt.Fprintln(writer, \u0026#34;set time value succeed.\u0026#34;) }) http.HandleFunc(\u0026#34;/get\u0026#34;, func(writer http.ResponseWriter, request *http.Request) { session := sessionx.Handler(writer, request) v, err := session.Get(\u0026#34;K\u0026#34;) if err != nil { fmt.Fprintln(writer, err.Error()) return } fmt.Fprintln(writer, fmt.Sprintf(\u0026#34;The stored value is : %s\u0026#34;, v)) }) http.HandleFunc(\u0026#34;/migrate\u0026#34;, func(writer http.ResponseWriter, request *http.Request) { session := sessionx.Handler(writer, request) err := session.MigrateSession() if err != nil { log.Println(err) } fmt.Fprintln(writer, session) }) _ = http.ListenAndServe(\u0026#34;:8080\u0026#34;, nil) }      å° ç»“  æ¨èè¿˜æ˜¯ä½¿ç”¨JWTè¿™ç§æ–¹å¼åšé‰´æƒï¼Œä¸è¿‡ä¹Ÿæœ‰ä¸€ä½“åŒ–webåº”ç”¨çš„sessionä¹Ÿä¸ä¼šè¢«è¿™ä¹ˆæ—©æ·˜æ±°ï¼Œå¦‚æœä¸Šé¢æœ‰é—®é¢˜ï¼Œæ¬¢è¿å¤§ä½¬ä»¬prï¼Œè¿˜æœ‰éƒ¨åˆ†ä»£ç æ²¡æœ‰åˆ—å‡ºï¼Œå¯ä»¥å»ä»“åº“çœ‹çœ‹ã€‚\n   ç›¸å…³é“¾æ¥  ä»£ç ä»“åº“ï¼šhttps://github.com/auula/sessionx\n","date":"Sep 16","permalink":"http://blog.ibyte.me/post/golang-web-session-implement/","tags":null,"title":"Golang Web Session Implement"},{"categories":null,"contents":"   å‰ è¨€  è°ˆåˆ°åˆ†å¸ƒå¼åº”ç”¨é‚£å¿…ç„¶ç¦»ä¸å¼€åˆ†å¸ƒå¼é”ğŸ”çš„é—®é¢˜ï¼Œåˆ†å¸ƒå¼é”åœ¨åˆ†å¸ƒå¼åº”ç”¨ä¸­åº”ç”¨å¹¿æ³›ï¼Œæœ¬æ–‡å°±è®²è®²åŸºäºrediså®ç°çš„åˆ†å¸ƒå¼é”çš„ä¸€äº›é—®é¢˜ã€‚\n   é”  å¯èƒ½å„ä½coderæ¥è§¦æœ€å¤šçš„è¿˜æ˜¯åœ¨å¤šçº¿ç¨‹çš„ç¯å¢ƒä¸‹ï¼Œä¸ºäº†ä¿è¯ä¸€ä¸ªä»£ç å—åœ¨åŒä¸€æ—¶é—´åªèƒ½ç”±ä¸€ä¸ªçº¿ç¨‹è®¿é—®æƒ…å†µï¼Œä¾‹å¦‚ä¸‹å›¾ï¼š\nå¯¹äºå•è¿›ç¨‹çš„å¹¶å‘åœºæ™¯ï¼Œå¯ä»¥ä½¿ç”¨ç¼–ç¨‹è¯­è¨€åŠç›¸åº”çš„ç±»åº“æä¾›çš„é”ï¼Œå¦‚Javaä¸­çš„ synchronized è¯­æ³•ä»¥åŠ ReentrantLockï¼ŒGolangä¸­çš„syncåŒ…ä¸‹é¢çš„mutexï¼ŒRustä¸­çš„async_std::sync::Mutexï¼Œé¿å…å¹¶å‘é—®é¢˜ï¼Œè¿™å®é™…ä¸Šæ˜¯æœ¬åœ°é”çš„æ–¹å¼ã€‚\n   åˆ†å¸ƒå¼é”  ä½†æ˜¯ç°åœ¨æµè¡Œçš„åˆ†å¸ƒå¼æ¶æ„ï¼Œåœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ï¼Œå¦‚ä½•ä¿è¯ä¸åŒèŠ‚ç‚¹çš„çº¿ç¨‹åŒæ­¥æ‰§è¡Œå‘¢ï¼Ÿæˆ–è€…å…±äº«èµ„æºæ€ä¹ˆä¸Šé”å‘¢ï¼Ÿï¼Ÿï¼Ÿ\nåœ¨å°†åº”ç”¨æ‹†åˆ†ä¸ºåˆ†å¸ƒå¼åº”ç”¨ä¹‹å‰çš„å•æœºç³»ç»Ÿä¸­ï¼Œå¯¹ä¸€äº›å¹¶å‘åœºæ™¯è¯»å–å…¬å…±èµ„æºæ—¶å¦‚æ‰£åº“å­˜ï¼Œå–è½¦ç¥¨ä¹‹ç±»çš„éœ€æ±‚å¯ä»¥ç®€å•çš„ä½¿ç”¨åŒæ­¥æˆ–è€…æ˜¯åŠ é”å°±å¯ä»¥å®ç°ï¼Œä½†æ˜¯åº”ç”¨åˆ†å¸ƒå¼äº†ä¹‹åç³»ç»Ÿç”±ä»¥å‰çš„å•è¿›ç¨‹å¤šçº¿ç¨‹çš„ç¨‹åºå˜ä¸ºäº†å¤šè¿›ç¨‹å¤šçº¿ç¨‹ï¼Œè¿™æ—¶ä½¿ç”¨ä»¥ä¸Šçš„è§£å†³æ–¹æ¡ˆæ˜æ˜¾å°±ä¸å¤Ÿäº†ã€‚\nä¸€èˆ¬ä¸šç•Œæœ‰å‡ ç§è§£å†³æ–¹:\n åŸºäº DB çš„å”¯ä¸€ç´¢å¼• åŸºäº Memcachedçš„ add å‘½ä»¤ åŸºäº Zookeeper çš„ä¸´æ—¶æœ‰åºèŠ‚ç‚¹ åŸºäº Redis çš„NX EX åŸºäºChubbyç²—ç²’åº¦åˆ†å¸ƒå¼é”æœåŠ¡     Redisçš„å‘ä½ å¡«äº†å‡ ä¸ªï¼Ÿ   å¦‚æœåœ¨åˆ†å¸ƒå¼åœºæ™¯ä¸­ï¼Œå®ç°ä¸åŒå®¢æˆ·ç«¯çš„çº¿ç¨‹å¯¹ä»£ç å’Œèµ„æºçš„åŒæ­¥è®¿é—®ï¼Œä¿è¯åœ¨å¤šçº¿ç¨‹ä¸‹å¤„ç†å…±äº«æ•°æ®çš„å®‰å…¨æ€§ï¼Œå°±éœ€è¦ç”¨åˆ°åˆ†å¸ƒå¼é”æŠ€æœ¯ï¼Œæˆ‘å°±æ¥å†™å†™åŸºäºRedisçš„ä¸€äº›å‘ğŸ˜ã€‚\n åœ¨åˆ†å¸ƒå¼æ—¶ï¼Œåœ¨ç¨‹åºä¸­ä¿®æ”¹å·²æœ‰æ•°æ®æ—¶ï¼Œéœ€è¦å…ˆè¯»å–ï¼Œç„¶åè¿›è¡Œä¿®æ”¹ä¿å­˜ï¼Œæ­¤æ—¶å¾ˆå®¹æ˜“é‡åˆ°å¹¶å‘é—®é¢˜ã€‚ç”±äºä¿®æ”¹å’Œä¿å­˜ä¸æ˜¯åŸå­æ“ä½œï¼Œåœ¨å¹¶å‘åœºæ™¯ä¸‹ï¼Œéƒ¨åˆ†å¯¹æ•°æ®çš„æ“ä½œå¯èƒ½ä¼šä¸¢å¤±ï¼Œæœ¬åœ°é”æ— æ³•åœ¨å¤šä¸ªæœåŠ¡å™¨ä¹‹é—´ç”Ÿæ•ˆï¼Œè¿™æ—¶å€™ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§å°±éœ€è¦åˆ†å¸ƒå¼é”æ¥å®ç°ã€‚\nRedis é”ä¸»è¦åˆ©ç”¨ Redis çš„ setnx å‘½ä»¤å®ç°ï¼Œ\n åŠ é”å‘½ä»¤ï¼šSETNX key valueï¼Œå½“é”®ä¸å­˜åœ¨æ—¶ï¼Œå¯¹é”®è¿›è¡Œè®¾ç½®æ“ä½œå¹¶è¿”å›æˆåŠŸï¼Œå¦åˆ™è¿”å›å¤±è´¥,KEY æ˜¯é”çš„å”¯ä¸€æ ‡è¯†ï¼Œä¸€èˆ¬æŒ‰ä¸šåŠ¡æ¥å†³å®šå‘½åã€‚ è§£é”å‘½ä»¤ï¼šDEL keyï¼Œé€šè¿‡åˆ é™¤é”®å€¼å¯¹é‡Šæ”¾é”ï¼Œä»¥ä¾¿å…¶ä»–çº¿ç¨‹å¯ä»¥é€šè¿‡ SETNX å‘½ä»¤æ¥è·å–é”ã€‚ é”è¶…æ—¶ï¼šEXPIRE key timeout, è®¾ç½® key çš„è¶…æ—¶æ—¶é—´ï¼Œä»¥ä¿è¯å³ä½¿é”æ²¡æœ‰è¢«æ˜¾å¼é‡Šæ”¾ï¼Œé”ä¹Ÿå¯ä»¥åœ¨ä¸€å®šæ—¶é—´åè‡ªåŠ¨é‡Šæ”¾ï¼Œé¿å…èµ„æºè¢«æ°¸è¿œé”ä½ã€‚  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20  // ä¼ªä»£ç å®ç° fn main(){letkey: \u0026amp;\u0026#39;staticstr=\u0026#34;sync_lock\u0026#34;;ifup_lock(key,1)==1{// è®¾ç½®è¶…æ—¶ expire(key,30)// .....ä¸šåŠ¡é€»è¾‘ }}// åŸºäºredis SETNX å’Œ EXPIRE çš„å®ç°ï¼Œé—®é¢˜ä»£ç  fn up_lock(key: \u0026amp;\u0026#39;staticstr,num: i8)-\u0026gt; i8 {// ..... ä¸Šé”é€»è¾‘ return1;}fn expire(key: \u0026amp;\u0026#39;staticstr,num: i8){// ... è‡ªå®šä¹‰è¶…æ—¶ }  å†™å®Œè¿™ä¹ˆä¸€çœ‹è¿˜æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œå…¶å®ä¸Šé¢ğŸ•³å‘å¤§ç€å‘¢ï¼ï¼ï¼å¦‚æœä½ æ˜¯è¿™ä¹ˆå»å®ç°çš„ï¼Œé‚£ç¬”è€…æ­å–œä½ ï¼Œä½ æ‰å‘é‡Œäº†ğŸ˜œï¼ˆPS:è¿™é‡Œä¸æ˜¯ä»£ç é—®é¢˜å¯¼è‡´çš„ï¼Œè€Œæ˜¯SETNX å’Œ EXPIRE éåŸå­æ€§å¯¼è‡´çš„ï¼‰ã€‚\n  SETNX å’Œ EXPIRE éåŸå­æ€§  å¦‚æœ SETNX æˆåŠŸï¼Œåœ¨è®¾ç½®é”è¶…æ—¶æ—¶é—´åï¼ŒæœåŠ¡å™¨æŒ‚æ‰ã€é‡å¯æˆ–ç½‘ç»œé—®é¢˜ç­‰ï¼Œå¯¼è‡´ EXPIRE å‘½ä»¤æ²¡æœ‰æ‰§è¡Œï¼Œé”æ²¡æœ‰è®¾ç½®è¶…æ—¶æ—¶é—´å˜æˆæ­»é”ã€‚\n é”è¯¯è§£é™¤  å¦‚æœçº¿ç¨‹ A æˆåŠŸè·å–åˆ°äº†é”ï¼Œå¹¶ä¸”è®¾ç½®äº†è¿‡æœŸæ—¶é—´ 30 ç§’ï¼Œä½†çº¿ç¨‹ A æ‰§è¡Œæ—¶é—´è¶…è¿‡äº† 30 ç§’ï¼Œé”è¿‡æœŸè‡ªåŠ¨é‡Šæ”¾ï¼Œæ­¤æ—¶çº¿ç¨‹ B è·å–åˆ°äº†é”ï¼›éšå A æ‰§è¡Œå®Œæˆï¼Œçº¿ç¨‹ A ä½¿ç”¨ DEL å‘½ä»¤æ¥é‡Šæ”¾é”ï¼Œä½†æ­¤æ—¶çº¿ç¨‹ B åŠ çš„é”è¿˜æ²¡æœ‰æ‰§è¡Œå®Œæˆï¼Œçº¿ç¨‹Aå®é™…é‡Šæ”¾çš„çº¿ç¨‹æ˜¯ B åŠ çš„é”ï¼Œä»è€Œå¯¼è‡´é”æ··ä¹±ï¼Œç„¶åå¯¼è‡´å®é™…é€»è¾‘ä»£ç æ··ä¹±å’Œä¹ƒè‡³å…³é”®æ•°æ®ä¸¢å¤±ã€‚\n è¶…æ—¶è§£é”å¯¼è‡´å¹¶å‘  å¦‚æœçº¿ç¨‹ A æˆåŠŸè·å–é”å¹¶è®¾ç½®è¿‡æœŸæ—¶é—´ 30 ç§’ï¼Œä½†çº¿ç¨‹ A æ‰§è¡Œæ—¶é—´è¶…è¿‡äº† 30 ç§’ï¼Œé”è¿‡æœŸè‡ªåŠ¨é‡Šæ”¾ï¼Œæ­¤æ—¶çº¿ç¨‹ B è·å–åˆ°äº†é”ï¼Œçº¿ç¨‹ A å’Œçº¿ç¨‹ B å¹¶å‘æ‰§è¡Œï¼Œé‚£å°±æ²¡æœ‰åˆ†å¸ƒå¼é”å­˜åœ¨çš„æ„ä¹‰äº†ğŸ¤·â€ã€‚\n å°†è¿‡æœŸæ—¶é—´è®¾ç½®è¶³å¤Ÿé•¿ï¼Œç¡®ä¿ä»£ç é€»è¾‘åœ¨é”é‡Šæ”¾ä¹‹å‰èƒ½å¤Ÿæ‰§è¡Œå®Œæˆã€‚ ä¸ºè·å–é”çš„çº¿ç¨‹å¢åŠ å®ˆæŠ¤çº¿ç¨‹ï¼Œä¸ºå°†è¦è¿‡æœŸä½†æœªé‡Šæ”¾çš„é”å¢åŠ æœ‰æ•ˆæ—¶é—´ã€‚   ä¸å¯é‡å…¥  å½“çº¿ç¨‹åœ¨æŒæœ‰é”çš„æƒ…å†µä¸‹å†æ¬¡è¯·æ±‚åŠ é”ï¼Œå¦‚æœä¸€ä¸ªé”æ”¯æŒä¸€ä¸ªçº¿ç¨‹å¤šæ¬¡åŠ é”ï¼Œé‚£ä¹ˆè¿™ä¸ªé”å°±æ˜¯å¯é‡å…¥çš„ï¼Œå¦‚æœä¸€ä¸ªä¸å¯é‡å…¥é”è¢«å†æ¬¡åŠ é”ï¼Œç”±äºè¯¥é”å·²ç»è¢«æŒæœ‰ï¼Œå†æ¬¡åŠ é”ä¼šå¤±è´¥ã€‚Redis å¯é€šè¿‡å¯¹é”è¿›è¡Œé‡å…¥è®¡æ•°ï¼ŒåŠ é”æ—¶åŠ  1ï¼Œè§£é”æ—¶å‡ 1ï¼Œå½“è®¡æ•°å½’ 0 æ—¶é‡Šæ”¾é”ã€‚\n   å° ç»“  Redisæ˜¯ä¸ªé«˜æ€§èƒ½çš„ä¸­é—´ä»¶ï¼Œä½†æ˜¯å¦‚æœç”¨åœ¨åˆ†å¸ƒå¼é”ä¸Šå®ç°ä¾ç„¶å­˜åœ¨é—®é¢˜ï¼Œæˆ‘åœ¨ä¸€äº›ç½‘ç»œæ–‡ç« çœ‹åˆ°å¾ˆå¤šäººå¤§éƒ¨åˆ†éƒ½æ˜¯ç”¨redisæ¥è§£å†³åˆ†å¸ƒå¼é”é—®é¢˜ï¼Œå¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¸®åŠ©åˆ°ä½ ï¼Œè®°å¾—ç‚¹ä¸ªå…³æ³¨ï¼ï¼\n","date":"Sep 16","permalink":"http://blog.ibyte.me/post/redis-distributed-lock/","tags":null,"title":"Redis Distributed Lock"},{"categories":null,"contents":"   ğŸ‘¨â€ğŸ’»â€ï¼šç›´å¥”è¯é¢˜ HotRingï¼Œå°‘è¯´åºŸè¯ã€‚   å»å¹´é˜¿é‡Œçš„Tairå›¢é˜Ÿå‘è¡¨è¿‡ä¸€ç¯‡è®ºæ–‡HotRing: A Hotspot-Aware In-Memory Key-Value Storeï¼Œè¿™ç¯‡è®ºæ–‡é‡Œé¢è®²è¿°äº†é˜¿é‡Œçš„æœ€å¿«çš„KVåˆ†å¸ƒå¼å­˜å‚¨å¼•æ“æ ¸å¿ƒHotRingçš„æŠ€æœ¯ä¸å®ç°ï¼Œæˆ‘çœ‹äº†ä»–ä»¬çš„æ•°æ®æ˜¾ç¤ºå…¶å¼•æ“ååæ€§èƒ½å¯è¾¾600M ops/sï¼Œè¿™ä¸ªé€Ÿåº¦æ¯”ä¼ ç»Ÿçš„KVSç³»ç»Ÿ2.58å€çš„æ€§èƒ½æå‡ï¼Œäºæ˜¯æˆ‘å°±æŠ±ç€å¥½å¥‡å»çœ‹çœ‹äº†é‚£ç¯‡è®ºæ–‡ç„¶åå°±æœ‰è¿™ç¯‡æ–‡ç« ã€‚\n    ğŸ‘¨â€ğŸ’»â€ï¼š æœ‰é—®é¢˜å°±æœ‰æ•…äº‹ï¼Ÿ  ä¸€ä¸ªæ–°ä¸œè¥¿æˆ–è€…æŠ€æœ¯å‡ºç°ï¼Œé‚£å°±è¯´æ˜è€çš„é‚£å¥—æ–¹æ¡ˆæŠ€æœ¯å­˜åœ¨æŸç§ç¼ºé™·æˆ–è€…æ»¡è¶³ä¸äº†æŸç§çš„ç‰¹æ®Šéœ€æ±‚äº†\u0026hellip;\u0026hellip;\né—®é¢˜åŠ¨æœºå°±æ˜¯ï¼šæŸä¸€æ—¶åˆ»æµé‡ä¸Šæ¥äº†ï¼Œç³»ç»Ÿæ‰›ä¸ä½äº†\u0026hellip; åªè¦è¯´åˆ°é«˜å¹¶å‘ï¼Œç›¸ä¿¡è¿™ä¸ªå›ç­”å å¤§å¤šæ•°ã€‚HotRingçš„å‡ºç°ä¹Ÿæ˜¯è¿™ä¸ªåŸå› ï¼ŒçœŸçš„æ˜¯é¢å‘é—®é¢˜ç¼–ç¨‹ğŸ˜œã€‚ã€‚ã€‚æŒ–æ§½ï¼ŒçœŸçš„éªŒè¯è¿™å¥è¯äº†ã€‚ã€‚ã€‚\nè¿™å¼ å›¾å°±æ˜¯ä¼ ç»Ÿçš„kvsæ¶æ„å›¾ï¼Œä¸ç®¡ä½ ä¸­é—´çš„é‚£ä¸€å±‚ç”¨ä»€ä¹ˆï¼Œåœ¨æŸäº›æ—¶åˆ»ï¼Œç¼“å­˜ç³»ç»Ÿè¿æ¥å·¨å¤§çš„è®¿é—®é‡ï¼ˆåŒ11ç§’æ€ï¼‰ï¼Œå¯èƒ½å­˜åœ¨è®¿é—®å€¾æ–œ(ä»€ä¹ˆï¼Ÿä½ é—®æˆ‘ä»€ä¹ˆæ˜¯è®¿é—®å€¾æ–œï¼Œå¥½å§ä½ ä¸é€‚åˆç¼–ç¨‹ã€‚ğŸ˜œ)ï¼Œå¤§å¤šæ•°è®¿é—®é›†ä¸­åœ¨æå°‘æ•°æ•°æ®ä¸Šï¼ˆä¾‹å¦‚å¾®åšçƒ­ç‚¹äº‹ä»¶ï¼‰ã€‚\nå¯¹äºé›†ç¾¤çº§åˆ«çš„çƒ­ç‚¹ç›‘æµ‹å€å—é‡è§†ï¼Œå¦‚ä¸€è‡´æ€§ Hashï¼ŒæŸä¸ªèŠ‚ç‚¹ä¸Šçš„æ•°æ®è¢«è¯»å†™è®¿é—®æ¬¡æ•°è¿œè¿œé«˜å‡ºå…¶ä»–èŠ‚ç‚¹ï¼Œå¯¹æ­¤ç±»è¡Œä¸ºæ²¡æœ‰å¾ˆå¥½çš„ç›‘æµ‹åˆ°ã€‚\nè¿˜æœ‰å•æœºçƒ­é—®é¢˜ä¸Šæ²¡æœ‰ä¼˜åŒ–ï¼Œä¾‹å¦‚è®¡ç®—æœºå†…å­˜çš„KVå­˜å‚¨çƒ­ç‚¹å’ŒæŸ¥è¯¢é€Ÿåº¦æ²¡æœ‰ä¼˜åŒ–ã€‚\nä¸€ä¸ªå¥½çš„å­˜å‚¨è¿™äº›äº‹æƒ…éƒ½æ˜¯å¿…é¡»å»åšçš„ï¼Œä»ä¸Šåˆ°ä¸‹ï¼Œä»ä¸‹åˆ°ä¸Šï¼Œæ¯å±‚éƒ½åœ¨è§£å†³ä¸€éƒ¨åˆ†é—®é¢˜ï¼Œæ€»å’Œå°±æ˜¯ä¸€ä¸ªå¤§çš„é—®é¢˜ï¼Œå¦‚æœä½ ä¸èƒ½æŠŠé—®é¢˜æ‹†æˆå°é—®é¢˜ï¼Œé‚£ä½ é‚£ä¸ªé—®é¢˜ä¸ä¸€å®šèƒ½è§£å†³çš„å¥½ï¼Œä¾‹å¦‚CPU Cacheã€LevelDBçš„è®¾è®¡ã€‚\n   ğŸ‘¨â€ğŸ’»â€ï¼šHotRing å¹²äº†ä»€ä¹ˆï¼Ÿï¼Ÿï¼Ÿ  ç°æœ‰æŠ€æœ¯ï¼Œå†…å­˜ KVS å¯¹æ—¶å»¶è¦æ±‚æ˜¯å¾ˆé«˜çš„ï¼Œä¸€ä¸ªåœ¨å¹¶å‘ä¸­æ— é”çš„æ•°æ®ç»“æ„å°¤ä¸ºé‡è¦ï¼Œç„¶åå°±æ˜¯ä¸€ä¸ªèƒ½è®©çƒ­ç‚¹æ•°æ®èƒ½è‡ªæˆ‘è·‘åˆ°æœ€å®¹æ˜“è®¿é—®çš„åœ°æ–¹æé«˜è¯»å–é€Ÿåº¦çš„ã€‚\n çƒ­ç‚¹æ˜¯åŠ¨æ€å˜åŒ–çš„ï¼Œå¦‚ä½•æ£€æµ‹ï¼Œå¦‚ä½•è½¬ç§»?  è¿™ä¸ªé—®é¢˜æ˜¯é€ƒä¸å¼€çš„ï¼Œåœ¨HotRingçš„è®¾è®¡ï¼Œè®ºæ–‡ä¸­æåˆ°äº†ä¸€ä¸ªæ¦‚å¿µå°±æ˜¯æœ‰åºç¯ã€‚\nå®ƒåšäº†ä»€ä¹ˆï¼Ÿçœ‹å¾—æ‡‚ä¸Šå›¾å°±èƒ½çœ‹å‡ºæ¥ï¼Œä»–æŠŠä¼ ç»Ÿçš„Mapçš„åº•å±‚çš„å­˜å‚¨é“¾è¡¨+æ•°ç»„ç»“æ„æ¢æˆäº†ä¸€ä¸ªç¯å½¢é“¾ç»“æ„ï¼Œç„¶åé€šè¿‡headè‡ªç”±çš„æ§åˆ¶æŒ‡å‘å“ªä¸€ä¸ªèŠ‚ç‚¹ã€‚\nä¼ ç»Ÿçš„ç»“æ„å¯èƒ½ä½ çš„æ•°æ®åœ¨æœ€åä¸€å±‚æˆ–è€…æ•°æ®éå¸¸å¤šï¼Œç¨‹åºåªèƒ½é€šè¿‡headé¡ºåºæŸ¥æ‰¾ï¼Œæ—¶é—´å¤æ‚åº¦O(n)\nè€Œç¯å½¢çš„ç»“æ„ï¼Œé¿å…å¤šæ¬¡éå†å¸Œæœ›æŠŠçƒ­ç‚¹æ•°æ®æ”¾åœ¨å†²çªé“¾å‰é¢ï¼Œä¼ ç»Ÿçš„åˆ™éœ€è¦ä¸æ–­ä¿®æ”¹èŠ‚ç‚¹ï¼Œéœ€è¦ä¸æ–­ç§»åŠ¨èŠ‚ç‚¹ï¼Œå¿…é¡»ä»å¤´èŠ‚ç‚¹å¼€å§‹ï¼Œåˆ°å°¾èŠ‚ç‚¹ç»ˆæ­¢ã€‚ç§»åŠ¨å¤´æŒ‡é’ˆçš„æƒ…å†µä¸‹ï¼Œä¼šå¯¼è‡´ä¸€äº›èŠ‚ç‚¹æ— æ³•è¢«è®¿é—®ã€‚\nç§»åŠ¨çƒ­ç‚¹ä¸æ–¹ä¾¿ï¼Œéœ€è¦æŠŠä¸­é—´èŠ‚ç‚¹ç§»åŠ¨åˆ°å¤´èŠ‚ç‚¹å»ï¼Œç§»åŠ¨é“¾è¡¨ä¸­çš„èŠ‚ç‚¹å¾ˆå¤æ‚ä¸”éš¾ä»¥åšåˆ°æ— é”å¹¶å‘ï¼Œå°±ä¸Šå›¾è¿™ä¸ªæ“ä½œå°±è¦3æ­¥ã€‚\næ”¹æˆç¯é“¾ï¼ŒHeadå¯ä»¥æŒ‡å‘ä»»æ„èŠ‚ç‚¹ï¼Œå³ä»ä»»æ„èŠ‚ç‚¹å¼€å§‹éå†ï¼Œç„¶åè¿˜èƒ½å¯¹æ•°æ®è¿›è¡Œæ’åºã€‚\nä¸ºä»€ä¹ˆæœ‰åº???  è¿™ä¸ªå°±å±äºç¯é“¾çš„ç‰¹ç‚¹äº†ï¼Œæ²¡æœ‰ç»ˆç»“ç‚¹ï¼Œå¦‚æœæŸ¥æ‰¾å€¼ä¸å­˜åœ¨ï¼Œæ— æ³•åˆ¤æ–­ä½•æ—¶ç»ˆç»“ã€‚æ”¹æˆæœ‰åºçš„äº†ï¼Œå¯ä»¥æ ¹æ®å‰åé¡¹çš„å…³ç³»åˆ¤æ–­æ˜¯å¦ç»ˆç»“æœ¬æ¬¡æŸ¥è¯¢ã€‚\n å‰é©±èŠ‚ç‚¹ \u0026lt; å¾…æŸ¥æ‰¾èŠ‚ç‚¹ \u0026lt;åé©±èŠ‚ç‚¹ miss å‰é©±èŠ‚ç‚¹ \u0026gt; åé©±èŠ‚ç‚¹ \u0026amp;\u0026amp; å¾…æŸ¥æ‰¾èŠ‚ç‚¹ \u0026lt; åé©±èŠ‚ç‚¹ miss å‰é©±èŠ‚ç‚¹ \u0026gt; åé©±èŠ‚ç‚¹ \u0026amp;\u0026amp; å¾…æŸ¥æ‰¾èŠ‚ç‚¹ \u0026gt; å‰é©±èŠ‚ç‚¹ miss å¾…æŸ¥æ‰¾èŠ‚ç‚¹ == èŠ‚ç‚¹ K hit  æ’åºçš„è¿‡ç¨‹å°±æ˜¯åˆ©ç”¨keyæ’åºå¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè‹¥ç›®æ ‡keyä»‹äºè¿ç»­ä¸¤ä¸ªitemçš„keyä¹‹é—´ï¼Œè¯´æ˜ä¸ºread missæ“ä½œï¼Œå³å¯ç»ˆæ­¢è¿”å›ã€‚ç”±äºå®é™…ç³»ç»Ÿä¸­ï¼Œæ•°æ®keyçš„å¤§å°é€šå¸¸ä¸º10~100Bï¼Œæ¯”è¾ƒä¼šå¸¦æ¥å·¨å¤§çš„å¼€é”€ã€‚å“ˆå¸Œç»“æ„åˆ©ç”¨tagæ¥å‡å°‘keyçš„æ¯”è¾ƒå¼€é”€ã€‚\ntagæ˜¯å“ˆå¸Œå€¼çš„ä¸€éƒ¨åˆ†ï¼Œæ¯ä¸ªkeyè®¡ç®—çš„å“ˆå¸Œå€¼ï¼Œå‰kä½ç”¨æ¥å“ˆå¸Œè¡¨çš„å®šä½ï¼Œån-kä½ä½œä¸ºå†²çªé“¾ä¸­è¿›ä¸€æ­¥åŒºåˆ†keyçš„æ ‡å¿—ã€‚ä¸ºäº†å‡å°æ’åºå¼€é”€ï¼Œæˆ‘ä»¬æ„å»ºå­—å…¸åºï¼šorder = (tag, key)ï¼Œå…ˆæ ¹æ®tagè¿›è¡Œæ’åºï¼Œtagç›¸åŒå†æ ¹æ®keyè¿›è¡Œæ’åºã€‚\næœ‰äº†è¿™äº›æ¡ä»¶ï¼ŒHotRingå°±æ˜¯å¯æ§çš„äº†ã€‚\n   ğŸ”¥ï¼šçƒ­ç‚¹æ•°æ®è·Ÿè¸ª  ç”±äºåœ¨ä¸åŒçš„æ—¶é—´é‡Œï¼Œçƒ­ç‚¹æ•°æ®éƒ½æ˜¯ä¸åœå˜åŒ–çš„ï¼Œå¯èƒ½t1-t2è¿™ä¸ªæ—¶é—´æ®µçƒ­çš„æ•°æ®å¯èƒ½æ˜¯åœ¨n1èŠ‚ç‚¹ä¸Šï¼Œåœ¨tæ®µæ•°æ®åæœ‰å‘ç”Ÿäº†å˜åŒ–åœ¨n2èŠ‚ç‚¹ä¸Šã€‚\nçƒ­ç‚¹è¯†åˆ«è½¬ç§»æœ‰ä¸¤ç§ç­–ç•¥ï¼š\n  éšæœºç§»åŠ¨ç­–ç•¥ï¼Œæ•ˆç‡é«˜ã€æ•ˆæœå¯èƒ½å·®ï¼ˆä¸éœ€è¦é‡‡æ ·ã€è®¡ç®—ï¼Œå“åº”é€Ÿåº¦å¿«ï¼‰ï¼Œä¾‹å¦‚ç¬¬Ræ¬¡è®¿é—®å¦‚æœæ˜¯ Hot Accessï¼Œä¿æŒä¸å˜ï¼Œå¦‚æœæ˜¯ Cold Accessï¼Œç§»åŠ¨å¤´æŒ‡é’ˆæŒ‡å‘å†·æ•°æ®ï¼Œåœ¨çƒ­ç‚¹é›†ä¸­æ—¶éå¸¸æœ‰æ•ˆï¼Œå¤´æŒ‡é’ˆä¼šè¶‹å‘äºæŒ‡å‘çƒ­ç‚¹æ•°æ®ï¼Œå¦åˆ™å¯èƒ½ä¼šé¢‘ç¹æ‘‡æ‘†ã€‚\n  ç»Ÿè®¡é‡‡æ ·ç­–ç•¥ï¼Œæ•ˆç‡ä½ã€æ•ˆæœå¯èƒ½æ›´å¥½ï¼Œç´¢å¼•æ ¼å¼æœ‰ç‰¹æ®Šè¦æ±‚å¦‚ä¸‹å›¾ï¼š\n   é’ˆå¯¹RCUæ›´æ–°æ“ä½œçš„é‡‡æ ·ä¼˜åŒ– çƒ­ç‚¹ç»§æ‰¿é˜²æ­¢å†·å¯åŠ¨ é‡‡æ ·åˆ†æç­–ç•¥å¦‚ä½•é€‰å‡ºæœ€ä¼˜ä½ç½®  å†…å­˜æŒ‡é’ˆåˆ†é…64bitsï¼Œaddress å®é™…ä½¿ç”¨äº†48bitsï¼Œé‡‡æ ·æ‰€éœ€çš„å…ƒæ•°æ®ç»“æ„ä¸Šé¢çš„å›¾æ‰€ç¤ºï¼Œåˆ†åˆ«åœ¨å¤´æŒ‡é’ˆå¤„è®¾ç½®Total Counterï¼Œè®°å½•è¯¥ç¯çš„è®¿é—®æ€»æ¬¡æ•°ï¼Œæ¯ä¸ªitemè®¾ç½®Counterè®°å½•è¯¥itemçš„è®¿é—®æ¬¡æ•°ã€‚å› ä¸ºå†…å­˜æŒ‡é’ˆéœ€è¦åˆ†é…64bitsï¼Œä½†å®é™…ç³»ç»Ÿåœ°å€ç´¢å¼•åªä½¿ç”¨å…¶ä¸­çš„48bitsã€‚æˆ‘ä»¬ä½¿ç”¨å‰©ä½™16bitsè®¾ç½®æ ‡å¿—ä½(ä¾‹å¦‚Total Counterã€Counterç­‰)ï¼Œä¿è¯ä¸ä¼šå¢åŠ é¢å¤–çš„å…ƒæ•°æ®å¼€é”€ã€‚è¯¥ç­–ç•¥çš„ä¼˜åŠ¿æ˜¯ï¼Œé€šè¿‡é‡‡æ ·åˆ†æï¼Œå¯ä»¥è®¡ç®—é€‰å‡ºæœ€ä¼˜çš„å¤´æŒ‡é’ˆä½ç½®ï¼Œç¨³æ€æ—¶æ€§èƒ½è¡¨ç°æ›´ä¼˜ã€‚\næ•°æ®é‡‡æ ·\næˆ‘æ¥è§£é‡Šä¸€ä¸‹å…¬å¼ï¼Œk= æœ‰å¤šå°‘ä¸ªèŠ‚ç‚¹ï¼Œni= å½“å‰èŠ‚ç‚¹è®¿é—®é¢‘ç‡ï¼ŒNæ€»çš„è®¿é—®æ¬¡æ•°ï¼Œmodè®¡ç®—å‡ºæ¥çš„å†…å­˜æŒ‡é’ˆéœ€è¦ç§»åŠ¨æ¬¡æ•°ï¼Œç„¶åå°±æ˜¯æ¦‚ç‡*è®¿é—®çš„æˆæœ¬ï¼Œç„¶åç´¯åŠ å°±çŸ¥é“è®¿é—®å¾—åˆ°çƒ­ç‚¹æ•°æ®çš„æˆæœ¬ï¼Œæœ€åå°±æ˜¯tå°±æ˜¯æŒ‡é’ˆè°ƒæ•´åˆ°çš„èŠ‚ç‚¹ã€‚\nä¸ºä»€ä¹ˆä¸æ˜¯ç›´æ¥è½¬ç§»åˆ° max(ni)?\nè¿™ä¸ªé—®é¢˜æ˜¾ç„¶å°±æ˜¯å¦‚æœä½ ç›´æ¥è°ƒæ•´åˆ°çƒ­èŠ‚ç‚¹ä½ç½®ï¼Œé‚£ä¹ˆè¿™ä¸ªç¯è·¯ä¸Šä¸åªæ˜¯æœ‰ä¸€ä¸ªçƒ­ç‚¹æ•°æ®èŠ‚ç‚¹ï¼Œæ‰€æœ‰éœ€è¦ä½¿ç”¨é‡‡ç”¨ç»è¿‡å…¬å¼è®¡ç®—ä¹‹åçš„ã€‚\n å†™å…¥å¯†é›†å‹çš„çƒ­ç‚¹ï¼šRCU Readè¯»çƒ­ç‚¹ã€Updateå†™å…¥å¯†é›†å‹çƒ­ç‚¹ Less Than 8Bytes -- CAS More Than 8Bytes -- RCU å¦‚æœå¤´æŒ‡é’ˆæŒ‡å‘çš„èŠ‚ç‚¹è¢« Updateï¼Œç»™å‰é©±èŠ‚ç‚¹ Counter + 1     ğŸ”ï¼šæ— é”å¹¶å‘è®¿é—®  Tairçš„RCUæ— é”å¼•æ“æ˜¯HotRingçš„è®¾è®¡åŸºç¡€ï¼Œå› ä¸ºæ²¡æœ‰å¯¹ç¯å½¢é“¾è¡¨ç»“æ„ä¿®æ”¹ï¼Œæ‰€ä»¥ä¸å­˜åœ¨å¹¶å‘é—®é¢˜ï¼Œå¯ä»¥ç›´æ¥ä¸åŠ é”è®¿é—®ã€‚\nä½†æ˜¯åœ¨å¹¶å‘æ’å…¥æ—¶æ•°æ®ä¸¢å¤±é—®é¢˜ï¼Œè§£å†³åŠæ³•å°±æ˜¯ä½¿ç”¨äº†CompareAndSwapï¼Œä¿è¯åŒæ—¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿä¿®æ”¹æˆåŠŸã€‚\nä»€ä¹ˆæ˜¯CompareAndSwap? é€šå¸¸ä¼šè®°å½•ä¸‹æŸå—å†…å­˜ä¸­çš„æ—§å€¼ï¼Œé€šè¿‡å¯¹æ—§å€¼è¿›è¡Œä¸€ç³»åˆ—çš„æ“ä½œåå¾—åˆ°æ–°å€¼ï¼Œç„¶åé€šè¿‡CASæ“ä½œå°†æ–°å€¼ä¸æ—§å€¼è¿›è¡Œäº¤æ¢ã€‚å¦‚æœè¿™å—å†…å­˜çš„å€¼åœ¨è¿™æœŸé—´å†…æ²¡è¢«ä¿®æ”¹è¿‡ï¼Œåˆ™æ—§å€¼ä¼šä¸å†…å­˜ä¸­çš„æ•°æ®ç›¸åŒï¼Œè¿™æ—¶CASæ“ä½œå°†ä¼šæˆåŠŸæ‰§è¡Œ ä½¿å†…å­˜ä¸­çš„æ•°æ®å˜ä¸ºæ–°å€¼ã€‚\nUpdate å’Œ Insertion å¹¶å‘å¼•å‘çš„æ•°æ®ä¸¢å¤±ï¼Œæ€ä¹ˆçœ‹è¿™ä¸ªå›¾ï¼Œå‡è®¾Bä¸ºçƒ­ç‚¹æ•°æ®ï¼Œç¨‹åºæ¯æ¬¡æ‰¾çš„Bå¿…é¡»ç»è¿‡Aï¼Œå› ä¸ºAåœ¨ç¯è·¯ä¸Šæ˜¯åœ¨Bå‰é¢ï¼Œé‚£ä¹ˆè®¿é—®Bå¤šå°‘æ¬¡Aå°±æ˜¯å¤šå°‘æ¬¡ï¼Œé‚£ä¹ˆè¿™ä¸ªä¸æ˜¯ç†æƒ³çš„ï¼Œé‚£å°±è®©hardæŒ‡é’ˆæŒ‡å‘Aè®©Bä¹‹é—´æ²¡æœ‰å…¶ä»–çš„å€¼ã€‚\nåœ¨é“¾A-\u0026gt;B-\u0026gt;Dä¸Šï¼Œçº¿ç¨‹1è¿›è¡Œæ’å…¥Cçš„æ“ä½œï¼ŒåŒæ—¶çº¿ç¨‹2è¿›è¡ŒRCUæ›´æ–°Bçš„æ“ä½œï¼Œå°è¯•æ›´æ–°ä¸ºB\u0026rsquo;ã€‚çº¿ç¨‹1ä¿®æ”¹Bçš„æŒ‡é’ˆæŒ‡å‘Cï¼Œå®Œæˆæ’å…¥ã€‚è€Œçº¿ç¨‹2ä¿®æ”¹Açš„æŒ‡é’ˆæŒ‡å‘B'å®Œæˆæ›´æ–°ã€‚ä¸¤ä¸ªçº¿ç¨‹å¹¶å‘ä¿®æ”¹ä¸åŒçš„å†…å­˜ï¼Œå‡å¯æˆåŠŸè¿”å›ã€‚ä½†æ˜¯è¿™æ—¶éå†æ•´æ¡é“¾(A-\u0026gt;B'-\u0026gt;D)ï¼Œå°†å‘ç°Cæ— æ³•è¢«éå†åˆ°ï¼Œå¯¼è‡´æ­£ç¡®æ€§é—®é¢˜ã€‚å½“çº¿ç¨‹2æ›´æ–°Bæ—¶ï¼Œé¦–å…ˆéœ€è¦å°†Bçš„Occupiedæ ‡å¿—ä½ç½®ä½ã€‚çº¿ç¨‹1æ’å…¥Céœ€è¦ä¿®æ”¹Bçš„æŒ‡é’ˆ(Next Item Address)ï¼Œè‹¥å‘ç°Occupiedæ ‡å¿—ä½å·²ç½®ä½ï¼Œåˆ™éœ€è¦é‡æ–°éå†é“¾è¡¨ï¼Œå°è¯•æ’å…¥ï¼Œé€šè¿‡ä½¿å¹¶å‘æ“ä½œç«äº‰ä¿®æ”¹åŒä¸€å†…å­˜åœ°å€ï¼Œä¿è¯å¹¶å‘æ“ä½œçš„æ­£ç¡®æ€§ï¼Œåˆ©ç”¨ç›¸åŒåŸç†ä¿è¯äº†å¤´æŒ‡é’ˆç§»åŠ¨æ“ä½œï¼Œä¸CRUDæ“ä½œçš„å¹¶å‘æ­£ç¡®æ€§ï¼Œå› æ­¤å®ç°äº†HotRingçš„æ— é”å¹¶å‘è®¿é—®ã€‚\næ›´å¤šç»†èŠ‚è‡ªå·±å»çœ‹è®ºæ–‡å§ï¼Œä¸Šé¢éƒ¨åˆ†æ€»ç»“ã€‚\n   è®ºæ–‡èµ„æ–™   https://www.usenix.org/system/files/fast20-chen_jiqiang.pdf  ","date":"Sep 16","permalink":"http://blog.ibyte.me/post/alibaba-hot-ring/","tags":null,"title":"Alibaba Hot Ring Perceive"},{"categories":null,"contents":"   æ¦‚ è¿°   å¥½ä¹…æ²¡æœ‰æ›´æ–°rustç›¸å…³çš„å†…å®¹äº†ï¼Œæ›´æ–°ä¸€æ³¢Rustçš„å†…å®¹ï¼Œæœ¬ç¯‡è®²ä»‹ç»ä¸€ä¸‹Rustä¸­çš„å¤åˆæ•°æ®ç±»å‹ã€‚\n    Composite Type  å¤åˆæ•°æ®ç±»å‹æ˜¯ä¸€ç§æ•°æ®ç±»å‹ï¼Œå®ƒå¯ä»¥åŸå§‹çš„åŸºæœ¬æ•°æ®ç±»å‹å’Œå…¶å®ƒçš„å¤åˆç±»å‹æ‰€æ„æˆï¼Œ æ„æˆä¸€ä¸ªå¤åˆç±»å‹çš„åŠ¨ä½œï¼Œåˆç§°ä½œç»„åˆã€‚\næœ¬æ–‡è®²ä»‹ç»ä¸€ä¸‹åœ¨Rustä¸­æœ‰tupleã€arrayã€structã€enumå‡ ä¸ªå¤åˆç±»å‹ã€‚\n   tuple  tupleå³å…ƒç»„ï¼Œå…ƒç»„ç±»å‹æ˜¯ç”±å¤šä¸ªä¸åŒç±»å‹çš„å…ƒç´ ç»„æˆçš„å¤åˆç±»å‹ï¼Œé€šè¿‡()å°æ‹¬å·æŠŠå…ƒç´ ç»„ç»‡åœ¨ä¸€èµ·æˆä¸€ä¸ªæ–°çš„æ•°æ®ç±»å‹ã€‚å…ƒç»„çš„é•¿åº¦åœ¨å®šä¹‰çš„æ—¶å€™å°±å·²ç»æ˜¯å›ºå®šçš„äº†ï¼Œä¸èƒ½ä¿®æ”¹ï¼Œå¦‚æœæŒ‡å®šäº†å…ƒç´ çš„æ•°æ®ç±»å‹ï¼Œé‚£ä¹ˆä½ çš„å…ƒç´ å°±è¦å¯¹å·å…¥åº§ï¼ï¼ï¼å¦åˆ™ç¼–è¯‘å™¨ä¼šæ•™è®­ä½ ï¼\nä¾‹å­ï¼š\n1 2 3 4 5 6 7 8 9 10 11  fn main(){// æŒ‡å®šæ•°æ®ç±»å‹ lettup_type:(i8,i32,bool)=(21,-1024,true);// è§£æ„å…ƒç´  let(one,two,three)=tup_type;// äºŒç»´çš„å…ƒç»„ lettup_2d:(f64,(i8,i32,bool))=(3.1415927,(one,two,three));println!(\u0026#34;tup_2d = {:?}\u0026#34;,tup_2d);// ç´¢å¼• println!(\u0026#34;Ï€ = {:?}\u0026#34;,tup_2d.0);}  å…ƒç»„çš„è®¿é—®æ–¹å¼æœ‰å¥½å‡ ç§ï¼Œé€šè¿‡ä¸‹æ ‡å»è®¿é—®ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨è§£æ„èµ‹å€¼ç»™æ–°çš„å˜é‡å»è®¿é—®ï¼Œä½†æ˜¯ä¸æ”¯æŒè¿­ä»£å™¨å»è®¿é—®ã€‚\n1 2 3  forvintup_2d.1.iter(){println!(\u0026#34;{}\u0026#34;,v)}  1 2 3 4 5 6 7 8 9 10 11 12 13  Compiling playground v0.0.1 (/playground) error[E0599]: no method named `iter` found for tuple `(i8, i32, bool)` in the current scope --\u0026gt; src/main.rs:10:23 | 10 | for v in tup_type.iter() { | ^^^^ method not found in `(i8, i32, bool)` error: aborting due to previous error For more information about this error, try `rustc --explain E0599`. error: could not compile `playground` To learn more, run the command again with --verbose.   å…ƒç»„çš„æ¯ä¸ªå…ƒç´ çš„ç±»å‹å¯ä»¥ä¸åŒï¼Œå› æ­¤æ‚¨æ— æ³•å¯¹å…¶è¿›è¡Œè¿­ä»£ã€‚å…ƒç»„ç”šè‡³ä¸èƒ½ä¿è¯ä»¥ä¸ç±»å‹å®šä¹‰ç›¸åŒçš„é¡ºåºå­˜å‚¨æ•°æ®ï¼Œå› æ­¤å³ä½¿æ‚¨è‡ªå·±ä¸ºå®ƒä»¬å®ç°Iteratorï¼Œå®ƒä»¬ä¹Ÿä¸é€‚åˆè¿›è¡Œæœ‰æ•ˆçš„è¿­ä»£ã€‚\nä½†æ˜¯å¦‚æœå…ƒç´ æ˜¯æ”¯æŒå®ç°äº†Iteratorå°±å¯ä»¥é€šè¿‡.iter()è¿›è¡Œè¿­ä»£è®¿é—®ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15  letmutarrays:[usize;5]=[0;5];foriin0..5{arrays[i]=i+1;}println!(\u0026#34;{:?}\u0026#34;,arrays);lettup_arr:(\u0026amp;str,[usize;5])=(\u0026#34;tup_arr\u0026#34;,arrays);println!(\u0026#34;{:?}\u0026#34;,tup_arr);forvintup_arr.1.iter(){println!(\u0026#34;{}\u0026#34;,v)}  ä¾‹å¦‚ä¸Šçš„å…ƒç´ æ˜¯ä¸€ä¸ªarrayï¼ŒRustä¸­çš„æ•°ç»„å’Œå…¶ä»–è¯­è¨€ä¸€æ ·ï¼Œä¸€ç»„ç±»å‹ç›¸åŒçš„å…ƒç´ ç»„æˆçš„å¤åˆç±»å‹ï¼Œæ•°ç»„åœ¨åº•å±‚å­˜å‚¨æ˜¯ä¸€å—è¿ç»­çš„å†…å­˜ç©ºé—´ã€‚\n   array  Rustä¸­çš„æ•°ç»„å£°æ˜æ˜¯[T;n]è¿›è¡Œçš„ï¼ŒTæ˜¯å…ƒç´ ç±»å‹ï¼Œnæ˜¯è¿™ç»„å…ƒç´ æœ‰å¤šå°‘ä¸ªå‘ä½ï¼Œåˆ›å»ºçš„æ—¶å€™å¯ä»¥å»æ‰ç±»å‹å’Œå¤§å°ï¼Œç¨‹åºä¼šè‡ªåŠ¨æ¨æ–­å‡ºæ¥ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15  // æ•°ç»„ letarr:[f32;3]=[1.0,2.2,3.33];println!(\u0026#34;{:?}\u0026#34;,arr);// ç±»å‹è‡ªåŠ¨æ¨å¯¼ letarr_infer=[\u0026#34;Hello\u0026#34;,\u0026#34;,\u0026#34;,\u0026#34;World!\u0026#34;];letmutstr=String::new();// è¿­ä»£å™¨ forvinarr_infer.iter(){str.push_str(v);}println!(\u0026#34;str = {}\u0026#34;,str);  ç‚¹å‡»æŸ¥çœ‹å…ƒç»„ä»£ç æ¡ˆä¾‹\n   enum  æšä¸¾ç±»å‹ï¼Œå¦‚æœä½ ä¹‹å‰ä»äº‹è¿‡Javaç›¸å…³çš„å¼€å‘åº”è¯¥ä¸é™Œç”Ÿï¼Œåœ¨Rusté‡Œé¢ä¹Ÿæœ‰æšä¸¾ç±»å‹ï¼Œæšä¸¾ç±»å‹æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰æ•°æ®ç±»å‹ï¼Œé€šè¿‡enumå…³é”®å­—æ¥å£°æ˜ï¼Œbodyé‡Œé¢å¯ä»¥åŒ…å«å¤šä¸ªè‡ªå®šä¹‰çš„æšä¸¾å€¼ï¼Œæšä¸¾å¯ä»¥ç”¨æ¥é™åˆ¶æŸä¸ªå€¼æˆ–è€…ç±»å‹èŒƒå›´ã€‚\n1 2 3 4 5  #[derive(Debug)]enum Gender{Boy,Girl,}  ä¸Šé¢å°±å®šä¹‰ä¸€äº†ä¸ªç±»å‹åå­—ä¸ºGenderçš„æšä¸¾ï¼ŒBoyå’ŒGirlæ˜¯æšä¸¾å¯ä¾›ä½¿ç”¨çš„å€¼ï¼Œ#[derive(Debug)]æ³¨é‡Šæ˜¯è®©Genderè‡ªåŠ¨å®ç°Debug taritåé¢æ–‡ç« å°†æ·±å…¥ã€‚\n   struct  ç»“æ„ä½“å¯ä»¥æŠŠä¸€äº›è‡ªå®šä¹‰çš„æ•°æ®ç±»å‹é€šè¿‡å·²æœ‰çš„ç±»å‹ç»„è£…æˆä¸€ä¸ªæ–°çš„è‡ªå®šä¹‰æ•°æ®ç±»å‹ï¼Œé€šè¿‡structå…³é”®å­—å°±å¯ä»¥åˆ›å»ºä¸€ä¸ªç»“æ„ä½“ï¼Œç»“æ„ä½“å­—æ®µæ ¼å¼name:typeï¼Œnameæ˜¯ç»“æ„ä½“å­—æ®µåï¼Œtypeæ˜¯å­—æ®µçš„ç±»å‹ï¼Œé»˜è®¤æ˜¯ä¸å¯å˜çš„ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26  fn main(){// æšä¸¾ç°åœ¨å–å€¼èŒƒå›´ #[derive(Debug)]enum Gender{Boy,Girl,}// å®šä¹‰ä¸€ä¸ªç»“æ„ä½“ #[derive(Debug)]struct Programmer\u0026lt;\u0026#39;skill\u0026gt;{name: String,skill: [\u0026amp;\u0026#39;skillstr;3],sex: Gender,}// åˆ›å»ºä¸€ä¸ªå®ä¾‹ letengineer=Programmer{name: String::from(\u0026#34;Jaco Ding\u0026#34;),// Stringç±»å‹å†…å®¹å¯å˜ skill: [\u0026#34;Java\u0026#34;,\u0026#34;Go\u0026#34;,\u0026#34;Rust\u0026#34;],// ä¸€ä¸ªé•¿åº¦ä¸º3çš„å­—ç¬¦ä¸²é¢é‡ç±»å‹çš„æ•°ç»„ sex:Gender::Boy,// é€šè¿‡æšä¸¾é™åˆ¶å‚æ•°ç±»å‹ };println!(\u0026#34;engineer = {:?}\u0026#34;,engineer);}  æœ‰äº†è‡ªå®šä¹‰çš„ç±»å‹äº†ä¹Ÿå°±æ˜¯structå°±å¯ä»¥é€šè¿‡è‡ªå®šä¹‰çš„ç±»å‹æ¥å¤„ç†ä¸€äº›ç‰¹æ®Šçš„éœ€æ±‚äº†ï¼Œä¾‹å¦‚ä¸‹é¢çš„ä»£ç å®šä¹‰äº†ä¸€ä¸ªå…ƒç´ ç±»å‹ä¸ºProgrammeré•¿åº¦ä¸º2çš„æ•°ç»„ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17  letDoris=Programmer{name: String::from(\u0026#34;Doris\u0026#34;),skill: [\u0026#34;Vue\u0026#34;,\u0026#34;TypeScript\u0026#34;,\u0026#34;JavaScript\u0026#34;],sex:Gender::Girl,};letJaco=Programmer{name: String::from(\u0026#34;Jaco\u0026#34;),skill: [\u0026#34;Java\u0026#34;,\u0026#34;Go\u0026#34;,\u0026#34;Rust\u0026#34;],sex:Gender::Boy,};letemployees:[Programmer;2]=[Doris,Jaco];foreinemployees.iter(){println!(\u0026#34;{:?}\u0026#34;,e)}  ç»“æ„ä½“Programmerä¸Šçš„\u0026lt;'skill\u0026gt; è§£å†³skillæ•°ç»„çš„ç”Ÿå‘½å‘¨æœŸé—®é¢˜undeclared lifetimeï¼Œæ‰€æœ‰æƒé—®é¢˜ï¼Œæ‰€æœ‰æƒæ˜¯Rustè¯­è¨€æ ¸å¿ƒçš„çŸ¥è¯†ç‚¹ï¼Œè¿™äº›åœ¨åé¢æ–‡ç« ä¸­æ…¢æ…¢æ›´æ–°ã€‚\n   å°ç»“  Rustä¸­çš„ç»“æ„ä½“è¿˜æœ‰ä¸¤ç§ç‰¹æ®Šç»“æ„ï¼šå…ƒç»„ç»“æ„ä½“ã€å•ç»“æ„ä½“ï¼Œæšä¸¾ä¹Ÿæœ‰å¸¦æœ‰å‚æ•°çš„æšä¸¾ã€‚ã€‚ã€‚æœ¬æ–‡å°±å­¦ä¹ æ€»ç»“äº†ä¸€ä¸‹å¸¸è§å¤åˆç±»å‹çš„ä½¿ç”¨ï¼Œæœªæ·±å…¥ã€‚\n","date":"Sep 16","permalink":"http://blog.ibyte.me/post/compound-data-type-of-rust/","tags":null,"title":"Compound Data Type of Rust"},{"categories":null,"contents":"   å‰è¨€   æ–­æ–­ç»­ç»­çœ‹äº†åŠä¸ªæœˆçš„Rustä¹¦ï¼Œå­¦äº†ç‚¹åŸºç¡€ï¼Œä¸çŸ¥é“åšä»€ä¹ˆå¥½ï¼Ÿï¼Ÿäºæ˜¯æˆ‘æƒ³ç€ç”¨ä¸šä½™æ—¶é—´æ’¸ä¸€ä¸ªcommand line applicationçš„éª¨æ¶ã€‚ç„¶åå°±æœ‰äº†https://github.com/auula/falseworkè¿™ä¸ªé¡¹ç›®ï¼Œfalseworkå¯ä»¥å¸®åŠ©ä½ å¿«é€Ÿæ„å»ºä¸€ä¸ªå‘½ä»¤è¡Œåº”ç”¨ã€‚è¿™ç¯‡æ–‡ç« å†™å†™falseworkçš„ä½¿ç”¨å¹¶åœ¨åéƒ¨åˆ†ä»‹ç»ä¸€ä¸‹æ€ä¹ˆå®ç°çš„ã€‚\n çœ‹äº†çœ‹è¿™å¼ å›¾ï¼Œé‚£æˆ‘ä¼°è®¡è¿˜åœ¨å¡é“èµ·æ­¥ã€‚ã€‚\n   å¯¼å…¥ä¾èµ–   https://crates.io/crates/falsework  åœ¨ä½ çš„é¡¹ç›®ä¸­æ·»åŠ ä¾èµ–å¦‚ä¸‹ï¼š\n1 2  [dependencies] falsework = \u0026#34;0.1.3\u0026#34;      å¿«é€Ÿæ„å»º  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45  usestd::error::Error;usefalsework::{app,cmd};fn main(){// é€šè¿‡falseworkåˆ›å»ºä¸€ä¸ªéª¨æ¶ letmutapp=falsework::app::new();// åº”ç”¨å…ƒæ•°æ®ä¿¡æ¯ app.name(\u0026#34;calculator\u0026#34;).author(\u0026#34;Leon Ding \u0026lt;ding@ibyte.me\u0026gt;\u0026#34;).version(\u0026#34;0.0.1\u0026#34;).description(\u0026#34;A calculator that only supports addition.\u0026#34;);// æ„å»ºå‘½ä»¤è¡Œé¡¹ letmutcommand=cmd::CommandItem{// run å‘½ä»¤æ‰€å¯¹åº”å‘½ä»¤è¡Œé€»è¾‘ä»£ç  run: |ctx|-\u0026gt; Result\u0026lt;(),Box\u0026lt;dynError\u0026gt;\u0026gt;{// é€šè¿‡ä¸Šä¸‹æ–‡è·å–flagç»‘å®šçš„æ•°æ® letx=ctx.value_of(\u0026#34;--x\u0026#34;).parse::\u0026lt;i32\u0026gt;().unwrap();lety=ctx.value_of(\u0026#34;--y\u0026#34;).parse::\u0026lt;i32\u0026gt;().unwrap();println!(\u0026#34;{} + {} = {}\u0026#34;,x,y,x+y);// å¦‚æœå¤„ç†å‘ç”Ÿäº†é”™è¯¯åˆ™è°ƒç”¨ cmd::err_msg ä¼šä¼˜é›…çš„é€€å‡º // Err(cmd::err_msg(\u0026#34;Application produce errorï¼\u0026#34;)); Ok(())},// å‘½ä»¤å¸®åŠ©ä¿¡æ¯ long: \u0026#34;è¿™æ˜¯ä¸€ä¸ªåŠ æ³•è®¡ç®—ç¨‹åºéœ€è¦ä¸¤ä¸ªflagå‚æ•° --x --y\u0026#34;,// å‘½ä»¤ä»‹ç» short: \u0026#34;åŠ æ³•è®¡ç®—\u0026#34;,// é€šè¿‡addæ¿€æ´»å‘½ä»¤ r#use: \u0026#34;add\u0026#34;,}.build();// ç»™addå‘½ä»¤ç»‘å®šflag command.bound_flag(\u0026#34;--x\u0026#34;,\u0026#34;åŠ æ•°\u0026#34;);command.bound_flag(\u0026#34;--y\u0026#34;,\u0026#34;è¢«åŠ æ•°\u0026#34;);// å¾€appé‡Œé¢æ·»åŠ ä¸€ä¸ªå‘½ä»¤é›† app.add_cmd(command);// æœ€årun ç¨‹åºå¼€å§‹ç›‘å¬å‘½ä»¤è¡Œè¾“å…¥ app.run();}  ä¸Šé¢è¿™ä¸ªä¾‹å­è¿è¡Œèµ·æ¥ç»“æœ:\n1 2  $: ./calculator add --x=10 --y=10 10 + 10 = 20   åˆ°æ­¤ä¸ºæ­¢ä½ å°±å¿«é€Ÿæ„å»ºä¸€ä¸ªå‘½ä»¤è¡Œè®¡ç®—å™¨äº†ï¼Œä½ åªéœ€è¦å†™ä½ æ ¸å¿ƒé€»è¾‘ï¼Œå…¶ä»–æ“ä½œfalseworkå¸®åŠ©ä½ å®Œæˆã€‚\n ä¾‹å¦‚å¦‚æœæˆ‘ä¸è®°å¾—äº†å‘½ä»¤äº†ï¼Œåªè®°å¾—ä¸€ä¸ªå•è¯æˆ–è€…å­—æ¯ï¼Œç¨‹åºä¼šå¸®åŠ©ä½ ä¿®å¤ï¼š  1 2 3 4 5  $: ./calculator a You need this command ? add a : The corresponding command set was not found!   å¯ä»¥çœ‹åˆ°ç¨‹åºæç¤ºä½ æœ‰ä¸€ä¸ªå¯¹åº”çš„addå‘½ä»¤å¯ä»¥ä½¿ç”¨ï¼Œå¦‚æœä¸çŸ¥é“addæœ‰å•¥å‚æ•°ï¼Œåœ¨åé¢ åŠ ä¸Š--helpå³å¯è·å¾—å¸®åŠ©ä¿¡æ¯ï¼š  1 2 3 4 5 6 7 8 9 10 11  $: ./calculator add --help Help: è¿™æ˜¯ä¸€ä¸ªåŠ æ³•è®¡ç®—ç¨‹åºéœ€è¦ä¸¤ä¸ªflagå‚æ•° --x --y Usage: calculator add [flags] Flags: --y, è¢«åŠ æ•° --x, åŠ æ•°   æ„å»ºå‡ºæ¥ä¸»ç¨‹åºé¢„è§ˆï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16  $: ./calculator A calculator that only supports addition. calculator 0.0.1 Leon Ding \u0026lt;ding@ibyte.me\u0026gt; Usage: calculator [command] Available Commands: add\tåŠ æ³•è®¡ç®— Flags: --help help for calculator Use \u0026#34;calculator [command] --help\u0026#34; for more information about a command.      å…¶ä»–æ“ä½œ  æœ‰å¤šç§æ„å»ºæ–¹å¼ï¼Œä¾‹å¦‚ä¸‹é¢çš„ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36  #[test]fn test_add_commands(){letmutapp=falsework::app::new();app.name(\u0026#34;calculator\u0026#34;).author(\u0026#34;Leon Ding \u0026lt;ding@ibyte.me\u0026gt;\u0026#34;).version(\u0026#34;0.0.2\u0026#34;).description(\u0026#34;A command line program built with Falsework.\u0026#34;);letcommand_list=vec![cmd::CommandItem{run: |_ctx|-\u0026gt; Result\u0026lt;(),Box\u0026lt;dynError\u0026gt;\u0026gt;{// _ctx.args è·å–å‘½ä»¤è¡Œå‚æ•° println!(\u0026#34;call foo command.\u0026#34;);Ok(())},long: \u0026#34;è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•å‘½ä»¤ï¼Œä½¿ç”¨fooå°†è°ƒç”¨fooå‘½ä»¤ã€‚\u0026#34;,short: \u0026#34;fooå‘½ä»¤\u0026#34;,r#use: \u0026#34;foo\u0026#34;,},cmd::CommandItem{run: |_ctx|-\u0026gt; Result\u0026lt;(),Box\u0026lt;dynError\u0026gt;\u0026gt;{println!(\u0026#34;call bar command.\u0026#34;);Ok(())},long: \u0026#34;è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•å‘½ä»¤ï¼Œä½¿ç”¨barå°†è°ƒç”¨barå‘½ä»¤ã€‚\u0026#34;,short: \u0026#34;barå‘½ä»¤\u0026#34;,r#use: \u0026#34;bar\u0026#34;,},].iter().map(|c|c.build()).collect();app.commands(command_list);println!(\u0026#34;{:#?}\u0026#34;,app);}     Falseworkçš„è®¾è®¡  æ•´ä½“æ¥è¯´ä¹Ÿå°±æ˜¯3å¤§å—ï¼Œå¯¹åº”ä¸€ä¸ªcliç¨‹åºæŠ½è±¡çš„è¯ä¹Ÿå°±è¿™ä¹ˆå¤šäº†ï¼Œç„¶åå°±æ˜¯å¯¹å•å—çš„ç»“æ„è¿›è¡Œå°è£…å¦‚å›¾ï¼Œç„¶åå°±æ˜¯æ„å»ºä¸€ä¸ªéª¨æ¶äº†ã€‚\næ‹¿ä¸Šé¢è¿™ä¸ªä¾‹å­æ¥è¯´ï¼Œåœ¨ä½ æ•²å‡»å›è½¦é‚£ä¸€åˆ»ï¼Œéª¨æ¶è¦å¸®åšå¾ˆå¤šargsè§£æçš„äº‹æƒ…ï¼Œç„¶åæ„å»ºå¯¹åº”ä»»åŠ¡å¤„ç†ã€‚\nè¿™å¼ å›¾å°±æ˜¯å½“ç¨‹åºç›‘å¬åˆ°å‘½ä»¤è¡Œæœ‰è¾“å…¥æ“ä½œçš„æ—¶å€™è¦åšçš„äº‹æƒ…ï¼Œæˆ‘æŠŠä»–æŠ½è±¡ç”»æˆäº†ä¸€ä¸ªå›¾ï¼Œå¤§éƒ¨åˆ†ç¨‹åºå‘˜åº”è¯¥èƒ½çœ‹å¾—æ‡‚ï¼Œçœ‹ä¸æ‡‚å¯ä»¥å¯¹ç…§ä»“åº“ä»£ç çœ‹çœ‹ï¼Œè™½ç„¶ä»£ç å†™çš„ä¸€å¨ï¼Œå¾ˆlowä»£ç ï¼Œæ¯•ç«Ÿè¿˜åªæ˜¯åˆšåˆšå…¥å‘Rustã€‚ã€‚ã€‚ã€‚æ–°æ‰‹æœ‹å‹å¯ä»¥çœ‹çœ‹ï¼Œå¯¹äº†æœ‰å¯å‘æˆ–è€…å¸®åŠ©è®°å¾—ç•™ä¸€ä¸ªstarï¼\n   ä»“åº“   https://github.com/auula/falsework  ","date":"Sep 16","permalink":"http://blog.ibyte.me/post/rust-falsework-desgin/","tags":null,"title":"Rust Falsework Desgin"},{"categories":null,"contents":"ç›¸ä¿¡å¤§å®¶åœ¨å¼€å‘çš„è¿‡ç¨‹ä¸­ç»å¸¸ä¼šä½¿ç”¨åˆ°goä¸­å¹¶å‘åˆ©å™¨channelï¼Œchannel æ˜¯CSPå¹¶å‘æ¨¡å‹ä¸­æœ€é‡è¦çš„ä¸€ä¸ªç»„ä»¶ï¼Œä¸¤ä¸ªç‹¬ç«‹çš„å¹¶å‘å®ä½“é€šè¿‡å…±äº«çš„é€šè®¯channelè¿›è¡Œé€šä¿¡ã€‚å¤§å¤šæ•°äººåªæ˜¯ä¼šç”¨è¿™ä¹ˆä¸ªç»“æ„å¾ˆå°‘æœ‰äººè®¨è®ºå®ƒåº•å±‚å®ç°ï¼Œè¿™ç¯‡æ–‡ç« è®²å†™å†™channelçš„åº•å±‚å®ç°ã€‚\n   channel  channelçš„åº•å±‚å®ç°æ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œæºä»£ç å¦‚ä¸‹:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20  type hchan struct { qcount uint // total data in the queue  dataqsiz uint // size of the circular queue  buf unsafe.Pointer // points to an array of dataqsiz elements  elemsize uint16 closed uint32 elemtype *_type // element type  sendx uint // send index  recvx uint // receive index  recvq waitq // list of recv waiters  sendq waitq // list of send waiters  // lock protects all fields in hchan, as well as several  // fields in sudogs blocked on this channel.  //  // Do not change another G\u0026#39;s status while holding this lock  // (in particular, do not ready a G), as this can deadlock  // with stack shrinking.  lock mutex }   å¯èƒ½çœ‹æºä»£ç ä¸æ˜¯å¾ˆå¥½çœ‹å¾—æ‡‚ï¼Œè¿™é‡Œæˆ‘ä¸ªäººç”»äº†ä¸€å¼ å›¾æ–¹ä¾¿å¤§å®¶æŸ¥çœ‹ï¼Œæˆ‘åœ¨ä¸Šé¢æ ‡æ³¨äº†ä¸åŒé¢œè‰²ï¼Œå¹¶ä¸”æ³¨é‡Šå…¶ä½œç”¨ã€‚\né€šé“åƒä¸€ä¸ªä¼ é€å¸¦æˆ–è€…é˜Ÿåˆ—ï¼Œæ€»æ˜¯éµå¾ªFIFOçš„è§„åˆ™ï¼Œä¿è¯æ”¶å‘æ•°æ®çš„é¡ºåºï¼Œé€šé“æ˜¯goroutineé—´é‡è¦é€šä¿¡çš„æ–¹å¼ï¼Œæ˜¯å¹¶å‘å®‰å…¨çš„ã€‚\n   buf  hchanç»“æ„ä½“ä¸­çš„bufæŒ‡å‘ä¸€ä¸ªå¾ªç¯é˜Ÿåˆ—ï¼Œç”¨æ¥å®ç°å¾ªç¯é˜Ÿåˆ—ï¼Œsendxæ˜¯å¾ªç¯é˜Ÿåˆ—çš„é˜Ÿå°¾æŒ‡é’ˆï¼Œrecvxæ˜¯å¾ªç¯é˜Ÿåˆ—çš„é˜Ÿå¤´æŒ‡é’ˆï¼Œdataqsizeæ˜¯ç¼“å­˜å‹é€šé“çš„å¤§å°ï¼Œqcountæ˜¯è®°å½•é€šé“å†…å…ƒç´ ä¸ªæ•°ã€‚\nåœ¨æ—¥å¸¸å¼€å‘è¿‡ç¨‹ä¸­ç”¨çš„æœ€å¤šå°±æ˜¯ch := make(chan int, 10)è¿™æ ·çš„æ–¹å¼åˆ›å»ºä¸€ä¸ªé€šé“ï¼Œå¦‚æœè¿™è¦å£°æ˜åˆå§‹åŒ–çš„è¯ï¼Œè¿™ä¸ªé€šé“å°±æ˜¯æœ‰ç¼“å†²åŒºçš„ï¼Œä¹Ÿæ˜¯å›¾ä¸Šç´«è‰²çš„bufï¼Œbufæ˜¯åœ¨makeçš„æ—¶å€™ç¨‹åºåˆ›å»ºçš„ï¼Œå®ƒæœ‰å…ƒç´ å¤§å°*å…ƒç´ ä¸ªæ•°ç»„æˆä¸€ä¸ªå¾ªç¯é˜Ÿåˆ—ï¼Œå¯ä»¥çœ‹åšæˆä¸€ä¸ªç¯å½¢ç»“æ„ï¼Œbufåˆ™æ˜¯ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘è¿™ä¸ªç¯ã€‚\nä¸Šå›¾å¯¹åº”çš„ä»£ç é‚£å°±æ˜¯ch = make(chan int,6)ï¼ŒbufæŒ‡å‘è¿™ä¸ªç¯åœ¨heapä¸Šçš„åœ°å€ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48  func makechan(t *chantype, size int) *hchan { elem := t.elem // compiler checks this but be safe.  if elem.size \u0026gt;= 1\u0026lt;\u0026lt;16 { throw(\u0026#34;makechan: invalid channel element type\u0026#34;) } if hchanSize%maxAlign != 0 || elem.align \u0026gt; maxAlign { throw(\u0026#34;makechan: bad alignment\u0026#34;) } mem, overflow := math.MulUintptr(elem.size, uintptr(size)) if overflow || mem \u0026gt; maxAlloc-hchanSize || size \u0026lt; 0 { panic(plainError(\u0026#34;makechan: size out of range\u0026#34;)) } // Hchan does not contain pointers interesting for GC when elements stored in buf do not contain pointers.  // buf points into the same allocation, elemtype is persistent.  // SudoG\u0026#39;s are referenced from their owning thread so they can\u0026#39;t be collected.  // TODO(dvyukov,rlh): Rethink when collector can move allocated objects.  var c *hchan switch { case mem == 0: // Queue or element size is zero.  c = (*hchan)(mallocgc(hchanSize, nil, true)) // Race detector uses this location for synchronization.  c.buf = c.raceaddr() case elem.ptrdata == 0: // Elements do not contain pointers.  // Allocate hchan and buf in one call.  c = (*hchan)(mallocgc(hchanSize+mem, nil, true)) c.buf = add(unsafe.Pointer(c), hchanSize) default: // Elements contain pointers.  c = new(hchan) c.buf = mallocgc(mem, elem, true) } c.elemsize = uint16(elem.size) c.elemtype = elem c.dataqsiz = uint(size) lockInit(\u0026amp;c.lock, lockRankHchan) if debugChan { print(\u0026#34;makechan: chan=\u0026#34;, c, \u0026#34;; elemsize=\u0026#34;, elem.size, \u0026#34;; dataqsiz=\u0026#34;, size, \u0026#34;\\n\u0026#34;) } return c }   ä¸Šé¢å°±æ˜¯å¯¹åº”çš„ä»£ç å®ç°ï¼Œä¸Šæ¥å®ƒä¼šæ£€æŸ¥ä½ ä¸€ç³»åˆ—å‚æ•°æ˜¯å¦åˆæ³•ï¼Œç„¶ååœ¨é€šè¿‡mallocgcåœ¨å†…å­˜å¼€è¾Ÿè¿™å—ç©ºé—´ï¼Œç„¶åè¿”å›ã€‚\n   sendx and recvx  ä¸‹é¢æˆ‘æ‰‹åŠ¨æ¨¡æ‹Ÿä¸€ä¸ªringå®ç°çš„ä»£ç ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38  // Queue cycle buffer type CycleQueue struct { data []interface{} // å­˜æ”¾å…ƒç´ çš„æ•°ç»„ï¼Œå‡†ç¡®æ¥è¯´æ˜¯åˆ‡ç‰‡  frontIndex, rearIndex int // frontIndex å¤´æŒ‡é’ˆ,rearIndex å°¾æŒ‡é’ˆ  size int // circular çš„å¤§å° } // NewQueue Circular Queue func NewQueue(size int) (*CycleQueue, error) { if size \u0026lt;= 0 || size \u0026lt; 10 { return nil, fmt.Errorf(\u0026#34;initialize circular queue size fail,%d not legal,size \u0026gt;= 10\u0026#34;, size) } cq := new(CycleQueue) cq.data = make([]interface{}, size) cq.size = size return cq, nil } // Push add data to queue func (q *CycleQueue) Push(value interface{}) error { if (q.rearIndex+1)%cap(q.data) == q.frontIndex { return errors.New(\u0026#34;circular queue full\u0026#34;) } q.data[q.rearIndex] = value q.rearIndex = (q.rearIndex + 1) % cap(q.data) return nil } // Pop return queue a front element func (q *CycleQueue) Pop() interface{} { if q.rearIndex == q.frontIndex { return nil } v := q.data[q.frontIndex] q.data[q.frontIndex] = nil // æ‹¿é™¤å…ƒç´  ä½ç½®å°±è®¾ç½®ä¸ºç©º  q.frontIndex = (q.frontIndex + 1) % cap(q.data) return v }   å¾ªç¯é˜Ÿåˆ—ä¸€èˆ¬ä½¿ç”¨ç©ºä½™å•å…ƒæ³•æ¥è§£å†³é˜Ÿç©ºå’Œé˜Ÿæ»¡æ—¶å€™éƒ½å­˜åœ¨font=rearå¸¦æ¥çš„äºŒä¹‰æ€§é—®é¢˜ï¼Œä½†è¿™æ ·ä¼šæµªè´¹ä¸€ä¸ªå•å…ƒã€‚golangçš„channelä¸­æ˜¯é€šè¿‡å¢åŠ qcountå­—æ®µè®°å½•é˜Ÿåˆ—é•¿åº¦æ¥è§£å†³äºŒä¹‰æ€§ï¼Œä¸€æ–¹é¢ä¸ä¼šæµªè´¹ä¸€ä¸ªå­˜å‚¨å•å…ƒï¼Œå¦ä¸€æ–¹é¢å½“ä½¿ç”¨lenå‡½æ•°æŸ¥çœ‹é˜Ÿåˆ—é•¿åº¦æ—¶å€™ï¼Œå¯ä»¥ç›´æ¥è¿”å›qcountå­—æ®µï¼Œä¸€ä¸¾ä¸¤å¾—ã€‚\nå½“æˆ‘ä»¬éœ€è¦è¯»å–çš„æ•°æ®çš„æ—¶å€™ç›´æ¥ä»recvxæŒ‡é’ˆä¸Šçš„å…ƒç´ å–ï¼Œè€Œå†™å°±ä»sendxä½ç½®å†™å…¥å…ƒç´ ï¼Œå¦‚å›¾ï¼š\n   sendq and recvq  å½“å†™å…¥æ•°æ®çš„å¦‚æœç¼“å†²åŒºå·²ç»æ»¡æˆ–è€…è¯»å–çš„ç¼“å†²åŒºå·²ç»æ²¡æœ‰æ•°æ®çš„æ—¶å€™ï¼Œå°±ä¼šå‘ç”Ÿåç¨‹é˜»å¡ã€‚\nå¦‚æœå†™é˜»å¡çš„æ—¶å€™ä¼šæŠŠå½“å‰çš„åç¨‹åŠ å…¥åˆ°sendqçš„é˜Ÿåˆ—ä¸­ï¼Œç›´åˆ°æœ‰ä¸€ä¸ªrecvqå‘èµ·äº†ä¸€ä¸ªè¯»å–çš„æ“ä½œï¼Œé‚£ä¹ˆå†™çš„é˜Ÿåˆ—å°±ä¼šè¢«ç¨‹åºå”¤é†’è¿›è¡Œå·¥ä½œã€‚\nå½“ç¼“å†²åŒºæ»¡äº†æ‰€æœ‰çš„g-wåˆ™è¢«åŠ å…¥sendqé˜Ÿåˆ—ç­‰å¾…g-ræœ‰æ“ä½œå°±è¢«å”¤é†’g-wï¼Œç»§ç»­å·¥ä½œï¼Œè¿™ç§è®¾è®¡å’Œæ“ä½œç³»ç»Ÿçš„é‡Œé¢threadçš„5ç§çŠ¶æ€å¾ˆæ¥è¿‘äº†ï¼Œå¯ä»¥çœ‹å‡ºgoçš„è®¾è®¡è€…åœ¨å¯èƒ½å‚è€ƒè¿‡æ“ä½œç³»ç»Ÿçš„threadè®¾è®¡ã€‚\nå½“ç„¶ä¸Šé¢åªæ˜¯æˆ‘ç®€è¿°æ•´ä¸ªä¸ªè¿‡ç¨‹ï¼Œå®é™…ä¸Šgoè¿˜åšäº†å…¶ä»–ç»†èŠ‚ä¼˜åŒ–ï¼Œsendqä¸ä¸ºç©ºçš„æ—¶å€™ï¼Œå¹¶ä¸”æ²¡æœ‰ç¼“å†²åŒºï¼Œä¹Ÿå°±æ˜¯æ— ç¼“å†²åŒºé€šé“ï¼Œæ­¤æ—¶ä¼šä»sendqç¬¬ä¸€ä¸ªåç¨‹ä¸­æ‹¿å–æ•°æ®ï¼Œæœ‰å…´è¶£çš„gopherå¯ä»¥å»è‡ªå·±æŸ¥çœ‹æºä»£ç ï¼Œæœ¬æ–‡ä¹Ÿæ˜¯æœ€è¿‘ç¬”è€…åœ¨çœ‹åˆ°è¿™å—æºä»£ç çš„ç¬”è®°æ€»ç»“ã€‚\n","date":"Sep 16","permalink":"http://blog.ibyte.me/post/golang-channel-desgin/","tags":null,"title":"Golang Channel Desgin"},{"categories":null,"contents":"   å‰ è¨€  å¾ˆå¤šæ—¶å€™ä¸ºäº†æ›´å¿«çš„å¼€å‘æ•ˆç‡ï¼Œå¤§å¤šæ•°ç¨‹åºå‘˜éƒ½æ˜¯åœ¨ä½¿ç”¨æŠ½è±¡å±‚çº§æ›´é«˜çš„æŠ€æœ¯ï¼ŒåŒ…æ‹¬è¯­è¨€ï¼Œæ¡†æ¶ï¼Œè®¾è®¡æ¨¡å¼ç­‰ã€‚æ‰€ä»¥å¯¼è‡´å¾ˆå¤šç¨‹åºå‘˜åŒ…æ‹¬æˆ‘è‡ªå·±åœ¨å†…å¯¹äºåº•å±‚å’ŒåŸºç¡€çš„çŸ¥è¯†éƒ½ä¼šæœ‰äº›ç”Ÿç–å’Œï¼Œä½†æ˜¯æ­£æ˜¯è¿™äº›åº•å±‚çš„ä¸œè¥¿æ„å»ºäº†æˆ‘ä»¬ç†ŸçŸ¥çš„è§£å†³æ–¹æ¡ˆï¼ŒåŒæ—¶å†³å®šäº†ä¸€ä¸ªæŠ€æœ¯äººå‘˜çš„ä¸Šé™ã€‚\nåœ¨å†™Cå’ŒC++çš„æ—¶å€™åŠ¨æ€åˆ†é…å†…å­˜æ˜¯è®©ç¨‹åºå‘˜è‡ªå·±æ‰‹åŠ¨ç®¡ç†ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œéœ€è¦ç”³è¯·å¤šå°‘å†…å­˜ç©ºé—´å¯ä»¥å¾ˆå¥½çš„æŒæ¡æ€ä¹ˆåˆ†é…ï¼Œä½†æ˜¯å¦‚æœå¿˜è®°é‡Šæ”¾å†…å­˜ï¼Œåˆ™ä¼šå¯¼è‡´å†…å­˜æ³„æ¼ã€‚\nRuståˆæ¯”ğŸ‘†ä¸Šé¢ä¿©é—¨è¯­è¨€åˆ†é…å†…å­˜æ–¹å¼æ˜¾å¾—ä¸åŒï¼ŒRustçš„å†…å­˜ç®¡ç†ä¸»è¦ç‰¹è‰²å¯ä»¥çœ‹åšæ˜¯ç¼–è¯‘å™¨å¸®ä½ åœ¨é€‚å½“çš„åœ°æ–¹æ’å…¥deleteæ¥é‡Šæ”¾å†…å­˜ï¼Œè¿™æ ·ä¸€æ¥ä½ ä¸éœ€è¦æ˜¾å¼æŒ‡å®šé‡Šæ”¾ï¼Œruntimeä¹Ÿä¸éœ€è¦ä»»ä½•GCï¼Œä½†æ˜¯è¦åšåˆ°è¿™ç‚¹ï¼Œç¼–è¯‘å™¨éœ€è¦èƒ½åˆ†æå‡ºåœ¨ä»€ä¹ˆåœ°æ–¹deleteï¼Œè¿™å°±éœ€è¦ä½ ä»£ç æŒ‰ç…§å…¶è§„åˆ™æ¥å†™äº†ã€‚\nç›¸æ¯”ä¸Šé¢å‡ ç§çš„å†…å­˜ç®¡ç†æ–¹å¼çš„è¯­è¨€ï¼ŒåƒJavaå’ŒGolangåœ¨è¯­è¨€è®¾è®¡çš„æ—¶å€™å°±åŠ å…¥äº†garbage collectionä¹Ÿå°±runtimeä¸­çš„gcï¼Œè®©ç¨‹åºå‘˜ä¸éœ€è¦è‡ªå·±ç®¡ç†å†…å­˜ï¼ŒçœŸæ­£è§£æ”¾äº†ç¨‹åºå‘˜çš„åŒæ‰‹ï¼Œè®©æˆ‘ä»¬å¯ä»¥ä¸“æ³¨äºç¼–ç ã€‚\n   å‡½æ•°æ ˆå¸§  å½“ä¸€ä¸ªå‡½æ•°åœ¨è¿è¡Œæ—¶ï¼Œéœ€è¦ä¸ºå®ƒåœ¨å †æ ˆä¸­åˆ›å»ºä¸€ä¸ªæ ˆå¸§ï¼ˆstack frameï¼‰ç”¨æ¥è®°å½•è¿è¡Œæ—¶äº§ç”Ÿçš„ç›¸å…³ä¿¡æ¯ï¼Œå› æ­¤æ¯ä¸ªå‡½æ•°åœ¨æ‰§è¡Œå‰éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ ˆå¸§ï¼Œåœ¨å®ƒè¿”å›æ—¶ä¼šé”€æ¯è¯¥æ ˆå¸§ã€‚\né€šå¸¸ç”¨ä¸€ä¸ªå«åšæ ˆåŸºå€ï¼ˆbpï¼‰çš„å¯„å­˜å™¨æ¥ä¿å­˜æ­£åœ¨è¿è¡Œå‡½æ•°æ ˆå¸§çš„å¼€å§‹åœ°å€ï¼Œç”±äºæ ˆæŒ‡é’ˆï¼ˆspï¼‰å§‹ç»ˆä¿å­˜çš„æ˜¯æ ˆé¡¶çš„åœ°å€ï¼Œæ‰€ä»¥æ ˆæŒ‡é’ˆä¿å­˜çš„ä¹Ÿå°±æ˜¯æ­£åœ¨è¿è¡Œå‡½æ•°æ ˆå¸§çš„ç»“æŸåœ°å€ã€‚\né”€æ¯æ—¶å…ˆæŠŠæ ˆæŒ‡é’ˆï¼ˆspï¼‰ç§»åŠ¨åˆ°æ­¤æ—¶æ ˆåŸºå€ï¼ˆbpï¼‰çš„ä½ç½®ï¼Œæ­¤æ—¶æ ˆæŒ‡é’ˆå’Œæ ˆåŸºå€éƒ½æŒ‡å‘åŒæ ·çš„ä½ç½®ã€‚\n   Goå†…å­˜é€ƒé€¸  å¯ä»¥ç®€å•å¾—ç†è§£æˆä¸€æ¬¡å‡½æ•°è°ƒç”¨å†…éƒ¨ç”³è¯·åˆ°çš„å†…å­˜ï¼Œå®ƒä»¬ä¼šéšç€å‡½æ•°çš„è¿”å›æŠŠå†…å­˜è¿˜ç»™ç³»ç»Ÿã€‚ä¸‹é¢æ¥çœ‹çœ‹ä¸€ä¸ªä¾‹å­ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21  package main import \u0026#34;fmt\u0026#34; func main() { f := foo(\u0026#34;Ding\u0026#34;) fmt.Println(f) } type bar struct { s string } func foo(s string) bar { f := new(bar) // è¿™é‡Œçš„new(bar)ä¼šä¸ä¼šå‘ç”Ÿé€ƒé€¸ï¼Ÿï¼Ÿï¼Ÿ  defer func() { f = nil }() f.s = s return *f }   æˆ‘æƒ³å¾ˆå¤šäººè®¤ä¸ºå‘ç”Ÿäº†é€ƒé€¸ï¼Œä½†æ˜¯çœŸçš„æ˜¯è¿™æ ·çš„å—ï¼Ÿé‚£å°±ç”¨go build -gcflags=-m escape/struct.goçœ‹çœ‹ä¼šè¾“å‡ºä»€ä¹ˆï¼Ÿï¼Ÿï¼Ÿ\nå…¶å®æ²¡æœ‰å‘ç”Ÿé€ƒé€¸ï¼Œè€Œescape/struct.go:7:13: f escapes to heapçš„é€ƒé€¸æ˜¯å› ä¸ºåŠ¨æ€ç±»å‹é€ƒé€¸ï¼Œfmt.Println(a â€¦interface{})åœ¨ç¼–è¯‘æœŸé—´å¾ˆéš¾ç¡®å®šå…¶å‚æ•°çš„å…·ä½“ç±»å‹ï¼Œä¹Ÿèƒ½äº§ç”Ÿé€ƒé€¸ã€‚\nç»§ç»­çœ‹ä¸‹é¢è¿™ä¸€ä¸ªä¾‹å­ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21  package main import \u0026#34;fmt\u0026#34; func main() { f := foo(\u0026#34;Ding\u0026#34;) fmt.Println(f) } type bar struct { s string } func foo(s string) *bar { f := new(bar) // è¿™é‡Œçš„new(bar)ä¼šä¸ä¼šå‘ç”Ÿé€ƒé€¸ï¼Ÿï¼Ÿï¼Ÿ  defer func() { f = nil }() f.s = s return f }   f := new(bar)ä¼šå‘ç”Ÿé€ƒé€¸å—ï¼Ÿ\n1 2 3 4 5 6 7 8 9  $: go build -gcflags=-m escape/struct.go # command-line-arguments escape/struct.go:16:8: can inline foo.func1 escape/struct.go:7:13: inlining call to fmt.Println escape/struct.go:14:10: leaking param: s escape/struct.go:15:10: new(bar) escapes to heap âœ… escape/struct.go:16:8: func literal does not escape escape/struct.go:7:13: []interface {}{...} does not escape \u0026lt;autogenerated\u0026gt;:1: .this does not escape   Goå¯ä»¥è¿”å›å±€éƒ¨å˜é‡æŒ‡é’ˆï¼Œè¿™å…¶å®æ˜¯ä¸€ä¸ªå…¸å‹çš„å˜é‡é€ƒé€¸æ¡ˆä¾‹ï¼Œè™½ç„¶åœ¨å‡½æ•° foo() å†…éƒ¨ f ä¸ºå±€éƒ¨å˜é‡ï¼Œå…¶å€¼é€šè¿‡å‡½æ•°è¿”å›å€¼è¿”å›ï¼Œf æœ¬èº«ä¸ºä¸€æŒ‡é’ˆï¼Œå…¶æŒ‡å‘çš„å†…å­˜åœ°å€ä¸ä¼šæ˜¯æ ˆè€Œæ˜¯å †ï¼Œè¿™å°±æ˜¯å…¸å‹çš„é€ƒé€¸æ¡ˆä¾‹ã€‚\né‚£å°±ç»§ç»­å¾€ä¸‹çœ‹å§ï¼Œçœ‹çœ‹è¿™ä¸ªä¾‹å­ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14  package main func main() { Slice() // ï¼Ÿï¼Ÿï¼Ÿ ä¼šå‘ç”Ÿé€ƒé€¸å—ï¼Ÿ } func Slice() { s := make([]int, 10000, 10000) for index, _ := range s { s[index] = index } }   ä¼°è®¡å¾ˆå¤šäººä¼šå›ç­”æ²¡æœ‰ï¼Œå…¶å®è¿™é‡Œå‘ç”Ÿé€ƒé€¸ï¼Œå®é™…ä¸Šå½“æ ˆç©ºé—´ä¸è¶³ä»¥å­˜æ”¾å½“å‰å¯¹è±¡æ—¶æˆ–æ— æ³•åˆ¤æ–­å½“å‰åˆ‡ç‰‡é•¿åº¦æ—¶ä¼šå°†å¯¹è±¡åˆ†é…åˆ°å †ä¸­ã€‚\næœ€åä¸€ä¸ªä¾‹å­:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29  package main import ( \u0026#34;fmt\u0026#34; \u0026#34;io\u0026#34; \u0026#34;os\u0026#34; ) func main() { Println(string(*ReverseA(\u0026#34;Ding Ding\u0026#34;))) // ??? } func Println(str string) { io.WriteString(os.Stdout, str+\u0026#34;\\n\u0026#34;) } func ReverseA(str string) *[]rune { result := make([]rune, 0, len(str)) for _, v := range []rune(str) { v := v defer func() { result = append(result, v) }() } return \u0026amp;result }   å¦‚æœä¸€ä¸ªå˜é‡è¢«å–åœ°å€ï¼Œé€šè¿‡å‡½æ•°è¿”å›æŒ‡é’ˆå€¼è¿”å›ï¼Œè¿˜æœ‰é—­åŒ…ï¼Œç¼–è¯‘å™¨ä¸ç¡®å®šä½ çš„åˆ‡ç‰‡å®¹é‡æ—¶ï¼Œæ˜¯å¦è¦æ‰©å®¹çš„æ—¶å€™ï¼Œæ”¾åˆ°å †ä¸Šï¼Œä»¥è‡´äº§ç”Ÿé€ƒé€¸ã€‚\näºæ˜¯æˆ‘ä¼˜åŒ–äº†ä¸€ä¸‹ä»£ç ï¼Œå†çœ‹çœ‹\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23  package main import ( \u0026#34;io\u0026#34; \u0026#34;os\u0026#34; ) func main() { result := []rune(\u0026#34;Ding Ding\u0026#34;) ReverseB(result) Println(string(result)) } func ReverseB(runes []rune) { for i, j := 0, len(runes)-1; i \u0026lt; j; i, j = i+1, j-1 { runes[i], runes[j] = runes[j], runes[i] } } func Println(str string) { io.WriteString(os.Stdout, str+\u0026#34;\\n\u0026#34;) }      å¦‚ä½•å¾—çŸ¥å˜é‡æ˜¯æ€ä¹ˆåˆ†é…ï¼Ÿ   å¼•ç”¨ (golang.org) FAQå®˜æ–¹è¯´çš„ï¼š\n å‡†ç¡®åœ°è¯´ï¼Œä½ å¹¶ä¸éœ€è¦çŸ¥é“ï¼ŒGolang ä¸­çš„å˜é‡åªè¦è¢«å¼•ç”¨å°±ä¸€ç›´ä¼šå­˜æ´»ï¼Œå­˜å‚¨åœ¨å †ä¸Šè¿˜æ˜¯æ ˆä¸Šç”±å†…éƒ¨å®ç°å†³å®šè€Œå’Œå…·ä½“çš„è¯­æ³•æ²¡æœ‰å…³ç³»ã€‚çŸ¥é“å˜é‡çš„å­˜å‚¨ä½ç½®ç¡®å®å’Œæ•ˆç‡ç¼–ç¨‹æœ‰å…³ç³»ã€‚å¦‚æœå¯èƒ½ï¼ŒGolang ç¼–è¯‘å™¨ä¼šå°†å‡½æ•°çš„å±€éƒ¨å˜é‡åˆ†é…åˆ°å‡½æ•°æ ˆå¸§ï¼ˆstack frameï¼‰ä¸Šï¼Œ ç„¶è€Œï¼Œå¦‚æœç¼–è¯‘å™¨ä¸èƒ½ç¡®ä¿å˜é‡åœ¨å‡½æ•° returnä¹‹åä¸å†è¢«å¼•ç”¨ï¼Œç¼–è¯‘å™¨å°±ä¼šå°†å˜é‡åˆ†é…åˆ°å †ä¸Šã€‚è€Œä¸”ï¼Œå¦‚æœä¸€ä¸ªå±€éƒ¨å˜é‡éå¸¸å¤§ï¼Œé‚£ä¹ˆå®ƒä¹Ÿåº”è¯¥è¢«åˆ†é…åˆ°å †ä¸Šè€Œä¸æ˜¯æ ˆä¸Šã€‚\n   å° ç»“   é€ƒé€¸åˆ†æçš„å¥½å¤„æ˜¯ä¸ºäº†å‡å°‘gcçš„å‹åŠ› æ ˆä¸Šåˆ†é…çš„å†…å­˜ä¸éœ€è¦gcå¤„ç† åŒæ­¥æ¶ˆé™¤ï¼Œå¦‚æœä½ å®šä¹‰çš„å¯¹è±¡çš„æ–¹æ³•ä¸Šæœ‰åŒæ­¥é”ï¼Œä½†åœ¨è¿è¡Œæ—¶ï¼Œå´åªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨è®¿é—®ï¼Œæ­¤æ—¶é€ƒé€¸åˆ†æåçš„æœºå™¨ç ï¼Œä¼šå»æ‰åŒæ­¥é”è¿è¡Œã€‚  ","date":"Sep 16","permalink":"http://blog.ibyte.me/post/golang-memory-escape-analysis/","tags":null,"title":"Golang Memory Escape Analysis"},{"categories":["syntax"],"contents":"Lorem ipsum dolor sit amet1 consectetur adipisicing elit. Nemo tempora eum cumque neque voluptatum, odit ipsum consequatur animi.\nLorem ipsum dolor sit amet consectetur adipisicing elit. Nemo tempora eum cumque neque voluptatum, odit ipsum2 consequatur animi.\nLorem ipsum dolor sit amet consectetur adipisicing elit. Nemo tempora eum cumque neque voluptatum, odit ipsum consequatur animi.\nLorem ipsum dolor sit amet consectetur adipisicing elit. Nemo tempora eum cumque neque voluptatum, odit ipsum consequatur animi.\n  Test Footnote \u0026#x21a9;\u0026#xfe0e;\n Test Footnote2 \u0026#x21a9;\u0026#xfe0e;\n   ","date":"May 31","permalink":"http://blog.ibyte.me/post-copy/footnote/","tags":null,"title":"Footnote test"},{"categories":["math"],"contents":"The following\n$$ \\int_{a}^{b} x^2 dx $$\nIs an integral\n$$ \\varphi = 1+\\frac{1} {1+\\frac{1} {1+\\frac{1} {1+\\cdots} } } $$\nEnable Katex in the config file by setting the katex param to true. This will import the necessary Katex CSS/JS.\nSee the online reference of supported TeX functions.\n1  Inline math: $\\varphi=\\dfrac{1+\\sqrt5}{2}=1.6180339887â€¦ $   Inline math: $ \\varphi = \\dfrac{1+\\sqrt5}{2}= 1.6180339887â€¦ $\n1 2 3  Block math: $$\\varphi=1+\\frac{1} {1+\\frac{1} {1+\\frac{1} {1+\\cdots} } } $$   Block math:\n$$ \\varphi = 1+\\frac{1} {1+\\frac{1} {1+\\frac{1} {1+\\cdots} } } $$\n","date":"May 22","permalink":"http://blog.ibyte.me/post-copy/test-katex/","tags":null,"title":"Katex support"},{"categories":["math"],"contents":"The following\n$$ \\int_{a}^{b} x^2 dx $$\nIs an integral\n$$ \\varphi = 1+\\frac{1} {1+\\frac{1} {1+\\frac{1} {1+\\cdots} } } $$\nEnable MathJax in the config file by setting the mathjax param to true. This will import the necessary MathJax CSS/JS.\n1  Inline math: $\\varphi=\\dfrac{1+\\sqrt5}{2}=1.6180339887â€¦ $   Inline math: $ \\varphi = \\dfrac{1+\\sqrt5}{2}= 1.6180339887â€¦ $\n1 2 3  Block math: $$\\varphi=1+\\frac{1} {1+\\frac{1} {1+\\frac{1} {1+\\cdots} } } $$   Block math:\n$$ \\varphi = 1+\\frac{1} {1+\\frac{1} {1+\\frac{1} {1+\\cdots} } } $$\n","date":"May 22","permalink":"http://blog.ibyte.me/post-copy/test-mathjax/","tags":null,"title":"MathJax support"},{"categories":null,"contents":"","date":"Nov 26","permalink":"http://blog.ibyte.me/articles/","tags":null,"title":"Articles"},{"categories":["themes","syntax"],"contents":"This article offers a sample of basic Markdown syntax that can be used in Hugo content files, also it shows whether basic HTML elements are decorated with CSS in a Hugo theme.\n   Headings  The following HTML \u0026lt;h1\u0026gt;â€”\u0026lt;h6\u0026gt; elements represent six levels of section headings. \u0026lt;h1\u0026gt; is the highest section level while \u0026lt;h6\u0026gt; is the lowest.\n   H1     H2     H3     H4     H5     H6     Paragraph  Xerum, quo qui aut unt expliquam qui dolut labo. Aque venitatiusda cum, voluptionse latur sitiae dolessi aut parist aut dollo enim qui voluptate ma dolestendit peritin re plis aut quas inctum laceat est volestemque commosa as cus endigna tectur, offic to cor sequas etum rerum idem sintibus eiur? Quianimin porecus evelectur, cum que nis nust voloribus ratem aut omnimi, sitatur? Quiatem. Nam, omnis sum am facea corem alique molestrunt et eos evelece arcillit ut aut eos eos nus, sin conecerem erum fuga. Ri oditatquam, ad quibus unda veliamenimin cusam et facea ipsamus es exerum sitate dolores editium rerore eost, temped molorro ratiae volorro te reribus dolorer sperchicium faceata tiustia prat.\nItatur? Quiatae cullecum rem ent aut odis in re eossequodi nonsequ idebis ne sapicia is sinveli squiatum, core et que aut hariosam ex eat.\n   Blockquotes  The blockquote element represents content that is quoted from another source, optionally with a citation which must be within a footer or cite element, and optionally with in-line changes such as annotations and abbreviations.\n   Blockquote without attribution   Tiam, ad mint andaepu dandae nostion secatur sequo quae. Note that you can use Markdown syntax within a blockquote.\n    Blockquote with attribution   Don\u0026rsquo;t communicate by sharing memory, share memory by communicating.\nâ€” Rob Pike1\n    Tables  Tables aren\u0026rsquo;t part of the core Markdown spec, but Hugo supports supports them out-of-the-box.\n   Name Age     Bob 27   Alice 23       Inline Markdown within tables     Italics Bold Code     italics bold code       Code Blocks     Code block with backticks  1 2 3 4 5 6 7 8 9 10  \u0026lt;!doctype html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;utf-8\u0026#34;\u0026gt; \u0026lt;title\u0026gt;Example HTML5 Document\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;p\u0026gt;Test\u0026lt;/p\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt;      Code block indented with four spaces  \u0026lt;!doctype html\u0026gt; \u0026lt;html lang=\u0026quot;en\u0026quot;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026quot;utf-8\u0026quot;\u0026gt; \u0026lt;title\u0026gt;Example HTML5 Document\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;p\u0026gt;Test\u0026lt;/p\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt;     Code block with Hugo\u0026amp;rsquo;s internal highlight shortcode  1 2 3 4 5 6 7 8 9 10  \u0026lt;!doctype html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;utf-8\u0026#34;\u0026gt; \u0026lt;title\u0026gt;Example HTML5 Document\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;p\u0026gt;Test\u0026lt;/p\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt;      List Types     Ordered List   First item Second item Third item     Unordered List   List item Another item And another item     Nested list   Fruit  Apple Orange Banana   Dairy  Milk Cheese       Other Elements â€” abbr, sub, sup, kbd, mark  GIF is a bitmap image format.\nH2O\nXn + Yn = Zn\nPress CTRL+ALT+Delete to end the session.\nMost salamanders are nocturnal, and hunt for insects, worms, and other small creatures.\n  The above quote is excerpted from Rob Pike\u0026rsquo;s talk during Gopherfest, November 18, 2015. \u0026#x21a9;\u0026#xfe0e;\n  ","date":"Mar 11","permalink":"http://blog.ibyte.me/post-copy/markdown-syntax/","tags":["markdown","css","html"],"title":"Markdown Syntax Guide"},{"categories":null,"contents":"   Nya nya nyan meow meow mama  More napping, more napping all the napping is exhausting stretch out on bed you are a captive audience while sitting on the toilet, pet me slap the dog because cats rule bleghbleghvomit my furball really tie the room together always hungry. Humans,humans, humans oh how much they love us felines we are the center of attention they feed, they clean miaow then turn around and show you my bum. Cats secretly make all the worlds muffins slap owner\u0026rsquo;s face at 5am until human fills food dish, milk the cow hunt by meowing loudly at 5am next to human slave food dispenser throwup on your pillow. Get scared by doggo also cucumerro .\n   Cat is meow meow  Sees bird in air, breaks into cage and attacks creature when in doubt, wash spend six hours per day washing, but still have a crusty butthole yet lick sellotape tickle my belly at your own peril i will pester for food when you\u0026rsquo;re in the kitchen even if it\u0026rsquo;s salad find box a little too small and curl up with fur hanging out.\nClaw at curtains stretch and yawn nibble on tuna ignore human bite human hand. Under the bed mice yet funny little cat chirrup noise shaking upright tail when standing next to you but white cat sleeps on a black shirt for eat an easter feather as if it were a bird then burp victoriously.\n   Has closed eyes but still sees you present belly  scratch hand when stroked for is good you understand your place in my world get scared by sudden appearance of cucumber. What the heck just happened, something feels fishy chew master\u0026rsquo;s slippers yet brown cats with pink ears bite the neighbor\u0026rsquo;s bratty kid cereal boxes make for five star accommodation but i like to spend my days sleeping and eating fishes that my human fished for me we live on a luxurious yacht, sailing proudly under the sun, i like to walk on the deck, watching the horizon, dreaming of a good bowl of milk. Lounge in doorway put butt in owner\u0026rsquo;s face, or ptracy destroy house in 5 seconds. Mrow no, you can\u0026rsquo;t close the door, i haven\u0026rsquo;t decided whether or not i wanna go out is good you understand your place in my world.\nBrown cats with pink ears shred all toilet paper and spread around the house being gorgeous with belly side up. Cats go for world domination the best thing in the universe is a cardboard box cats are cute so meow all night having their mate disturbing sleeping humans. Nya nya nyan annoy owner until he gives you food say meow repeatedly until belly rubs, feels good eat the fat cats food but meowing non stop for food. Pet right here, no not there, here, no fool, right here that other cat smells funny you should really give me all the treats because i smell the best and omg you finally got the right spot and i love you right now see brother cat receive pets, attack out of jealousy. Headbutt owner\u0026rsquo;s knee love blinks and purr purr purr purr yawn for stand in front of the computer screen, or mew mew for human is washing you why halp oh the horror flee scratch hiss bite.\n   Cats making all the muffins  Cats making all the muffins asdflkjaertvlkjasntvkjn (sits on keyboard) so the dog smells bad but cough hairball on conveniently placed pants and show belly but loved it, hated it, loved it, hated it catch mouse and gave it as a present. Give me attention or face the wrath of my claws meow all night for love me! and love you, then bite you or mesmerizing birds. Lick human with sandpaper tongue. Murf pratt ungow ungow scratch the box sit in box and to pet a cat, rub its belly, endure blood and agony, quietly weep, keep rubbing belly wake up human for food at 4am or eat owner\u0026rsquo;s food trip owner up in kitchen i want food. Curl up and sleep on the freshly laundered towels paw at your fat belly, steal mom\u0026rsquo;s crouton while she is in the bathroom yet nyan nyan goes the cat, scraaaaape scraaaape goes the walls when the cat murders them with its claws milk the cow suddenly go on wild-eyed crazy rampage toy mouse squeak roll over.\nHunt by meowing loudly at 5am next to human slave food dispenser hate dog reward the chosen human with a slow blink. Cat dog hate mouse eat string barf pillow no baths hate everything miaow then turn around and show you my bum love fish, and kitty scratches couch bad kitty steal the warm chair right after you get up kitty poochy munch on tasty moths. Take a big fluffing crap ğŸ’© scratch at fleas, meow until belly rubs, hide behind curtain when vacuum cleaner is on scratch strangers and poo on owners food i rule on my back you rub my tummy i bite you hard.\nThanks by cats.\n","date":"Mar 09","permalink":"http://blog.ibyte.me/post-copy/example-lazy-load-image/","tags":["markdown","text","image"],"title":"Example Lazy Load Image"},{"categories":null,"contents":"Lorem est tota propiore conpellat pectoribus de pectora summo.\nRedit teque digerit hominumque toris verebor lumina non cervice subde tollit usus habet Arctonque, furores quas nec ferunt. Quoque montibus nunc caluere tempus inhospita parcite confusaque translucet patri vestro qui optatis lumine cognoscere flos nubis! Fronde ipsamque patulos Dryopen deorum.\n Exierant elisi ambit vivere dedere Duce pollice Eris modo Spargitque ferrea quos palude  Rursus nulli murmur; hastile inridet ut ab gravi sententia! Nomine potitus silentia flumen, sustinet placuit petis in dilapsa erat sunt. Atria tractus malis.\n Comas hunc haec pietate fetum procerum dixit Post torum vates letum Tiresia Flumen querellas Arcanaque montibus omnes Quidem et     Vagus elidunt  \nThe Van de Graaf Canon\n   Mane refeci capiebant unda mulcebat  Victa caducifer, malo vulnere contra dicere aurato, ludit regale, voca! Retorsit colit est profanae esse virescere furit nec; iaculi matertera et visa est, viribus. Divesque creatis, tecta novat collumque vulnus est, parvas. Faces illo pepulere tempus adest. Tendit flamma, ab opes virum sustinet, sidus sequendo urbis.\nIubar proles corpore raptos vero auctor imperium; sed et huic: manus caeli Lelegas tu lux. Verbis obstitit intus oblectamina fixis linguisque ausus sperare Echionides cornuaque tenent clausit possit. Omnia putatur. Praeteritae refert ausus; ferebant e primus lora nutat, vici quae mea ipse. Et iter nil spectatae vulnus haerentia iuste et exercebat, sui et.\nEurytus Hector, materna ipsumque ut Politen, nec, nate, ignari, vernum cohaesit sequitur. Vel mitis temploque vocatus, inque alis, oculos nomen non silvis corpore coniunx ne displicet illa. Crescunt non unus, vidit visa quantum inmiti flumina mortis facto sic: undique a alios vincula sunt iactata abdita! Suspenderat ego fuit tendit: luna, ante urbem Propoetides parte.\n","date":"Mar 09","permalink":"http://blog.ibyte.me/post-copy/placeholder-text/","tags":["markdown","text"],"title":"Placeholder Text"},{"categories":null,"contents":"Emoji can be enabled in a Hugo project in a number of ways.\nThe emojify function can be called directly in templates or Inline Shortcodes.\nTo enable emoji globally, set enableEmoji to true in your site\u0026rsquo;s configuration and then you can type emoji shorthand codes directly in content files; e.g.\nğŸ™ˆ :see_no_evil: ğŸ™‰ :hear_no_evil: ğŸ™Š :speak_no_evil:\nThe Emoji cheat sheet is a useful reference for emoji shorthand codes.\n N.B. The above steps enable Unicode Standard emoji characters and sequences in Hugo, however the rendering of these glyphs depends on the browser and the platform. To style the emoji you can either use a third party emoji font or a font stack; e.g.\n1 2 3  .emoji { font-family: Apple Color Emoji, Segoe UI Emoji, NotoColorEmoji, Segoe UI Symbol, Android Emoji, EmojiSymbols; }  ","date":"Mar 05","permalink":"http://blog.ibyte.me/post-copy/emoji-support/","tags":["emoji"],"title":"Emoji Support"}]